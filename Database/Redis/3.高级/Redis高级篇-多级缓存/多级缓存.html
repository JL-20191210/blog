<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.17" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.58" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <title>å¤šçº§ç¼“å­˜ | å°æ»¡</title><meta name="description" content="å°æ»¡çš„çŸ¥è¯†åº“">
    <link rel="stylesheet" href="/blog/assets/css/styles.50e9a4d3.css">
    <link rel="preload" href="/blog/assets/js/runtime~app.f86e1f39.js" as="script"><link rel="preload" href="/blog/assets/css/styles.50e9a4d3.css" as="style"><link rel="preload" href="/blog/assets/js/9703.e09ff620.js" as="script"><link rel="preload" href="/blog/assets/js/app.3bf3e4c1.js" as="script">
    <link rel="prefetch" href="/blog/assets/js/Database_Redis_2.å®æˆ˜_Rediså®æˆ˜ç¯‡.html.ef4d662e.js" as="script"><link rel="prefetch" href="/blog/assets/js/Netty_4.Netty04-ä¼˜åŒ–ä¸æºç .html.e7d40ecf.js" as="script"><link rel="prefetch" href="/blog/assets/js/Netty_2.NIO åŸºç¡€.html.4b35293b.js" as="script"><link rel="prefetch" href="/blog/assets/js/Netty_3.Netty03-è¿›é˜¶.html.af54bd22.js" as="script"><link rel="prefetch" href="/blog/assets/js/Netty_3.Netty02-å…¥é—¨.html.9e803486.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_å…¥é—¨åˆ°èµ·é£_35.åå°„_åŠ¨æ€ä»£ç†_35.åå°„_åŠ¨æ€ä»£ç†.html.66d0420a.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_Redis_3.é«˜çº§_Redisé«˜çº§ç¯‡-å¤šçº§ç¼“å­˜_å¤šçº§ç¼“å­˜.html.ff471cbf.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_Redis_3.é«˜çº§_02-å¤šçº§ç¼“å­˜_å¤šçº§ç¼“å­˜.html.ecb62863.js" as="script"><link rel="prefetch" href="/blog/assets/js/SpringCloud_ES_è®²ä¹‰-åˆ†å¸ƒå¼æœç´¢å¼•æ“02.html.670b1109.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_Redis_1.å…¥é—¨_RedisåŸºç¡€ç¯‡.html.cbfb5db8.js" as="script"><link rel="prefetch" href="/blog/assets/js/SpringCloud_ES_è®²ä¹‰-åˆ†å¸ƒå¼æœç´¢å¼•æ“01.html.e242bc87.js" as="script"><link rel="prefetch" href="/blog/assets/js/è£…æœº_Intelæ¡Œé¢å¤„ç†å™¨è§„æ ¼.html.8fe5fdbb.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_Redis_4.åŸç†_åŸç†ç¯‡.html.758beea0.js" as="script"><link rel="prefetch" href="/blog/assets/js/MQ_RabbitMQ.html.0a7310f4.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_Redis_3.é«˜çº§_Redisé«˜çº§ç¯‡-æœ€ä½³å®è·µ_Redisé«˜çº§ç¯‡ä¹‹æœ€ä½³å®è·µ.html.ba96dd22.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_Redis_3.é«˜çº§_03-Redisæœ€ä½³å®è·µ_Redisé«˜çº§ç¯‡ä¹‹æœ€ä½³å®è·µ.html.9b30173f.js" as="script"><link rel="prefetch" href="/blog/assets/js/Python_åŸºç¡€_æ ¸å¿ƒæ•°æ®ç±»å‹.html.d7927650.js" as="script"><link rel="prefetch" href="/blog/assets/js/è£…æœº_AMDæ¡Œé¢å¤„ç†å™¨è§„æ ¼.html.22ad0ed3.js" as="script"><link rel="prefetch" href="/blog/assets/js/Vue_è¡¨å•éªŒè¯.html.c7b276b8.js" as="script"><link rel="prefetch" href="/blog/assets/js/SpringCloud_ES_4.å®‰è£…elasticsearch.html.8d8e6057.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_Java8ç‰¹æ€§_Java Stream API.html.4efc941a.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_Java8ç‰¹æ€§_å‡½æ•°å¼æ¥å£.html.fe5525e1.js" as="script"><link rel="prefetch" href="/blog/assets/js/Python_çˆ¬è™«_æ ·ä¾‹.html.955ab32a.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_é¢è¯•é¢˜_1.è¡¥å……- FSTæ¡†æ¶ä½¿ç”¨.html.8eefff4c.js" as="script"><link rel="prefetch" href="/blog/assets/js/Spring_æ³¨è§£_@ControllerAdvice.html.88139954.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_Java8ç‰¹æ€§_æ·±å…¥ç†è§£ Stream API.html.247546e7.js" as="script"><link rel="prefetch" href="/blog/assets/js/849.830c18d2.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_Redis_3.é«˜çº§_Redisé«˜çº§ç¯‡-åˆ†å¸ƒå¼ç¼“å­˜_Redisé«˜çº§-åˆ†å¸ƒå¼ç¼“å­˜.html.1d2afb10.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_Redis_3.é«˜çº§_01-åˆ†å¸ƒå¼ç¼“å­˜_Redisé«˜çº§-åˆ†å¸ƒå¼ç¼“å­˜.html.c579ebea.js" as="script"><link rel="prefetch" href="/blog/assets/js/8300.ff153695.js" as="script"><link rel="prefetch" href="/blog/assets/js/Netty_Channel.html.7d9b251b.js" as="script"><link rel="prefetch" href="/blog/assets/js/4214.394da83e.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_MySQL_åŸºç¡€_2-å‡½æ•°.html.b780334a.js" as="script"><link rel="prefetch" href="/blog/assets/js/Spring MVC_æ ¡éªŒ_Hibernate Validator.html.dc878077.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_Java8ç‰¹æ€§_æ·±å…¥ç†è§£ Java Collector.html.fb721c96.js" as="script"><link rel="prefetch" href="/blog/assets/js/é¡¹ç›®å®æˆ˜_è°·ç²’å•†åŸ_æ¿ä¹¦_æ•°æ®æ ¡éªŒ.html.a342e2e6.js" as="script"><link rel="prefetch" href="/blog/assets/js/Docker_ç§æœ‰äº‘_ç©å®¢äº‘.html.54bffb95.js" as="script"><link rel="prefetch" href="/blog/assets/js/Mybatis_Mybatis Plus_æ³¨è§£_@TableField.html.4ff8f1fe.js" as="script"><link rel="prefetch" href="/blog/assets/js/Spring MVC_æ ¡éªŒ_è‡ªå®šä¹‰æ ¡éªŒ.html.25b66c54.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_é¢è¯•é¢˜_3.æ‰©å±•-å¼‚å¸¸å¤„ç†æ³¨æ„ç‚¹.html.e09cf2e0.js" as="script"><link rel="prefetch" href="/blog/assets/js/Mybatis_Mybatis Plus_æ¥å£_MetaObjectHandleræ¥å£æ–‡æ¡£.html.58046c57.js" as="script"><link rel="prefetch" href="/blog/assets/js/SpringCloud_ES_8.å¸¸è§æŸ¥è¯¢ç±»å‹.html.ff1723d9.js" as="script"><link rel="prefetch" href="/blog/assets/js/emoji.html.656320bc.js" as="script"><link rel="prefetch" href="/blog/assets/js/Spring_æ³¨è§£_@InitBinder.html.54afd16f.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_é¢è¯•é¢˜_17.JDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†æœ‰ä»€ä¹ˆåŒºåˆ«.html.a4fb73e9.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_Java8ç‰¹æ€§_æ·±å…¥ç†è§£ Java ä¸­çš„é»˜è®¤æ–¹æ³•å’Œé™æ€æ–¹æ³•.html.54b57a4e.js" as="script"><link rel="prefetch" href="/blog/assets/js/é¡¹ç›®å®æˆ˜_è°·ç²’å•†åŸ_æŠ¥é”™è®°å½•_æµ‹è¯•æ–¹æ³•å¯åŠ¨ç©ºæŒ‡é’ˆ.html.5ab61648.js" as="script"><link rel="prefetch" href="/blog/assets/js/è®¾è®¡æ¨¡å¼_ä»£ç†æ¨¡å¼.html.639d603d.js" as="script"><link rel="prefetch" href="/blog/assets/js/Spring_æ³¨è§£_å…ƒæ³¨è§£.html.a0d90a67.js" as="script"><link rel="prefetch" href="/blog/assets/js/611.5fb33018.js" as="script"><link rel="prefetch" href="/blog/assets/js/JVM_jstackç”¨æ³•.html.0ddc2402.js" as="script"><link rel="prefetch" href="/blog/assets/js/SpringCloud_Alibaba-OSS_é˜¿é‡Œäº‘ossä½¿ç”¨è®°å½•.html.eaef8d41.js" as="script"><link rel="prefetch" href="/blog/assets/js/Mybatis_Mybatis Plus_æ¥å£_MetaObjectHandlerç¤ºä¾‹.html.560152b8.js" as="script"><link rel="prefetch" href="/blog/assets/js/Spring MVC_æ ¡éªŒ_JSR303æ•°å­—æ ¡éªŒ.html.2f47c9fd.js" as="script"><link rel="prefetch" href="/blog/assets/js/Spring_æ³¨è§£_@EnableTransactionManagement.html.f5529fd0.js" as="script"><link rel="prefetch" href="/blog/assets/js/JVM_2.å†…å­˜ç»“æ„_2.5æ–¹æ³•åŒº.html.44e8826c.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_Java8ç‰¹æ€§_æ·±å…¥ç†è§£ Java Optional ç±».html.9102eae7.js" as="script"><link rel="prefetch" href="/blog/assets/js/Mybatis_Mybatis Plus_this.page().html.a9c61512.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_Java8ç‰¹æ€§_æ·±å…¥ç†è§£ Java 8 æ–°ç‰¹æ€§ï¼šä»æ ¸å¿ƒåˆ°å®è·µ.html.459ddbe5.js" as="script"><link rel="prefetch" href="/blog/assets/js/Vue_vueæ¨¡æ¿.html.7e5d8ddf.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_å…¥é—¨åˆ°èµ·é£_35.åå°„_åŠ¨æ€ä»£ç†_åå°„.html.a4909ce0.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_é¢è¯•é¢˜_16.ä»€ä¹ˆæ˜¯Javaä¸­çš„åŠ¨æ€ä»£ç†.html.5d16e894.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_é¢è¯•é¢˜_5.ä»€ä¹ˆæ˜¯Javaçš„å¤šæ€.html.a617b902.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_MySQL_åŸºç¡€_1-æ•°æ®åº“æ§åˆ¶è¯­è¨€DCL.html.61820032.js" as="script"><link rel="prefetch" href="/blog/assets/js/JVM_2.å†…å­˜ç»“æ„_2.6ç›´æ¥å†…å­˜.html.8fab97ed.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_é¢è¯•é¢˜_7.Java ä¸æ”¯æŒå¤šé‡ç»§æ‰¿.html.ea5c7452.js" as="script"><link rel="prefetch" href="/blog/assets/js/7583.2af54276.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_é¢è¯•é¢˜_6.Javaä¸­çš„å‚æ•°ä¼ é€’æ˜¯æŒ‰å€¼è¿˜æ˜¯æŒ‰å¼•ç”¨.html.9a101d1e.js" as="script"><link rel="prefetch" href="/blog/assets/js/Mybatis_Mybatis Plus_wrapper.and().html.8316c195.js" as="script"><link rel="prefetch" href="/blog/assets/js/SpringCloud_Nacos_2.é…ç½®ä¸­å¿ƒ.html.aff6406f.js" as="script"><link rel="prefetch" href="/blog/assets/js/7096.76bb9882.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_å¼‚å¸¸_try-with-resourcesè‡ªåŠ¨å…³é—­èµ„æº.html.c0f5e20e.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_é¢è¯•é¢˜_8.Javaé¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹ç¼–ç¨‹çš„åŒºåˆ«.html.4a574a8b.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_é¢è¯•é¢˜_9.Javaæ–¹æ³•é‡è½½å’Œé‡å†™ä¹‹é—´çš„åŒºåˆ«.html.3b51d378.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_é¢è¯•é¢˜_11.Java8æ–°ç‰¹æ€§.html.2a755e18.js" as="script"><link rel="prefetch" href="/blog/assets/js/SpringCloud_ES_10.åˆ†é¡µ.html.f3208d7c.js" as="script"><link rel="prefetch" href="/blog/assets/js/Linux_initå‘½ä»¤è¯¦è§£.html.6eddb804.js" as="script"><link rel="prefetch" href="/blog/assets/js/Linux_æŸ¥çœ‹ç³»ç»Ÿé…ç½®.html.20946ee0.js" as="script"><link rel="prefetch" href="/blog/assets/js/Bug_mavenåˆ·æ–°æ—¶è¯­è¨€åŸºæœ¬é‡ç½®é—®é¢˜.html.2a12ea41.js" as="script"><link rel="prefetch" href="/blog/assets/js/MQ_å®‰è£…_RabbitMQéƒ¨ç½²æŒ‡å—.html.cd5eeb76.js" as="script"><link rel="prefetch" href="/blog/assets/js/Linux_æŸ¥è¯¢å®‰è£…ä½ç½®.html.b8eefb00.js" as="script"><link rel="prefetch" href="/blog/assets/js/Docker_æŸ¥çœ‹é•œåƒæ¶æ„.html.10357f4f.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_é¢è¯•é¢˜_15.Javaä¸­çš„hashCodeå’Œequalsæ–¹æ³•ä¹‹é—´æœ‰ä»€ä¹ˆå…³ç³».html.2e932c71.js" as="script"><link rel="prefetch" href="/blog/assets/js/è£…æœº_ç”µè„‘è£…æœºè¿›é˜¶.html.5e9be82c.js" as="script"><link rel="prefetch" href="/blog/assets/js/7124.11cc5132.js" as="script"><link rel="prefetch" href="/blog/assets/js/Docker_Dockeræ„å»ºSpringBooté•œåƒ.html.1153102f.js" as="script"><link rel="prefetch" href="/blog/assets/js/Spring_Junit_ç”Ÿå‘½å‘¨æœŸæ³¨è§£.html.1bdb2e35.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_MySQL_æ•°æ®åº“å®‰å…¨é…ç½®.html.e376f41b.js" as="script"><link rel="prefetch" href="/blog/assets/js/é¡¹ç›®å®æˆ˜_è°·ç²’å•†åŸ_æŠ¥é”™è®°å½•_äººäººåå°æ³¨å†Œè‡³Nacosç‰ˆæœ¬é—®é¢˜.html.af926e49.js" as="script"><link rel="prefetch" href="/blog/assets/js/Docker_é•œåƒå¯¼å…¥å¯¼å‡º.html.5f253910.js" as="script"><link rel="prefetch" href="/blog/assets/js/SpringCloud_ES_9.copy_toçš„ç”¨æ³•.html.7ebddff9.js" as="script"><link rel="prefetch" href="/blog/assets/js/Netty_API_API.html.b6083a6f.js" as="script"><link rel="prefetch" href="/blog/assets/js/Docker_ç§æœ‰äº‘_ç§æœ‰äº‘éƒ¨ç½²è½¯ä»¶.html.3c90a77e.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_MySQL_MySQL8.0å®‰è£….html.4525ff6e.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_å…¥é—¨åˆ°èµ·é£_35.åå°„_åŠ¨æ€ä»£ç†_getMethods()å’ŒgetDeclaredMethods()çš„åŒºåˆ«.html.dd711d53.js" as="script"><link rel="prefetch" href="/blog/assets/js/Mybatis_Mybatis Plus_æ–°ç‰ˆåˆ†é¡µæ’ä»¶.html.02583fc7.js" as="script"><link rel="prefetch" href="/blog/assets/js/Spring_æ³¨è§£_@FeignClient.html.8131e0f8.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_å…¥é—¨åˆ°èµ·é£_35.åå°„_åŠ¨æ€ä»£ç†_getDeclaredField()å’ŒgetField()åŒºåˆ«.html.a09b9582.js" as="script"><link rel="prefetch" href="/blog/assets/js/Docker_Dockerå®¹å™¨ä¸å®¿ä¸»æœºæ—¶é—´åŒæ­¥.html.1fc5ee0a.js" as="script"><link rel="prefetch" href="/blog/assets/js/VCS_Git_æœ¬åœ°é¡¹ç›®æ¨é€è‡³è¿œç¨‹åº“.html.d6f5baa6.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_MySQL_Navicatè¿æ¥mysqlæŠ¥é”™.html.512c7bbd.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_MySQL_æ•°æ®åº“éš”ç¦»çº§åˆ«.html.7eee0d67.js" as="script"><link rel="prefetch" href="/blog/assets/js/Linux_ç¡¬ç›˜æŒ‚è½½.html.62094ba5.js" as="script"><link rel="prefetch" href="/blog/assets/js/JVM_cpu loadè¿‡é«˜é—®é¢˜.html.45b4ecb3.js" as="script"><link rel="prefetch" href="/blog/assets/js/Netty_é‡Šæ”¾ByteBuf.html.44e0a802.js" as="script"><link rel="prefetch" href="/blog/assets/js/Spring_æ³¨è§£_æ³¨è§£@RequestMappingã€@PostMappingã€@GetMapping.html.f404d701.js" as="script"><link rel="prefetch" href="/blog/assets/js/SpringCloud_ES_7.åˆ›å»ºç´¢å¼•åº“.html.33a666de.js" as="script"><link rel="prefetch" href="/blog/assets/js/Docker_ç§æœ‰äº‘_å‰åç«¯åˆ†ç¦»åšå®¢é¡¹ç›®.html.0a2379dd.js" as="script"><link rel="prefetch" href="/blog/assets/js/Kafka_å‘é€æ¥æ”¶demo.html.9d3492c6.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_é¢è¯•é¢˜_14.Java ä¸­ hashCode_equals æ–¹æ³•å’Œ__ æ“ä½œç¬¦.html.d108af7c.js" as="script"><link rel="prefetch" href="/blog/assets/js/Linux_systemctl.html.943b2d37.js" as="script"><link rel="prefetch" href="/blog/assets/js/JVM_GCç±»å‹.html.aa160a2c.js" as="script"><link rel="prefetch" href="/blog/assets/js/SpringCloud_ES_1.ä»€ä¹ˆæ˜¯ES.html.58a2950c.js" as="script"><link rel="prefetch" href="/blog/assets/js/1434.900263ce.js" as="script"><link rel="prefetch" href="/blog/assets/js/JVM_OOM.html.f16ec43b.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_MySQL_MySQL æ•°æ®åº“æˆæƒç®¡ç†.html.4e618597.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_é¢è¯•é¢˜_4.Javaçš„ä¼˜åŠ¿.html.485203fd.js" as="script"><link rel="prefetch" href="/blog/assets/js/Netty_å…³é—­äº‹ä»¶å¾ªç¯ç»„.html.b6361960.js" as="script"><link rel="prefetch" href="/blog/assets/js/1316.26df1e75.js" as="script"><link rel="prefetch" href="/blog/assets/js/Netty_æ ¸å¿ƒæ¦‚å¿µç†è§£.html.54df7095.js" as="script"><link rel="prefetch" href="/blog/assets/js/2275.dcc4168e.js" as="script"><link rel="prefetch" href="/blog/assets/js/Linux_è½¯ç¡¬é“¾æ¥.html.9a9c74bb.js" as="script"><link rel="prefetch" href="/blog/assets/js/1317.10732497.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_é¢è¯•é¢˜_10.Javaå†…éƒ¨ç±»åŠä½œç”¨.html.e3805bef.js" as="script"><link rel="prefetch" href="/blog/assets/js/6873.b44a0bdd.js" as="script"><link rel="prefetch" href="/blog/assets/js/SpringCloud_Nacos_3.ç½‘å…³é…ç½®.html.eb8419ea.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_é¢è¯•é¢˜_12.JDKå’ŒJREåŒºåˆ«.html.2fbbf32e.js" as="script"><link rel="prefetch" href="/blog/assets/js/ç½‘ç»œ_L2TPå’ŒIPsecåè®®å¸¸è§è½¯ä»¶å’Œå·¥å…·.html.c2b212ad.js" as="script"><link rel="prefetch" href="/blog/assets/js/Docker_pull.html.13c45d2c.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_MySQL_unionå’Œunion all.html.337c3a6d.js" as="script"><link rel="prefetch" href="/blog/assets/js/Spring_SpringBootæ— æ•°æ®æºå¯åŠ¨.html.acf02851.js" as="script"><link rel="prefetch" href="/blog/assets/js/Linux_Ubuntuå‘½ä»¤è¡Œå›¾å½¢åŒ–ç•Œé¢åˆ‡æ¢.html.2bb8174e.js" as="script"><link rel="prefetch" href="/blog/assets/js/Mybatis_Mybatis_é€»è¾‘åˆ é™¤.html.5fbb6102.js" as="script"><link rel="prefetch" href="/blog/assets/js/5663.892fda56.js" as="script"><link rel="prefetch" href="/blog/assets/js/Netty_API_ExecutorService.html.48a71b7f.js" as="script"><link rel="prefetch" href="/blog/assets/js/é¡¹ç›®å®æˆ˜_è°·ç²’å•†åŸ_å…³é—­eslintæ£€æŸ¥.html.18380527.js" as="script"><link rel="prefetch" href="/blog/assets/js/ç½‘ç»œ_L2TPIPsec.html.6d3280c8.js" as="script"><link rel="prefetch" href="/blog/assets/js/VCS_Git_å¿½ç•¥æ–‡ä»¶å¤¹.html.ac495ac2.js" as="script"><link rel="prefetch" href="/blog/assets/js/Spring_æ³¨è§£_@ResponseBody.html.45cbaf09.js" as="script"><link rel="prefetch" href="/blog/assets/js/1901.74b1b7c6.js" as="script"><link rel="prefetch" href="/blog/assets/js/é¡¹ç›®å®æˆ˜_è°·ç²’å•†åŸ_æŠ¥é”™è®°å½•_äººäººå‰ç«¯å¯åŠ¨å¤±è´¥.html.7897e455.js" as="script"><link rel="prefetch" href="/blog/assets/js/Linux_dos2unixæ¢è¡Œç¬¦æ¸…ç†.html.bb57a70f.js" as="script"><link rel="prefetch" href="/blog/assets/js/Docker_ç‰¹æƒæ¨¡å¼.html.b54d6ec1.js" as="script"><link rel="prefetch" href="/blog/assets/js/Linux_å•ç”¨æˆ·æ¨¡å¼é‡ç½®å¯†ç .html.0a1cbbe6.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_é¢è¯•é¢˜_7.Javaä¸æ”¯æŒå¤šé‡ç»§æ‰¿.html.c4aab9e9.js" as="script"><link rel="prefetch" href="/blog/assets/js/JVM_2.1.å¹´è½»ä»£è€å¹´ä»£.html.1042ed71.js" as="script"><link rel="prefetch" href="/blog/assets/js/Nginx_413 (Request Entity Too Large).html.912e4bfe.js" as="script"><link rel="prefetch" href="/blog/assets/js/Spring_æ³¨è§£_@JsonFormat.html.19e18701.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_é¢è¯•é¢˜_1.åºåˆ—åŒ–ä¸ååºåˆ—åŒ–.html.ac0204f4.js" as="script"><link rel="prefetch" href="/blog/assets/js/è£…æœº_ç”µè„‘é…ç½®.html.2d433981.js" as="script"><link rel="prefetch" href="/blog/assets/js/JVM_2.å†…å­˜ç»“æ„_2.2è™šæ‹Ÿæœºæ ˆ.html.5fd3fbaa.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_MySQL_mysql -uroot -pæŠ¥é”™.html.1969cf2a.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_å…¥é—¨åˆ°èµ·é£_35.åå°„_åŠ¨æ€ä»£ç†_å­—èŠ‚ç å¯¹è±¡.html.fd7eca29.js" as="script"><link rel="prefetch" href="/blog/assets/js/Docker_å®‰è£…NocoDB.html.da927285.js" as="script"><link rel="prefetch" href="/blog/assets/js/Linux_ä¸»è¦æ¶æ„.html.fba20772.js" as="script"><link rel="prefetch" href="/blog/assets/js/5292.04bf372b.js" as="script"><link rel="prefetch" href="/blog/assets/js/ç½‘ç»œ_åˆ·æ–°dnsç¼“å­˜.html.58ebd8d2.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_MySQL_caching_sha2_passwordæ— æ³•åŠ è½½.html.44c79a37.js" as="script"><link rel="prefetch" href="/blog/assets/js/Mybatis_Mybatis Plus_åŠ¨æ€æ„å»ºæŸ¥è¯¢æ¡ä»¶.html.6af3a6bd.js" as="script"><link rel="prefetch" href="/blog/assets/js/å‰ç«¯_node_nvmæ›´æ¢é•œåƒæº.html.b2acda58.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_é¢è¯•é¢˜_2.ä¸å¯å˜ç±».html.9648a76a.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_é¢è¯•é¢˜_13.ä½ ä½¿ç”¨è¿‡å“ªäº›JDKå·¥å…·.html.5487d6d4.js" as="script"><link rel="prefetch" href="/blog/assets/js/Mybatis_Mybatis Plus_QueryWrapper vs LambdaQueryWrapper.html.1bbe33c9.js" as="script"><link rel="prefetch" href="/blog/assets/js/SpringCloud_ES_3.åŸºæœ¬æ¦‚å¿µ.html.660d0325.js" as="script"><link rel="prefetch" href="/blog/assets/js/SpringCloud_Nacos_0.å®‰è£…ä¸å¯åŠ¨.html.127ff4b2.js" as="script"><link rel="prefetch" href="/blog/assets/js/Mybatis_Mybatis Plus_queryWrapperè‡ªå®šä¹‰SQL.html.d29425b9.js" as="script"><link rel="prefetch" href="/blog/assets/js/Docker_å®‰è£…Nginx.html.5bc94679.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_é¢è¯•é¢˜_3.Exceptionå’ŒErrorçš„åŒºåˆ«.html.642943ab.js" as="script"><link rel="prefetch" href="/blog/assets/js/Spring_Spring5.xæ¦‚è¿°.html.146e06b2.js" as="script"><link rel="prefetch" href="/blog/assets/js/Mybatis_Mybatis Plus_where 1_1.html.e7ba1354.js" as="script"><link rel="prefetch" href="/blog/assets/js/Python_åŸºç¡€_0.å‰è¨€.html.acc52c21.js" as="script"><link rel="prefetch" href="/blog/assets/js/JVM_2.å†…å­˜ç»“æ„_2.3æœ¬åœ°æ–¹æ³•æ ˆ.html.b1c87b2f.js" as="script"><link rel="prefetch" href="/blog/assets/js/SpringCloud_Nacos_1.æ³¨å†Œä¸­å¿ƒ.html.01db50f3.js" as="script"><link rel="prefetch" href="/blog/assets/js/JVM_2.å†…å­˜ç»“æ„_2.1ç¨‹åºè®¡æ•°å™¨.html.58e42edd.js" as="script"><link rel="prefetch" href="/blog/assets/js/Linux_daemon-reload.html.52c2b3c8.js" as="script"><link rel="prefetch" href="/blog/assets/js/å‰ç«¯_node_npmæ›´æ¢é•œåƒæº.html.03210df9.js" as="script"><link rel="prefetch" href="/blog/assets/js/4903.a7f55910.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_å”¯æ‰‹ç†Ÿå°”_equalsä¸ç­‰å·.html.ea8205fc.js" as="script"><link rel="prefetch" href="/blog/assets/js/é¡¹ç›®å®æˆ˜_è°·ç²’å•†åŸ_è·¨åŸŸ.html.3ca09a15.js" as="script"><link rel="prefetch" href="/blog/assets/js/2916.54fd14b9.js" as="script"><link rel="prefetch" href="/blog/assets/js/Linux_rc.local.html.dce6a976.js" as="script"><link rel="prefetch" href="/blog/assets/js/SpringCloud_ES_5.åˆ†è¯å™¨.html.906079c0.js" as="script"><link rel="prefetch" href="/blog/assets/js/JVM_2.å†…å­˜ç»“æ„_2.4å †.html.3d47aef7.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_ç©ºå€¼å’Œnullå€¼.html.28428b3b.js" as="script"><link rel="prefetch" href="/blog/assets/js/2240.bce1f31c.js" as="script"><link rel="prefetch" href="/blog/assets/js/JVM_2.å†…å­˜ç»“æ„.html.777fb4bd.js" as="script"><link rel="prefetch" href="/blog/assets/js/SpringCloud_Nacos_4.NacosæŒ‡å®šæœåŠ¡ç«¯IP.html.ddbe5bb4.js" as="script"><link rel="prefetch" href="/blog/assets/js/Linux_reset-failed.html.8cb1a230.js" as="script"><link rel="prefetch" href="/blog/assets/js/JVM_1.å­¦ä¹ JVMæœ‰ä»€ä¹ˆç”¨.html.3fd418be.js" as="script"><link rel="prefetch" href="/blog/assets/js/SpringCloud_ES_6.mappingå¸¸è§å±æ€§.html.16cc740c.js" as="script"><link rel="prefetch" href="/blog/assets/js/é¡¹ç›®å®æˆ˜_è°·ç²’å•†åŸ_æŠ¥é”™è®°å½•_å®šæ—¶ä»»åŠ¡å¯åŠ¨å¤±è´¥.html.c9ede50f.js" as="script"><link rel="prefetch" href="/blog/assets/js/SpringCloud_ES_2.å€’æ’ç´¢å¼•.html.34dc3c09.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_String_isNotEmptyå’ŒisNotBlank.html.369d75b1.js" as="script"><link rel="prefetch" href="/blog/assets/js/é¡¹ç›®å®æˆ˜_è°·ç²’å•†åŸ_æŠ¥é”™è®°å½•_SpringBootè¯»å–ValidationMessages.propertiesï¼Œä¸­æ–‡ä¹±ç .html.80534b5d.js" as="script"><link rel="prefetch" href="/blog/assets/js/è£…æœº_é£ç‰›OSå¼€å…³å±å¹•.html.df8a90f8.js" as="script"><link rel="prefetch" href="/blog/assets/js/é¡¹ç›®å®æˆ˜_è°·ç²’å•†åŸ_æŠ¥é”™è®°å½•_æ‰¾ä¸åˆ°ç¬¦å·.html.513b96a5.js" as="script"><link rel="prefetch" href="/blog/assets/js/Vue_index.html.ef46c87d.js" as="script"><link rel="prefetch" href="/blog/assets/js/é¡¹ç›®å®æˆ˜_è°·ç²’å•†åŸ_æŠ¥é”™è®°å½•_æœåŠ¡åˆ—è¡¨ä¸ºç©º.html.886f08cd.js" as="script"><link rel="prefetch" href="/blog/assets/js/é¡¹ç›®å®æˆ˜_è°·ç²’å•†åŸ_è§†é¢‘æ•™ç¨‹.html.2907938f.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_index.html.66480ff7.js" as="script"><link rel="prefetch" href="/blog/assets/js/JVM_index.html.321cad3e.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_Redis_è§†é¢‘æ•™ç¨‹.html.c9df6dec.js" as="script"><link rel="prefetch" href="/blog/assets/js/SpringCloud_ES_è§†é¢‘æ•™ç¨‹.html.3ab2596f.js" as="script"><link rel="prefetch" href="/blog/assets/js/Netty_1.é»‘é©¬è§†é¢‘æ•™ç¨‹.html.7e82ef4b.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_é›·ä¸°é˜³Javaè§†é¢‘.html.624075ac.js" as="script"><link rel="prefetch" href="/blog/assets/js/index.html.adacdc5f.js" as="script"><link rel="prefetch" href="/blog/assets/js/Spring_æ³¨è§£_@JsonInclude.html.653d1397.js" as="script"><link rel="prefetch" href="/blog/assets/js/JVM_é»‘é©¬JVM.html.b85683b8.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_å…¥é—¨åˆ°èµ·é£_35.åå°„_åŠ¨æ€ä»£ç†_æ€»ç»“-åå°„.html.971bb632.js" as="script"><link rel="prefetch" href="/blog/assets/js/676.f6b4bdac.js" as="script"><link rel="prefetch" href="/blog/assets/js/3021.ce68dc19.js" as="script"><link rel="prefetch" href="/blog/assets/js/Python_åŸºç¡€_video.html.9b030552.js" as="script"><link rel="prefetch" href="/blog/assets/js/Docker_æŸ¥çœ‹æ•°æ®å·ç›®å½•.html.b5028198.js" as="script"><link rel="prefetch" href="/blog/assets/js/é¡¹ç›®å®æˆ˜_è°·ç²’å•†åŸ_index.html.fceca5fa.js" as="script"><link rel="prefetch" href="/blog/assets/js/3160.07cf795c.js" as="script"><link rel="prefetch" href="/blog/assets/js/intro.html.eb10c17a.js" as="script"><link rel="prefetch" href="/blog/assets/js/SpringCloud_Nacos_index.html.aa010d8d.js" as="script"><link rel="prefetch" href="/blog/assets/js/8984.f327bcec.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_Redis_3.é«˜çº§_Redisé«˜çº§ç¯‡-åˆ†å¸ƒå¼ç¼“å­˜_index.html.9f779adb.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_Redis_3.é«˜çº§_Redisé«˜çº§ç¯‡-å¤šçº§ç¼“å­˜_index.html.0db87aa4.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_Redis_3.é«˜çº§_Redisé«˜çº§ç¯‡-æœ€ä½³å®è·µ_index.html.35046b76.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_å…¥é—¨åˆ°èµ·é£_35.åå°„_åŠ¨æ€ä»£ç†_index.html.7900a388.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_ä½¿ç”¨æŒ‡å—_index.html.15682873.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_åŸºç¡€çŸ¥è¯†_index.html.d9dca968.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_æ¥å£æ–‡æ¡£_index.html.2bf0a2c9.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_ç½‘ç»œç¼–ç¨‹_index.html.8b878662.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_æ¥å£ç¤ºä¾‹_index.html.78dafb18.js" as="script"><link rel="prefetch" href="/blog/assets/js/é¡¹ç›®å®æˆ˜_è°·ç²’å•†åŸ_æŠ¥é”™è®°å½•_index.html.0c1a0ad9.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_ä¸­é—´ä»¶_index.html.f2830b49.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_æ•°æ®åº“_index.html.83e606c4.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_mybatis-plus_index.html.553ee89d.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_java8ç‰¹æ€§_index.html.778a77f2.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_Redis_3.é«˜çº§_01-åˆ†å¸ƒå¼ç¼“å­˜_index.html.5ca25fee.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_Redis_3.é«˜çº§_03-Redisæœ€ä½³å®è·µ_index.html.cec32d66.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_ç§æœ‰äº‘_index.html.d8414901.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_å®æˆ˜_index.html.c09924e0.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_è£…æœº_index.html.93f0c6fb.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_é¡¹ç›®_index.html.bf862a53.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_ç½‘ç»œ_index.html.d970dca5.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_seåŸºç¡€_index.html.6d85fb36.js" as="script"><link rel="prefetch" href="/blog/assets/js/Python_index.html.4489feaa.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_markdown_index.html.162868dd.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_Redis_3.é«˜çº§_02-å¤šçº§ç¼“å­˜_index.html.908be1fb.js" as="script"><link rel="prefetch" href="/blog/assets/js/é¡¹ç›®å®æˆ˜_è°·ç²’å•†åŸ_æ¿ä¹¦_index.html.9c5f3e8b.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_mybatis_index.html.73643351.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_äº‹åŠ¡_index.html.c225d2f9.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_ä½¿ç”¨_index.html.38cceecc.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_å…¥é—¨_index.html.6147ae8a.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_åå°„_index.html.e35de83b.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_å‘½ä»¤_index.html.41af61e5.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_å‘ç‹_index.html.739d7035.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_åŸºç¡€_index.html.db72b8f5.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_å®‰å…¨_index.html.5dac244d.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_å®‰è£…_index.html.12b854af.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_å®¹å™¨_index.html.d31799bc.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_å¿…èƒŒ_index.html.6f933a9f.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_æ€»ç»“_index.html.4680839b.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_æ•™ç¨‹_index.html.8d1430cd.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_æŸ¥è¯¢_index.html.8bf196b3.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_çˆ¬è™«_index.html.21da8848.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_ç»éªŒ_index.html.974ff28a.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_ç½‘ç»œ_index.html.8b8ee87a.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_è£…æœº_index.html.ba26b8cb.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_è¸©å‘_index.html.c63ad2d7.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_é‡ç‚¹_index.html.59ce28cd.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_é•œåƒ_index.html.0e33acf4.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_äº†è§£_index.html.d4aa36ec.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_æ’ä»¶_index.html.16f4eb57.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_æ³¨è§£_index.html.5aade75e.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_è®²ä¹‰_index.html.9e7218df.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_docker_index.html.2e14cb66.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_python_index.html.b951ceee.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_spring_index.html.2fdc451d.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_linux_index.html.8a4f9501.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_mysql_index.html.f44858d2.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_nacos_index.html.c1176a12.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_netty_index.html.596d6814.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_nginx_index.html.f79a37ec.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_MySQL_index.html.02d091d6.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_Redis_index.html.b458862f.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_redis_index.html.a0c14348.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_java_index.html.26ea9dad.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_git_index.html.18e44b64.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_vue_index.html.10b01273.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_error_index.html.1a92c661.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_jvm_index.html.1e172f72.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_es_index.html.51e56dde.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_å…¥é—¨åˆ°èµ·é£_index.html.374fb090.js" as="script"><link rel="prefetch" href="/blog/assets/js/Spring_index.html.7d26b6ae.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_bug_index.html.832a7460.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_git_index.html.1b7b423e.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_api_index.html.9a33c798.js" as="script"><link rel="prefetch" href="/blog/assets/js/Linux_index.html.8a714ffc.js" as="script"><link rel="prefetch" href="/blog/assets/js/Netty_index.html.7712d32e.js" as="script"><link rel="prefetch" href="/blog/assets/js/Nginx_index.html.7ec5b5ac.js" as="script"><link rel="prefetch" href="/blog/assets/js/5152.9b4917b0.js" as="script"><link rel="prefetch" href="/blog/assets/js/JVM_2.å†…å­˜ç»“æ„_index.html.5a87fb04.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_å”¯æ‰‹ç†Ÿå°”_index.html.55c9f4f4.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_index.html.6d98fdff.js" as="script"><link rel="prefetch" href="/blog/assets/js/é¡¹ç›®å®æˆ˜_index.html.43097ba4.js" as="script"><link rel="prefetch" href="/blog/assets/js/timeline_index.html.e240e64f.js" as="script"><link rel="prefetch" href="/blog/assets/js/è®¾è®¡æ¨¡å¼_index.html.01c227ed.js" as="script"><link rel="prefetch" href="/blog/assets/js/Docker_index.html.1c24ae43.js" as="script"><link rel="prefetch" href="/blog/assets/js/Mybatis_Mybatis Plus_æ¥å£_index.html.930c6bbc.js" as="script"><link rel="prefetch" href="/blog/assets/js/Mybatis_Mybatis Plus_æ³¨è§£_index.html.c3dc67cf.js" as="script"><link rel="prefetch" href="/blog/assets/js/Docker_ç§æœ‰äº‘_index.html.63a173fa.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_Redis_2.å®æˆ˜_index.html.90f3d437.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_Redis_3.é«˜çº§_index.html.29b8dd98.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_Redis_4.åŸç†_index.html.aaea0fa5.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_index.html.2856d096.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_Redis_1.å…¥é—¨_index.html.dd0f0619.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_Java8ç‰¹æ€§_index.html.d72cbe6b.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_é¢è¯•é¢˜_index.html.acf47f33.js" as="script"><link rel="prefetch" href="/blog/assets/js/article_index.html.751f09ca.js" as="script"><link rel="prefetch" href="/blog/assets/js/Mybatis_Mybatis Plus_index.html.8a0b7e52.js" as="script"><link rel="prefetch" href="/blog/assets/js/SpringCloud_Alibaba-OSS_index.html.80eb9229.js" as="script"><link rel="prefetch" href="/blog/assets/js/star_index.html.5be1e703.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_MySQL_åŸºç¡€_index.html.88420d5f.js" as="script"><link rel="prefetch" href="/blog/assets/js/Spring MVC_æ ¡éªŒ_index.html.75ad0031.js" as="script"><link rel="prefetch" href="/blog/assets/js/Python_åŸºç¡€_index.html.8e89b3e3.js" as="script"><link rel="prefetch" href="/blog/assets/js/Spring_æ³¨è§£_index.html.f1c61be8.js" as="script"><link rel="prefetch" href="/blog/assets/js/Python_çˆ¬è™«_index.html.9ec4840d.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_å¼‚å¸¸_index.html.1a9a195d.js" as="script"><link rel="prefetch" href="/blog/assets/js/SpringCloud_index.html.a8f14d98.js" as="script"><link rel="prefetch" href="/blog/assets/js/MQ_å®‰è£…_index.html.e7fe3e07.js" as="script"><link rel="prefetch" href="/blog/assets/js/å‰ç«¯_node_index.html.2d0eb6ef.js" as="script"><link rel="prefetch" href="/blog/assets/js/Spring MVC_index.html.e14ffd3a.js" as="script"><link rel="prefetch" href="/blog/assets/js/å‰ç«¯_index.html.2ae3735e.js" as="script"><link rel="prefetch" href="/blog/assets/js/ç½‘ç»œ_index.html.d6e74500.js" as="script"><link rel="prefetch" href="/blog/assets/js/è£…æœº_index.html.33575e43.js" as="script"><link rel="prefetch" href="/blog/assets/js/Mybatis_Mybatis_index.html.9590d4b2.js" as="script"><link rel="prefetch" href="/blog/assets/js/Database_index.html.eba4d359.js" as="script"><link rel="prefetch" href="/blog/assets/js/Java_String_index.html.23f21b58.js" as="script"><link rel="prefetch" href="/blog/assets/js/Mybatis_index.html.9686664e.js" as="script"><link rel="prefetch" href="/blog/assets/js/Spring_Junit_index.html.9f6c55e3.js" as="script"><link rel="prefetch" href="/blog/assets/js/SpringCloud_ES_index.html.42ab127b.js" as="script"><link rel="prefetch" href="/blog/assets/js/Netty_API_index.html.f35cb00b.js" as="script"><link rel="prefetch" href="/blog/assets/js/Kafka_index.html.45d3f2ae.js" as="script"><link rel="prefetch" href="/blog/assets/js/VCS_Git_index.html.333fcf10.js" as="script"><link rel="prefetch" href="/blog/assets/js/VCS_index.html.41c61607.js" as="script"><link rel="prefetch" href="/blog/assets/js/404.html.bc037f5e.js" as="script"><link rel="prefetch" href="/blog/assets/js/Bug_index.html.60f880e4.js" as="script"><link rel="prefetch" href="/blog/assets/js/MQ_index.html.03446d9b.js" as="script"><link rel="prefetch" href="/blog/assets/js/2666.71fedeaa.js" as="script"><link rel="prefetch" href="/blog/assets/js/8070.f013b580.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/blog/" aria-label="å¸¦æˆ‘å›å®¶"><img class="vp-nav-logo" src="/blog/assets/images/avatar.png" alt><!----><span class="vp-site-name hide-in-pad">å°æ»¡</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/blog/" aria-label="ä¸»é¡µ"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="åç«¯"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-code" style=""></span>åç«¯<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/blog/Java/" aria-label="Java"><!--[--><span class="font-icon icon fa-fw fa-sm fa-brands fa-java" style=""></span><!--]-->Java<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/blog/Python/" aria-label="Python"><!--[--><span class="font-icon icon fa-fw fa-sm fa-brands fa-python" style=""></span><!--]-->Python<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/blog/JVM/" aria-label="JVM"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-microchip" style=""></span><!--]-->JVM<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/blog/Vue/" aria-label="Vue"><!--[--><span class="font-icon icon fa-fw fa-sm fa-brands fa-vuejs" style=""></span><!--]-->Vue<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Spring"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-leaf" style=""></span>Spring<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/blog/Spring/" aria-label="Spring"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-leaf" style=""></span><!--]-->Spring<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="SpringCloud"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-cloud" style=""></span>SpringCloud<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/blog/SpringCloud/Nacos/" aria-label="Nacos"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-cloud" style=""></span><!--]-->Nacos<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/blog/SpringCloud/ES/" aria-label="Nacos"><!--[--><span class="font-icon icon fa-fw fa-sm fa-brands fa-searchengin" style=""></span><!--]-->Nacos<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="æ•°æ®åº“"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-database" style=""></span>æ•°æ®åº“<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/blog/Database/MySQL/" aria-label="MySQL"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-database" style=""></span><!--]-->MySQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/blog/Database/Redis/" aria-label="Redis"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-server" style=""></span><!--]-->Redis<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/blog/Docker/" aria-label="Docker"><!--[--><span class="font-icon icon fa-fw fa-sm fa-brands fa-docker" style=""></span><!--]-->Docker<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Linux"><!--[--><span class="font-icon icon fa-fw fa-sm fa-brands fa-linux" style=""></span>Linux<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/blog/Linux/" aria-label="Linux"><!--[--><span class="font-icon icon fa-fw fa-sm fa-brands fa-linux" style=""></span><!--]-->Linux<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/blog/Netty/" aria-label="Netty"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-n" style=""></span><!--]-->Netty<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="é¡¹ç›®å®æˆ˜"><!--[--><span class="font-icon icon fa-fw fa-sm fa-brands fa-product-hunt" style=""></span>é¡¹ç›®å®æˆ˜<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/blog/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/" aria-label="è°·ç²’å•†åŸ"><!--[--><span class="font-icon icon fa-fw fa-sm fa-brands fa-codepen" style=""></span><!--]-->è°·ç²’å•†åŸ<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="auto-link external-link" href="http://blog.xiaoxiongmaococo.com:92/#/" aria-label="blog" rel="noopener noreferrer" target="_blank"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-blog" style=""></span><!--]-->blog<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/JL-20191210/blog" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="æœç´¢" autocomplete="off" spellcheck="false" value><!----></form><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">MySQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Redis</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/blog/Database/Redis/" aria-label="Redis"><!---->Redis<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">1.å…¥é—¨</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2.å®æˆ˜</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">3.é«˜çº§</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">01 åˆ†å¸ƒå¼ç¼“å­˜</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">02 å¤šçº§ç¼“å­˜</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">03 Redisæœ€ä½³å®è·µ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Redisé«˜çº§ç¯‡ æœ€ä½³å®è·µ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Redisé«˜çº§ç¯‡ åˆ†å¸ƒå¼ç¼“å­˜</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Redisé«˜çº§ç¯‡ å¤šçº§ç¼“å­˜</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/blog/Database/Redis/3.%E9%AB%98%E7%BA%A7/Redis%E9%AB%98%E7%BA%A7%E7%AF%87-%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98.html" aria-label="å¤šçº§ç¼“å­˜"><!---->å¤šçº§ç¼“å­˜<!----></a></li></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">4.åŸç†</span><span class="vp-arrow end"></span></button><!----></section></li><li><a class="route-link auto-link vp-sidebar-link" href="/blog/Database/Redis/%E8%A7%86%E9%A2%91%E6%95%99%E7%A8%8B.html" aria-label="è§†é¢‘æ•™ç¨‹"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-play" style=""></span><!--]-->è§†é¢‘æ•™ç¨‹<!----></a></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->å¤šçº§ç¼“å­˜</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">æ¥æ¯å†°æŸ æª¬</span></span><span property="author" content="æ¥æ¯å†°æŸ æª¬"></span></span><!----><!----><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 29 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT29M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2-1-å¯¼å…¥æ¡ˆä¾‹">2.1.å¯¼å…¥æ¡ˆä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2-2-åˆè¯†caffeine">2.2.åˆè¯†Caffeine</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2-3-å®ç°jvmè¿›ç¨‹ç¼“å­˜">2.3.å®ç°JVMè¿›ç¨‹ç¼“å­˜</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-3-1-éœ€æ±‚">2.3.1.éœ€æ±‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-3-2-å®ç°">2.3.2.å®ç°</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3-1-åˆè¯†lua">3.1.åˆè¯†Lua</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3-1-helloworld">3.1.HelloWorld</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3-2-å˜é‡å’Œå¾ªç¯">3.2.å˜é‡å’Œå¾ªç¯</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-2-1-luaçš„æ•°æ®ç±»å‹">3.2.1.Luaçš„æ•°æ®ç±»å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-2-2-å£°æ˜å˜é‡">3.2.2.å£°æ˜å˜é‡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-2-3-å¾ªç¯">3.2.3.å¾ªç¯</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3-3-æ¡ä»¶æ§åˆ¶ã€å‡½æ•°">3.3.æ¡ä»¶æ§åˆ¶ã€å‡½æ•°</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-3-1-å‡½æ•°">3.3.1.å‡½æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-3-2-æ¡ä»¶æ§åˆ¶">3.3.2.æ¡ä»¶æ§åˆ¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-3-3-æ¡ˆä¾‹">3.3.3.æ¡ˆä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-1-å®‰è£…openresty">4.1.å®‰è£…OpenResty</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-2-openrestyå¿«é€Ÿå…¥é—¨">4.2.OpenRestyå¿«é€Ÿå…¥é—¨</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-2-1-åå‘ä»£ç†æµç¨‹">4.2.1.åå‘ä»£ç†æµç¨‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-2-2-openrestyç›‘å¬è¯·æ±‚">4.2.2.OpenRestyç›‘å¬è¯·æ±‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-2-3-ç¼–å†™item-lua">4.2.3.ç¼–å†™item.lua</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-3-è¯·æ±‚å‚æ•°å¤„ç†">4.3.è¯·æ±‚å‚æ•°å¤„ç†</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-3-1-è·å–å‚æ•°çš„api">4.3.1.è·å–å‚æ•°çš„API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-3-2-è·å–å‚æ•°å¹¶è¿”å›">4.3.2.è·å–å‚æ•°å¹¶è¿”å›</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-4-æŸ¥è¯¢tomcat">4.4.æŸ¥è¯¢Tomcat</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-4-1-å‘é€httpè¯·æ±‚çš„api">4.4.1.å‘é€httpè¯·æ±‚çš„API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-4-2-å°è£…httpå·¥å…·">4.4.2.å°è£…httpå·¥å…·</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-4-3-cjsonå·¥å…·ç±»">4.4.3.CJSONå·¥å…·ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-4-4-å®ç°tomcatæŸ¥è¯¢">4.4.4.å®ç°TomcatæŸ¥è¯¢</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-4-5-åŸºäºidè´Ÿè½½å‡è¡¡">4.4.5.åŸºäºIDè´Ÿè½½å‡è¡¡</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-5-redisç¼“å­˜é¢„çƒ­">4.5.Redisç¼“å­˜é¢„çƒ­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-6-æŸ¥è¯¢redisç¼“å­˜">4.6.æŸ¥è¯¢Redisç¼“å­˜</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-6-1-å°è£…rediså·¥å…·">4.6.1.å°è£…Rediså·¥å…·</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-6-2-å®ç°redisæŸ¥è¯¢">4.6.2.å®ç°RedisæŸ¥è¯¢</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-7-nginxæœ¬åœ°ç¼“å­˜">4.7.Nginxæœ¬åœ°ç¼“å­˜</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-7-1-æœ¬åœ°ç¼“å­˜api">4.7.1.æœ¬åœ°ç¼“å­˜API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-7-2-å®ç°æœ¬åœ°ç¼“å­˜æŸ¥è¯¢">4.7.2.å®ç°æœ¬åœ°ç¼“å­˜æŸ¥è¯¢</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_5-1-æ•°æ®åŒæ­¥ç­–ç•¥">5.1.æ•°æ®åŒæ­¥ç­–ç•¥</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_5-2-å®‰è£…canal">5.2.å®‰è£…Canal</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-2-1-è®¤è¯†canal">5.2.1.è®¤è¯†Canal</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-2-2-å®‰è£…canal">5.2.2.å®‰è£…Canal</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_5-3-ç›‘å¬canal">5.3.ç›‘å¬Canal</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-3-1-å¼•å…¥ä¾èµ–">5.3.1.å¼•å…¥ä¾èµ–ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-3-2-ç¼–å†™é…ç½®">5.3.2.ç¼–å†™é…ç½®ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-3-3-ä¿®æ”¹itemå®ä½“ç±»">5.3.3.ä¿®æ”¹Itemå®ä½“ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-3-4-ç¼–å†™ç›‘å¬å™¨">5.3.4.ç¼–å†™ç›‘å¬å™¨</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content" vp-content><h1 id="å¤šçº§ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#å¤šçº§ç¼“å­˜"><span>å¤šçº§ç¼“å­˜</span></a></h1><h1 id="_0-å­¦ä¹ ç›®æ ‡" tabindex="-1"><a class="header-anchor" href="#_0-å­¦ä¹ ç›®æ ‡"><span>0.å­¦ä¹ ç›®æ ‡</span></a></h1><h1 id="_1-ä»€ä¹ˆæ˜¯å¤šçº§ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_1-ä»€ä¹ˆæ˜¯å¤šçº§ç¼“å­˜"><span>1.ä»€ä¹ˆæ˜¯å¤šçº§ç¼“å­˜</span></a></h1><p>ä¼ ç»Ÿçš„ç¼“å­˜ç­–ç•¥ä¸€èˆ¬æ˜¯è¯·æ±‚åˆ°è¾¾Tomcatåï¼Œå…ˆæŸ¥è¯¢Redisï¼Œå¦‚æœæœªå‘½ä¸­åˆ™æŸ¥è¯¢æ•°æ®åº“ï¼Œå¦‚å›¾ï¼š</p><figure><img src="/blog/assets/img/image-20210821075259137.cbd78d2a.png" alt="image-20210821075259137" tabindex="0" loading="lazy"><figcaption>image-20210821075259137</figcaption></figure><p>å­˜åœ¨ä¸‹é¢çš„é—®é¢˜ï¼š</p><p>â€¢è¯·æ±‚è¦ç»è¿‡Tomcatå¤„ç†ï¼ŒTomcatçš„æ€§èƒ½æˆä¸ºæ•´ä¸ªç³»ç»Ÿçš„ç“¶é¢ˆ</p><p>â€¢Redisç¼“å­˜å¤±æ•ˆæ—¶ï¼Œä¼šå¯¹æ•°æ®åº“äº§ç”Ÿå†²å‡»</p><p>å¤šçº§ç¼“å­˜å°±æ˜¯å……åˆ†åˆ©ç”¨è¯·æ±‚å¤„ç†çš„æ¯ä¸ªç¯èŠ‚ï¼Œåˆ†åˆ«æ·»åŠ ç¼“å­˜ï¼Œå‡è½»Tomcatå‹åŠ›ï¼Œæå‡æœåŠ¡æ€§èƒ½ï¼š</p><ul><li>æµè§ˆå™¨è®¿é—®é™æ€èµ„æºæ—¶ï¼Œä¼˜å…ˆè¯»å–æµè§ˆå™¨æœ¬åœ°ç¼“å­˜</li><li>è®¿é—®éé™æ€èµ„æºï¼ˆajaxæŸ¥è¯¢æ•°æ®ï¼‰æ—¶ï¼Œè®¿é—®æœåŠ¡ç«¯</li><li>è¯·æ±‚åˆ°è¾¾Nginxåï¼Œä¼˜å…ˆè¯»å–Nginxæœ¬åœ°ç¼“å­˜</li><li>å¦‚æœNginxæœ¬åœ°ç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ™å»ç›´æ¥æŸ¥è¯¢Redisï¼ˆä¸ç»è¿‡Tomcatï¼‰</li><li>å¦‚æœRedisæŸ¥è¯¢æœªå‘½ä¸­ï¼Œåˆ™æŸ¥è¯¢Tomcat</li><li>è¯·æ±‚è¿›å…¥Tomcatåï¼Œä¼˜å…ˆæŸ¥è¯¢JVMè¿›ç¨‹ç¼“å­˜</li><li>å¦‚æœJVMè¿›ç¨‹ç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ™æŸ¥è¯¢æ•°æ®åº“</li></ul><figure><img src="/blog/assets/img/image-20210821075558137.bb7b1e80.png" alt="image-20210821075558137" tabindex="0" loading="lazy"><figcaption>image-20210821075558137</figcaption></figure><p>åœ¨å¤šçº§ç¼“å­˜æ¶æ„ä¸­ï¼ŒNginxå†…éƒ¨éœ€è¦ç¼–å†™æœ¬åœ°ç¼“å­˜æŸ¥è¯¢ã€RedisæŸ¥è¯¢ã€TomcatæŸ¥è¯¢çš„ä¸šåŠ¡é€»è¾‘ï¼Œå› æ­¤è¿™æ ·çš„nginxæœåŠ¡ä¸å†æ˜¯ä¸€ä¸ª<strong>åå‘ä»£ç†æœåŠ¡å™¨</strong>ï¼Œè€Œæ˜¯ä¸€ä¸ªç¼–å†™<strong>ä¸šåŠ¡çš„WebæœåŠ¡å™¨äº†</strong>ã€‚</p><p>å› æ­¤è¿™æ ·çš„ä¸šåŠ¡NginxæœåŠ¡ä¹Ÿéœ€è¦æ­å»ºé›†ç¾¤æ¥æé«˜å¹¶å‘ï¼Œå†æœ‰ä¸“é—¨çš„nginxæœåŠ¡æ¥åšåå‘ä»£ç†ï¼Œå¦‚å›¾ï¼š</p><figure><img src="/blog/assets/img/image-20210821080511581.2b31490c.png" alt="image-20210821080511581" tabindex="0" loading="lazy"><figcaption>image-20210821080511581</figcaption></figure><p>å¦å¤–ï¼Œæˆ‘ä»¬çš„TomcatæœåŠ¡å°†æ¥ä¹Ÿä¼šéƒ¨ç½²ä¸ºé›†ç¾¤æ¨¡å¼ï¼š</p><figure><img src="/blog/assets/img/image-20210821080954947.d1ed2ce2.png" alt="image-20210821080954947" tabindex="0" loading="lazy"><figcaption>image-20210821080954947</figcaption></figure><p>å¯è§ï¼Œå¤šçº§ç¼“å­˜çš„å…³é”®æœ‰ä¸¤ä¸ªï¼š</p><ul><li><p>ä¸€ä¸ªæ˜¯åœ¨nginxä¸­ç¼–å†™ä¸šåŠ¡ï¼Œå®ç°nginxæœ¬åœ°ç¼“å­˜ã€Redisã€Tomcatçš„æŸ¥è¯¢</p></li><li><p>å¦ä¸€ä¸ªå°±æ˜¯åœ¨Tomcatä¸­å®ç°JVMè¿›ç¨‹ç¼“å­˜</p></li></ul><p>å…¶ä¸­Nginxç¼–ç¨‹åˆ™ä¼šç”¨åˆ°OpenRestyæ¡†æ¶ç»“åˆLuaè¿™æ ·çš„è¯­è¨€ã€‚</p><p>è¿™ä¹Ÿæ˜¯ä»Šå¤©è¯¾ç¨‹çš„éš¾ç‚¹å’Œé‡ç‚¹ã€‚</p><h1 id="_2-jvmè¿›ç¨‹ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_2-jvmè¿›ç¨‹ç¼“å­˜"><span>2.JVMè¿›ç¨‹ç¼“å­˜</span></a></h1><p>ä¸ºäº†æ¼”ç¤ºå¤šçº§ç¼“å­˜çš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å…ˆå‡†å¤‡ä¸€ä¸ªå•†å“æŸ¥è¯¢çš„ä¸šåŠ¡ã€‚</p><h2 id="_2-1-å¯¼å…¥æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#_2-1-å¯¼å…¥æ¡ˆä¾‹"><span>2.1.å¯¼å…¥æ¡ˆä¾‹</span></a></h2><p>å‚è€ƒè¯¾å‰èµ„æ–™çš„ï¼šã€Šæ¡ˆä¾‹å¯¼å…¥è¯´æ˜.mdã€‹</p><figure><img src="data:image/png;base64,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" alt="image-20210821081418456" tabindex="0" loading="lazy"><figcaption>image-20210821081418456</figcaption></figure><h2 id="_2-2-åˆè¯†caffeine" tabindex="-1"><a class="header-anchor" href="#_2-2-åˆè¯†caffeine"><span>2.2.åˆè¯†Caffeine</span></a></h2><p>ç¼“å­˜åœ¨æ—¥å¸¸å¼€å‘ä¸­å¯åŠ¨è‡³å…³é‡è¦çš„ä½œç”¨ï¼Œç”±äºæ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ•°æ®çš„è¯»å–é€Ÿåº¦æ˜¯éå¸¸å¿«çš„ï¼Œèƒ½å¤§é‡å‡å°‘å¯¹æ•°æ®åº“çš„è®¿é—®ï¼Œå‡å°‘æ•°æ®åº“çš„å‹åŠ›ã€‚æˆ‘ä»¬æŠŠç¼“å­˜åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li>åˆ†å¸ƒå¼ç¼“å­˜ï¼Œä¾‹å¦‚Redisï¼š <ul><li>ä¼˜ç‚¹ï¼šå­˜å‚¨å®¹é‡æ›´å¤§ã€å¯é æ€§æ›´å¥½ã€å¯ä»¥åœ¨é›†ç¾¤é—´å…±äº«</li><li>ç¼ºç‚¹ï¼šè®¿é—®ç¼“å­˜æœ‰ç½‘ç»œå¼€é”€</li><li>åœºæ™¯ï¼šç¼“å­˜æ•°æ®é‡è¾ƒå¤§ã€å¯é æ€§è¦æ±‚è¾ƒé«˜ã€éœ€è¦åœ¨é›†ç¾¤é—´å…±äº«</li></ul></li><li>è¿›ç¨‹æœ¬åœ°ç¼“å­˜ï¼Œä¾‹å¦‚HashMapã€GuavaCacheï¼š <ul><li>ä¼˜ç‚¹ï¼šè¯»å–æœ¬åœ°å†…å­˜ï¼Œæ²¡æœ‰ç½‘ç»œå¼€é”€ï¼Œé€Ÿåº¦æ›´å¿«</li><li>ç¼ºç‚¹ï¼šå­˜å‚¨å®¹é‡æœ‰é™ã€å¯é æ€§è¾ƒä½ã€æ— æ³•å…±äº«</li><li>åœºæ™¯ï¼šæ€§èƒ½è¦æ±‚è¾ƒé«˜ï¼Œç¼“å­˜æ•°æ®é‡è¾ƒå°</li></ul></li></ul><p>æˆ‘ä»¬ä»Šå¤©ä¼šåˆ©ç”¨Caffeineæ¡†æ¶æ¥å®ç°JVMè¿›ç¨‹ç¼“å­˜ã€‚</p><p><strong>Caffeine</strong>æ˜¯ä¸€ä¸ªåŸºäºJava8å¼€å‘çš„ï¼Œæä¾›äº†è¿‘ä¹æœ€ä½³å‘½ä¸­ç‡çš„é«˜æ€§èƒ½çš„æœ¬åœ°ç¼“å­˜åº“ã€‚ç›®å‰Springå†…éƒ¨çš„ç¼“å­˜ä½¿ç”¨çš„å°±æ˜¯Caffeineã€‚GitHubåœ°å€ï¼šhttps://github.com/ben-manes/caffeine</p><p>Caffeineçš„æ€§èƒ½éå¸¸å¥½ï¼Œä¸‹å›¾æ˜¯å®˜æ–¹ç»™å‡ºçš„æ€§èƒ½å¯¹æ¯”ï¼š</p><figure><img src="/blog/assets/img/image-20210821081826399.686049b3.png" alt="image-20210821081826399" tabindex="0" loading="lazy"><figcaption>image-20210821081826399</figcaption></figure><p>å¯ä»¥çœ‹åˆ°Caffeineçš„æ€§èƒ½é¥é¥é¢†å…ˆï¼</p><p>ç¼“å­˜ä½¿ç”¨çš„åŸºæœ¬APIï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> testBasicOps</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // æ„å»ºcacheå¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Cache</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> cache </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Caffeine</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">newBuilder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">build</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // å­˜æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    cache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;gf&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;è¿ªä¸½çƒ­å·´&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> gf </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> cache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getIfPresent</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;gf&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;gf = &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> gf);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // å–æ•°æ®ï¼ŒåŒ…å«ä¸¤ä¸ªå‚æ•°ï¼š</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // å‚æ•°ä¸€ï¼šç¼“å­˜çš„key</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // å‚æ•°äºŒï¼šLambdaè¡¨è¾¾å¼ï¼Œè¡¨è¾¾å¼å‚æ•°å°±æ˜¯ç¼“å­˜çš„keyï¼Œæ–¹æ³•ä½“æ˜¯æŸ¥è¯¢æ•°æ®åº“çš„é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // ä¼˜å…ˆæ ¹æ®keyæŸ¥è¯¢JVMç¼“å­˜ï¼Œå¦‚æœæœªå‘½ä¸­ï¼Œåˆ™æ‰§è¡Œå‚æ•°äºŒçš„Lambdaè¡¨è¾¾å¼</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> defaultGF </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> cache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;defaultGF&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, key </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // æ ¹æ®keyå»æ•°æ®åº“æŸ¥è¯¢æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;æŸ³å²©&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;defaultGF = &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> defaultGF);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Caffeineæ—¢ç„¶æ˜¯ç¼“å­˜çš„ä¸€ç§ï¼Œè‚¯å®šéœ€è¦æœ‰ç¼“å­˜çš„æ¸…é™¤ç­–ç•¥ï¼Œä¸ç„¶çš„è¯å†…å­˜æ€»ä¼šæœ‰è€—å°½çš„æ—¶å€™ã€‚</p><p>Caffeineæä¾›äº†ä¸‰ç§ç¼“å­˜é©±é€ç­–ç•¥ï¼š</p><ul><li><p><strong>åŸºäºå®¹é‡</strong>ï¼šè®¾ç½®ç¼“å­˜çš„æ•°é‡ä¸Šé™</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// åˆ›å»ºç¼“å­˜å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Cache</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> cache </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Caffeine</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">newBuilder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">maximumSize</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // è®¾ç½®ç¼“å­˜å¤§å°ä¸Šé™ä¸º 1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">build</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>åŸºäºæ—¶é—´</strong>ï¼šè®¾ç½®ç¼“å­˜çš„æœ‰æ•ˆæ—¶é—´</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// åˆ›å»ºç¼“å­˜å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Cache</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> cache </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Caffeine</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">newBuilder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // è®¾ç½®ç¼“å­˜æœ‰æ•ˆæœŸä¸º 10 ç§’ï¼Œä»æœ€åä¸€æ¬¡å†™å…¥å¼€å§‹è®¡æ—¶ </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">expireAfterWrite</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Duration</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ofSeconds</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">build</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>åŸºäºå¼•ç”¨</strong>ï¼šè®¾ç½®ç¼“å­˜ä¸ºè½¯å¼•ç”¨æˆ–å¼±å¼•ç”¨ï¼Œåˆ©ç”¨GCæ¥å›æ”¶ç¼“å­˜æ•°æ®ã€‚æ€§èƒ½è¾ƒå·®ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚</p></li></ul><blockquote><p><strong>æ³¨æ„</strong>ï¼šåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªç¼“å­˜å…ƒç´ è¿‡æœŸçš„æ—¶å€™ï¼ŒCaffeineä¸ä¼šè‡ªåŠ¨ç«‹å³å°†å…¶æ¸…ç†å’Œé©±é€ã€‚è€Œæ˜¯åœ¨ä¸€æ¬¡è¯»æˆ–å†™æ“ä½œåï¼Œæˆ–è€…åœ¨ç©ºé—²æ—¶é—´å®Œæˆå¯¹å¤±æ•ˆæ•°æ®çš„é©±é€ã€‚</p></blockquote><h2 id="_2-3-å®ç°jvmè¿›ç¨‹ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_2-3-å®ç°jvmè¿›ç¨‹ç¼“å­˜"><span>2.3.å®ç°JVMè¿›ç¨‹ç¼“å­˜</span></a></h2><h3 id="_2-3-1-éœ€æ±‚" tabindex="-1"><a class="header-anchor" href="#_2-3-1-éœ€æ±‚"><span>2.3.1.éœ€æ±‚</span></a></h3><p>åˆ©ç”¨Caffeineå®ç°ä¸‹åˆ—éœ€æ±‚ï¼š</p><ul><li>ç»™æ ¹æ®idæŸ¥è¯¢å•†å“çš„ä¸šåŠ¡æ·»åŠ ç¼“å­˜ï¼Œç¼“å­˜æœªå‘½ä¸­æ—¶æŸ¥è¯¢æ•°æ®åº“</li><li>ç»™æ ¹æ®idæŸ¥è¯¢å•†å“åº“å­˜çš„ä¸šåŠ¡æ·»åŠ ç¼“å­˜ï¼Œç¼“å­˜æœªå‘½ä¸­æ—¶æŸ¥è¯¢æ•°æ®åº“</li><li>ç¼“å­˜åˆå§‹å¤§å°ä¸º100</li><li>ç¼“å­˜ä¸Šé™ä¸º10000</li></ul><h3 id="_2-3-2-å®ç°" tabindex="-1"><a class="header-anchor" href="#_2-3-2-å®ç°"><span>2.3.2.å®ç°</span></a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸¤ä¸ªCaffeineçš„ç¼“å­˜å¯¹è±¡ï¼Œåˆ†åˆ«ä¿å­˜å•†å“ã€åº“å­˜çš„ç¼“å­˜æ•°æ®ã€‚</p><p>åœ¨item-serviceçš„<code>com.heima.item.config</code>åŒ…ä¸‹å®šä¹‰<code>CaffeineConfig</code>ç±»ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> com.heima.item.config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.github.benmanes.caffeine.cache.Cache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.github.benmanes.caffeine.cache.Caffeine</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.heima.item.pojo.Item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.heima.item.pojo.ItemStock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.springframework.context.annotation.Bean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.springframework.context.annotation.Configuration</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> CaffeineConfig</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Bean</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Cache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Long</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> itemCache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(){</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Caffeine</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">newBuilder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">initialCapacity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">maximumSize</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10_000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">build</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Bean</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Cache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Long</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ItemStock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> stockCache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(){</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Caffeine</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">newBuilder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">initialCapacity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">maximumSize</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10_000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">build</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œä¿®æ”¹item-serviceä¸­çš„<code>com.heima.item.web</code>åŒ…ä¸‹çš„ItemControllerç±»ï¼Œæ·»åŠ ç¼“å­˜é€»è¾‘ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RestController</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;item&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ItemController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> IItemService</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> itemService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> IItemStockService</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> stockService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Cache</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Long</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Item</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> itemCache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Cache</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Long</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ItemStock</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> stockCache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // ...å…¶å®ƒç•¥</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/{id}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Item</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> findById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;id&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Long</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> itemCache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(id, key </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> itemService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ne</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;status&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">eq</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;id&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, key)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">one</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        );</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/stock/{id}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ItemStock</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> findStockById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;id&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Long</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> stockCache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(id, key </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> stockService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(key));</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_3-luaè¯­æ³•å…¥é—¨" tabindex="-1"><a class="header-anchor" href="#_3-luaè¯­æ³•å…¥é—¨"><span>3.Luaè¯­æ³•å…¥é—¨</span></a></h1><p>Nginxç¼–ç¨‹éœ€è¦ç”¨åˆ°Luaè¯­è¨€ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»å…ˆå…¥é—¨Luaçš„åŸºæœ¬è¯­æ³•ã€‚</p><h2 id="_3-1-åˆè¯†lua" tabindex="-1"><a class="header-anchor" href="#_3-1-åˆè¯†lua"><span>3.1.åˆè¯†Lua</span></a></h2><p>Lua æ˜¯ä¸€ç§è½»é‡å°å·§çš„è„šæœ¬è¯­è¨€ï¼Œç”¨æ ‡å‡†Cè¯­è¨€ç¼–å†™å¹¶ä»¥æºä»£ç å½¢å¼å¼€æ”¾ï¼Œ å…¶è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†åµŒå…¥åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œä¸ºåº”ç”¨ç¨‹åºæä¾›çµæ´»çš„æ‰©å±•å’Œå®šåˆ¶åŠŸèƒ½ã€‚å®˜ç½‘ï¼šhttps://www.lua.org/</p><figure><img src="/blog/assets/img/image-20210821091437975.ceea1382.png" alt="image-20210821091437975" tabindex="0" loading="lazy"><figcaption>image-20210821091437975</figcaption></figure><p>Luaç»å¸¸åµŒå…¥åˆ°Cè¯­è¨€å¼€å‘çš„ç¨‹åºä¸­ï¼Œä¾‹å¦‚æ¸¸æˆå¼€å‘ã€æ¸¸æˆæ’ä»¶ç­‰ã€‚</p><p>Nginxæœ¬èº«ä¹Ÿæ˜¯Cè¯­è¨€å¼€å‘ï¼Œå› æ­¤ä¹Ÿå…è®¸åŸºäºLuaåšæ‹“å±•ã€‚</p><h2 id="_3-1-helloworld" tabindex="-1"><a class="header-anchor" href="#_3-1-helloworld"><span>3.1.HelloWorld</span></a></h2><p>CentOS7é»˜è®¤å·²ç»å®‰è£…äº†Luaè¯­è¨€ç¯å¢ƒï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è¿è¡ŒLuaä»£ç ã€‚</p><p>1ï¼‰åœ¨Linuxè™šæ‹Ÿæœºçš„ä»»æ„ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªhello.luaæ–‡ä»¶</p><figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAqsAAABiCAYAAAB3Y5qkAAAZdUlEQVR4nO3dzWsb574H8K8lJzE5f8BdiAqJFmNKFyYL04VbrozJ6LaLC9fFGGNOSXHi0+KdDCf19WIWumkO2DvDaRxzTIIJxiQX7qKpZIx1Sb0oWgQvQjCiRYOKFvcPOMGv0l3MPONnRjOSRq8j5fsB4UR5NC/WxPr6eX7PMwPlcrkMIiIiIiIfCnT7AIiIiIiI3DCsEhEREZFvMawSERERkW8xrBIRERGRbzGsEhEREZFvDbZiI24LCnChASIiIqL+NzAw4Ol5LxoKqyKEymHU7c/VniMiIiKi3uQUROXnBgYGzPwnnm8kvA7Uu86qPaDKX93+zf5aIiIiIuof9vBpD6UDAwOOzzm91k1dPav2QOr2d4ZWIiIiov5Xb0i1h1W311VTM6xWC6elUsk1rNYqFSAiIiKi3mQf7hdf3cJqIOA+p79WYK0aVu1B1P6Qw6o9uMqvF38mIiIiov5QK6QGAoGqAdZpW05cw2qtgFoqlSyPekOr+DsRERER9RZ7j2qtkBoIBBAIBFAul83n3XpZ3QKrY1h1CppOIfXy8tIxtFYrD5C/EhEREVHvqFWbKgdS+REMBs3AKl4n/9m+aoCsIqzae0CdelFFUBUPe3h1C6wMq0RERES9yy2k2oNqMBisCKriqxxaRa+r2K78Z6Fqz6p9+N8eUv/lX+fa+f0gIiIioj7wf/+7bQZWQfSoyp2YdfWsAu49qiKkXlxc4PLysg2nQkRERET95uLiomJkXQ6mckmAnSWsVluiSoTVi4sL80FEREREVMv5+XlFD6p4iLzpVrtaswzAafj/4uIC5+fnbT4tIiIiIuoHIjc61braA6ud4wQre1h1CqpnZ2ftPzMiIiIi6nkiN7pNzJKzZ9UJVm6TqsRDLgFgzyoRERER1eP8/NxcHUAEVDljyr2r9sBa12oA9slVrFklIiIionpdXFxYlrO6vLys6FF1W9rUdZ3VaisCNNWzOp1EWR2zPZnF0sgy1qrcN5aoZUoKDo4TiNmezqiTmNjlNUhERNRq5+fnCAaDCAaDrndBBZzX4jc/md1WAnCaZMWe1cYo0ws4SO2h/NZ4pJJIjJa6fVgVEht7KL/dwmMfHhv53HRSv7Y3lN7eR2kYj+X/q8bjYNrl/4TX9p3i1+MioveOyI72G0q53TxKDq0V3UhOQdUtsDZD217EwMe3jcdK7/Wqji7gILVV9wdmYmMLKfVT/P4P47xHFhF/Baw+e/JefHDIQT2/PNzdgwmkMWFee7cR3y7W97rppDXElxQctDo0ebyuiIiIeoFbUHULrDLXhFhtopXY2Xtt+APEwqG6mirLW1gdL2Jp9mvc3c3pTwZySD9YQXwbiH3zLZRSHwbW0jASy0nk3+4hpU4hFu72AbXYrQiiADQt37pteriuqI0COdyNe/iFxmv7TvHrcRHRe8ceVJ16Vt1Ywqq9XsCtFEB8pTqMLuDHuRAy6jLWjip/N0i//BVaeAp/nenCsbWZsvI9VufGEAGgHa5hqcc/KJWPQgCKOH5tPDH8ASLdPCAiIqIeIedHt6DqVrfqWAYgvtaqXW0rUWuVWoBSKkGZTiJv1l5tIb+suPZGWtvuoZzawkEr2otaubd7V5PExhMV9WDyMHfiuylECi/wtx2X83ydwX4BiH40UrGf/PIwMKrUXefq9bwBGNvfshz/6rh7c32Y2raPaedh/XRyB5lCFkuzk4jeS+NNlc32svxvx81toIHrSvD0nlep9VSWt6rWMjrux+V9N40qeLxxdW3lUwtItHoEwcs+PFy7ndTQ/9t2afQaEaMolvrYLp4HEflOrVrVahOsXJeusv/dKbR2ylebTzA/Lg+NhhCZS+BH5BF9kLO0TWxsYXXcNowaDiE2l0Ds8wjit/+OtFQf67W9JyUFX44D2nZG38aogoOHCWM4vAgNRayPLOO4AMxHogCs54LIn5F/NmbtvQuPYfXht3jTgvNQppNIVazMUIXTSg7hEGLqOsqTaxi4l7b+WyCNiXgaVapN/K9i5YAQVo/3sSo1ian7KKsADh2+B23U1mtXKA3j8d465u0lHOEQYur3eJz7GncdRgw0fFZx7UbCU1jdQ8W12yhP+/B67XZIR97DDkhsrjv8kmucRwRd+/4SkX9Um1AluJUC1FWz6jbhqiPCU5gfD0E7XEN8ZFKvu1KzAIDI5zHrb+3TSeMHfxGb6tUErrj6ApqxLctwu9f2uytXk8KMY8DhmjRRTH+YAXrmM8RQxP7LYz30PEtIdZshRAp/VO1tjIyPISIf2+wLZAAg/Cm+utXEeQB6eYI6BqCIjPSagZFFbB46HExJwYE6BiCLzVmp/ewaMgUA4zNcPaBRXq8roLH3vAHKyvdGULXuZ2B2EUuH7mUd4trN1Lp2m1D3Pvx67XboPeyMIjLba4jPTlq/vwB/NhARAFSdUOWpZtWJW/1qtY22WkZdRPRe2uxhSO88xWYBQPgDfCK1S0yOGe2liUwA0ruPEDVCgDyZyWt7r5SPQkDhVzx/DSgrM4jBWAVhZFE//oJ21WsSjjjsp4hNeVLW0SP8dAgAIXwojV42ch7KF5/qtaTbP2BCeg0COTgNauvHX8Tm7DLuHkntj9KYuP8CGkKY/GLE4ZVtVpLKJFJbeNzqYV2xcoB4z6QQuXQI6GsEGx/QnexVbfO1CwAoKfjrnBGmZq37wVEOa/dWHHtVdfprJmpcu82pbx9+vXY78h52yNq9O5h4kEZavh6O0sb7QUQEx6Aqnq+lrvElrwm4tbL4accWn8wZrtKSV8aQu97eYTM7vxi9LkbA9dq+AZ9EQnogxQi++jwEIIv15DGAKD4M22aRy8FVONypCANvNFtvVoPn8UlEDyH7L+urt9TbhzD/bL+ilrL8bAoRAJFItK5ttUxpGI/3pN7qcAjz6rq1ps6owWt+eTDbe1YaxkgYQI3e8bbowLULwFztwOk6rKmea7dZde7Dn9duh97DTnGsWa1R/05E75VmsqTlpgBed+pLruEhj98LLWhfLxFmAIigg8Nf9HBthID8b8e2dk3wch7mPqWZ7dW06hhb7VYMk2EARolIXM1CAxBTn+gTZ0rDRu9VEb/namzLhZhUUjbqViNz68bfjTrO8BRSx/vduYlCu65dwVjtoKVLc3WaX69dod3vYScYdc2rc2OI+Pl7TURd1UzOHLT/g5eHLxk9EZUDskZgtH84eG3vkablgVsxWPptjBCQl/ajvWoyEDR0HiGM3AJwVGPbgRyOCwDCxnCw1162djG+j5n9n/Ve6d0VRKFPpImp6/qkJ8AsxejleV6O2nztChGnyX+9wq/XrtCh97CtZv5s1DVnsTRrXaIvscHeVSLSNZMxffaTuxmiJ2IMXzpNSpj5TJ/RbQ63e23fIqVhPP7mqrdP1LI2vvxRA+chPsCd6gdHF7Do8OGiD692qS7VjTExaWI3YHlO9LACAApZLDUxozr94I5l4lNGnTQn82iAVMN6p4NBqMXX7qioTbXJ/aGf4/hnrV9yqoN8ee126+dPo9yuEYj1hwFt+6njWtJERM3qn58sgRyev9Lr1WLqE8tEG2V6AXlj2ZrM/s+NtbczP8hnqk7qiUSiwGtN70UdT1wNHxs1dKm5EFBtHdZaGjyPtf2rCRxi3VZlOom8UcNnl375KzQAkbnvfb92Ynp3BVExIzne3lv5tnyIvJ7rqtFrV962+Z4vIP9MXppLcvQI64cAMIbVvQdIjErHMzqMxEayJ2Z5+/Labfbnz7R+Z7iWl594vUYkltVZjPWh2atKRK3QP2EVQDr5gz5jG/pEG1Hkn1KnjJnvi5ZeOK/tLYzF/O2vNRdvN3svoc8oN3v79KV2zGV/Clks3W9uLcWGzsOcwDGFVWPiSUodQ6SQxabTnaaOHuEv23oPVWwuYdRpWhcAr/jQHF0wPlCN4zF6Zsy6T5fFx/1I3L3KrH0VpRzN3hDArtZ1ZWjoPZe3bb7nU/ryT4dZx8NZmzeWHwqPYfWZdDzP1ivXB/WrFl67MXXf8f3w3B5N/PwxRmf0XypDmP/u39zP3etxNXCNiF8Gruq391A2lunTeqXuloh8ra/CKgI53L29iKVtaRgYAApZbKqLFTcQ8Nze6bWHRetrJW+04tWSVGZv3x1M7Oawdu/OVc9fs0NnjZxHII2J2TVsFq6CqXa4hvjtZTx32U36wR3E1RfIFHr7tqmN0GeUXxFDny1Xx3VlaefpPddfsymvj1rIYmn2a0zsu+0njYkRh+MpFJFRf/BfDagLX167jf78CeTw/B9Xv/xuuvW+NnFMnq6Ro0eIzr7Q16w1aIUslmYX8ZdXPvp+E1HPGigbVazybVQvLi7Mx+npKU5PT3FycoKTkxO8e/cO7969wz//+U/8x3/+3fsejTvJaNs1wmA/mE6irIb8ObGDTMryFlJzIWTUSfeedCIiImrYf//Xt/jTn/6Emzdv4ubNmxgaGsLQ0BBu3LiBGzduYHBw0HwEg0EEg0EEjFFnfjK3085TbBZqDNMRERERkauuhVVL3eLbZE/PNnYVyOHu/RfQxhPIb1gndiijCg5SC/153n5XUnDgUMdHRERE/jNYuwk15egRorMaDh7OIHWcMJ/WClnsv3rq/zUUiYiIiLqo82F1dwUDuw7P+2EtwXY5SmMi7nLf+H4+b78KpDHxsdP7wfeCiIjIb/jpTERERES+xbBKRERERL7FsEpEREREvsWwSkRERES+xbBKRERERL7FsEpEREREvsWwSkRERES+xbBKRERERL7FsEpEREREvsWwSkRERES+xbBKRERERL7FsEpEREREvjXY8T1OJ1FWx2xPZrE0soy1ALMzdUBJwcFxAjHb0xl1EhO7vAaJiIj8hJ/MHaRML+AgtYfyW+ORSiIxWur2YVVIbOyh/HYLj314bERERPR+6VpY1bYXMfDxbeOx0nu9qqMLOEhtobyh1NU8sbGFlPopfv+Hcd4ji4i/AlafPcHBdP+HQjmo55eHu3swgTQmzGvvNuLbxfpeN520hviSgoO3e3VfA0RERORdjyVEHxn+ALFwqK6myvIWVseLWJr9Gnd3c/qTgRzSD1YQ3wZi33wLpdSHgbU0jMRyEvm3e0ipU4iFu31ALXYrgigATct3+0iIiIj6FsNqu40u4Me5EDLqMtaOKr/d6Ze/QgtP4a8zXTi2NlNWvsfq3BgiALTDNSzV24PpU8pHIQBFHL82nhj+AJFuHhAREdF7wL9htTSMx6k9lFMLUEolKNNJ5M16zy3klxXX3khr2z2UU1s4aEX76eRVGzFJbDxx9dzbymHuxHdTiBRe4G87Luf5OoP9AhD9aKRiP/nlYWBUqbvO1et5AzC2v2U5/tVx9+Z6+YNtH9POw/rp5A4yhSyWZicRvZfGmyqb7WX53467fQhERER9q/OrATTgq80nmB+Xh9xDiMwl8CPyiD7IWdomNrawOm4bng+HEJtLIPZ5BPHbf0daqo/12t6TkoIvxwFtO6NvY1TBwcOEMRxehIYi1keWcVwA5iNRANZzQeTPyD8bs/behcew+vBbvGnBeSjTSaQqVmaowmklh3AIMXUd5ck1DNxLW/8tkMZEPA0//05UU8XKASGsHu9jVWoSU/dRVgEcOnwPiIiIqCn+TxHhKcyPh6AdriE+MqlPiFGzAIDI5zFrr+F00ghsRWyqVxO44uoLaMa2LMPtXtvvrlxNCjOOAYdr0kQx/WEG6JnPEEMR+y+P9dDzLCHVbYYQKfxRtbcxMj6GiHxssy+QAYDwp/jqVhPnAejlCeoYgCIy0msGRhaxeehwMCUFB+oYgCw2Z6X2s2vIFACMz3D1ACIiImo5/4dVABl1EdF7abNnML3zFJsFAOEP8InULjE5ZrSXJjIBSO8+QtQIl/JkJq/tvVI+CgGFX/H8NaCszCAGYxWEkUX9+AvaVW9nOOKwnyI25UlZR4/w0yEAhPChNPLeyHkoX3yq15Ju/4AJ6TUI5OA0qK0ffxGbs8u4eyS1P0pj4v4LaAhh8osRh1e2WUkqk0ht4bFLSULDxMoB4j2TfjlZOgT0NYL1X6LYq0pERNR6PRBWs/hpxxafAjncjduWvDKG3PX2DpvZ+cXolTQCrtf2DfgkEtIDKUbw1echAFmsJ48BRPFh2DaLXA6uwuEO7tomZb3RbJOUGjyPTyJ6T+z+y/rqLfX2Icw/26+o0S0/m0IEQCQSrWtbLVMaxuM9qbc6HMK8um5dCsyo/21+eTDbe1YaxkgYQI3ecSIiImpOD4RVj1zDQx6/F1rQvl4izAAQQQeHv+jh2ljyKP/bsa1dE7ych7lPaWZ7Na06xla7FcNkGIBRIhJXs9AAxNQn+qSv0rDR61zE77ka23KhLBuTz4y61cjcuvH3dcyHAYSnkDre500UiIiI2qQnJlh5YvQgVg7IGoHRHuq8tvdI0/LArRgsfY7Gkkd5aT/aqybX6mzoPEIYuQXgqMa2AzkcFwCEjbIEhyW4usL4Pmb2f9Z7pXdXEIU+CSymruuTngCzFKMPfzUjIiLqe3308S16EMfwpdOapTOf6TO6zeF2r+1bpDSMx99c9faJWtbGlz9q4DxE+LTVvgIARhew6LB0lV5+0KW6VDfGhLeJ3YDlOdHDCgAoZLHUxIoO6Qd3LBPqMuqkOdlNA6Qa1jv+CfFERER9pH8+XQM5PH+l13PG1CeWiTbK9ALyxpJLmf2fG2tvl/tDDyvjM1Un9UQiUeC1pveijieuho+N+s/UXAiotg5rLQ2ex9r+1cQrsW6rMp1E3qg/tUu//BUagMjc97XXbu2y9O4KomK1gnh7b+XLu1cRERG1l+VTfGBgwNPDb9LJH/QZ29An2ogJQCl1ypj5vmjphfPa3sJYzN/+WnMxf7P3EvqMcrO3T18qaunQmChVyGLpfhNruTZ6HubEqymsGpOmUuoYIoUsNp3uNHX0CH/Z1ntXY3MJo05TnmjlULM5uoC81CY1p68Da9Z9vt1DeUNp+Lw7Sdy9yqx9FaUcvCEAERFRTc1kzIC8Ea879Z1ADndvL2JpWxoGBoBCFpvqYsUNBDy3d3rtYdH6WskbrXi1JJXZ23cHE7s5rN27c9Xz1+zwcSPnEUhjYnYNm4WrYKodriF+exnPXXaTfnAHcfUFMoXevm1qI/TVEK7o4ZWIiIjq0UzOHCiXy2UAKJfLuLy8xOXlJS4uLszH6ekpzs7OcHJygpOTE7x79858/Pv9de9Ha9wFSduuEQb7wXQSZTXkr0lJVEFZ3kJqLoSMOunek05EREQN+5+Hi7h586b5GBoawtDQEK5fv44bN25gcHDQfASDQQSDQTOw1vxkFg3lrtlAIODPnlW/2XmKzUII89/9W7ePhIiIiKhr5PwoD/XXkyddw6pbDYHYUaDJSSuWusW3SSR8PGGnYYEc7t5/AW08gfyGdVKSMqrgILXQn+ftdyUFBw61tERERNQecn70OhfKcZ1V+wucAmuzYfW9cfQI0VkNBw9nkDpOmE9rhSz2Xz3l3Y+IiIio74nsWC2gugXWirDqNOxvD6milqAhuysY2HU8i8a21wuO0piIu9w3vp/P268CaUx87PR+8L0gIiJqB5Ed3UJrtbKAiqWr7F+dgqr4SkRERERUi5wfnQIrUJlDhbpqVsVGW9KzSkRERETvFXvPqltgdVIRVqtNqJKD6uCgY7krEREREZGFvCSVHFRr1bEC0jqrAFAqlXB5eWl+vby8xPn5ufk4OzvD6ekpTk9PzXVXT05OzOfOzs5wdnaG8/Nzy1qtYnvlctl8EBEREVFvkUOlCJ7yGqnXrl3D9evXzfVTb9y4Ya6pOjQ0ZD53/fp1XLt2zXzIQVZ8FWpOsHIqARAHI4KtCJ+ifTAYxMXFhXmDgVKpZD4YVomIiIh6k1M+FL2mIh/KgVUOpaKdWymA2L6d69JV9lIAefhf9JReu3bNMagODg6aYVUEWoZVIiIiot7mFFbljOgUWEVQtd+hqp4SAMAWVt2WqpKTc7lctgRP8Tq3oCqHVZYBEBEREfWuakuaOgVWEVrtgbXaRCt7aHUsA3DqVZWDphw2a/WoyqUCDKtEREREvcstJzr1sNp7WeVSAC+9qzXLAAKBAMrlckVgFeQa1XqDKsMqERERUe9xu2lUtcAqQqtTUK1n+aqKMgAAKJfLroHVfrD2iVdyUBUlA+Kr2DbDKhEREVHvkUOlffkpe2C1h1bx91o3BqhZBiAaioMQ7AFT3mggELD0pDpNqJJDKsMqERERUe9xusup2+pR9p5Wp15VpxUB7KqGVflg5ODq1PVrH/avNvzPsEpERETUe9zCqv1GUnIgdQupTttw4jjBSp7lLwdVtwMTvaiirrVWjyrDKhEREVHvsa+HWuvOp/aeVre7V9m3L6vasypqVwGYdav2A7MP9zstUWWvU2VYJSIiIuo9TqPv8p/tIdRpuL/eWlXBMazaD0YmQqt98lWtkMqASkRERNQ/nIJmtdDqNEJfqwQAqBJW5YOQ/+4WSOXyAbeQysBKRERE1Puchu7dQmut3tRqQRWoEVbtB2PndrMAt95UhlUiIiKi3ufUoWn/Wiuc1hNUgTrCqtsBVetFZUglIiIi6n/1hla3f6trH+UGkmStIX6nTTKwEhEREfUPp7DpNrPfa0C1bLORsGrntgkGVCIiIqL+5xZCGwmnFdtoRVglIiIiImqHQO0mRERERETd8f8eioGNxEGb2gAAAABJRU5ErkJggg==" alt="image-20210821091621308" tabindex="0" loading="lazy"><figcaption>image-20210821091621308</figcaption></figure><p>2ï¼‰æ·»åŠ ä¸‹é¢çš„å†…å®¹</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Hello World!&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>3ï¼‰è¿è¡Œ</p><figure><img src="data:image/png;base64,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" alt="image-20210821091638140" tabindex="0" loading="lazy"><figcaption>image-20210821091638140</figcaption></figure><h2 id="_3-2-å˜é‡å’Œå¾ªç¯" tabindex="-1"><a class="header-anchor" href="#_3-2-å˜é‡å’Œå¾ªç¯"><span>3.2.å˜é‡å’Œå¾ªç¯</span></a></h2><p>å­¦ä¹ ä»»ä½•è¯­è¨€å¿…ç„¶ç¦»ä¸å¼€å˜é‡ï¼Œè€Œå˜é‡çš„å£°æ˜å¿…é¡»å…ˆçŸ¥é“æ•°æ®çš„ç±»å‹ã€‚</p><h3 id="_3-2-1-luaçš„æ•°æ®ç±»å‹" tabindex="-1"><a class="header-anchor" href="#_3-2-1-luaçš„æ•°æ®ç±»å‹"><span>3.2.1.Luaçš„æ•°æ®ç±»å‹</span></a></h3><p>Luaä¸­æ”¯æŒçš„å¸¸è§æ•°æ®ç±»å‹åŒ…æ‹¬ï¼š</p><figure><img src="/blog/assets/img/image-20210821091835406.255b84cf.png" alt="image-20210821091835406" tabindex="0" loading="lazy"><figcaption>image-20210821091835406</figcaption></figure><p>å¦å¤–ï¼ŒLuaæä¾›äº†type()å‡½æ•°æ¥åˆ¤æ–­ä¸€ä¸ªå˜é‡çš„æ•°æ®ç±»å‹ï¼š</p><figure><img src="/blog/assets/img/image-20210821091904332.99dd56ef.png" alt="image-20210821091904332" tabindex="0" loading="lazy"><figcaption>image-20210821091904332</figcaption></figure><h3 id="_3-2-2-å£°æ˜å˜é‡" tabindex="-1"><a class="header-anchor" href="#_3-2-2-å£°æ˜å˜é‡"><span>3.2.2.å£°æ˜å˜é‡</span></a></h3><p>Luaå£°æ˜å˜é‡çš„æ—¶å€™æ— éœ€æŒ‡å®šæ•°æ®ç±»å‹ï¼Œè€Œæ˜¯ç”¨localæ¥å£°æ˜å˜é‡ä¸ºå±€éƒ¨å˜é‡ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å£°æ˜å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç”¨å•å¼•å·æˆ–åŒå¼•å·ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> str</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;hello&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å­—ç¬¦ä¸²æ‹¼æ¥å¯ä»¥ä½¿ç”¨ ..</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> str2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;hello&#39; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.. </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;world&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å£°æ˜æ•°å­—</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> num</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">21</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å£°æ˜å¸ƒå°”ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> flag</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Luaä¸­çš„tableç±»å‹æ—¢å¯ä»¥ä½œä¸ºæ•°ç»„ï¼Œåˆå¯ä»¥ä½œä¸ºJavaä¸­çš„mapæ¥ä½¿ç”¨ã€‚æ•°ç»„å°±æ˜¯ç‰¹æ®Šçš„tableï¼Œkeyæ˜¯æ•°ç»„è§’æ ‡è€Œå·²ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å£°æ˜æ•°ç»„ ï¼Œkeyä¸ºè§’æ ‡çš„ table</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> arr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = {</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;java&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;python&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;lua&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å£°æ˜tableï¼Œç±»ä¼¼javaçš„map</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =  {</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Jack&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">age</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">21</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Luaä¸­çš„æ•°ç»„è§’æ ‡æ˜¯ä»1å¼€å§‹ï¼Œè®¿é—®çš„æ—¶å€™ä¸Javaä¸­ç±»ä¼¼ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- è®¿é—®æ•°ç»„ï¼Œluaæ•°ç»„çš„è§’æ ‡ä»1å¼€å§‹</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">arr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">])</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Luaä¸­çš„tableå¯ä»¥ç”¨keyæ¥è®¿é—®ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- è®¿é—®table</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;name&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">])</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.name)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-3-å¾ªç¯" tabindex="-1"><a class="header-anchor" href="#_3-2-3-å¾ªç¯"><span>3.2.3.å¾ªç¯</span></a></h3><p>å¯¹äºtableï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨forå¾ªç¯æ¥éå†ã€‚ä¸è¿‡æ•°ç»„å’Œæ™®é€štableéå†ç•¥æœ‰å·®å¼‚ã€‚</p><p>éå†æ•°ç»„ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å£°æ˜æ•°ç»„ keyä¸ºç´¢å¼•çš„ table</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> arr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = {</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;java&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;python&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;lua&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- éå†æ•°ç»„</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> index</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> in</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ipairs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">arr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">do</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">index</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éå†æ™®é€štable</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å£°æ˜mapï¼Œä¹Ÿå°±æ˜¯table</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = {</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Jack&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">age</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">21</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- éå†table</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> in</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> pairs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">do</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">   print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-3-æ¡ä»¶æ§åˆ¶ã€å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_3-3-æ¡ä»¶æ§åˆ¶ã€å‡½æ•°"><span>3.3.æ¡ä»¶æ§åˆ¶ã€å‡½æ•°</span></a></h2><p>Luaä¸­çš„æ¡ä»¶æ§åˆ¶å’Œå‡½æ•°å£°æ˜ä¸Javaç±»ä¼¼ã€‚</p><h3 id="_3-3-1-å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_3-3-1-å‡½æ•°"><span>3.3.1.å‡½æ•°</span></a></h3><p>å®šä¹‰å‡½æ•°çš„è¯­æ³•ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> å‡½æ•°å( </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">argument1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">argument2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">..., </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">argumentn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- å‡½æ•°ä½“</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> è¿”å›å€¼</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¾‹å¦‚ï¼Œå®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥æ‰“å°æ•°ç»„ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> printArr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">arr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    for</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> index</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> in</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ipairs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">arr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">do</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-2-æ¡ä»¶æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#_3-3-2-æ¡ä»¶æ§åˆ¶"><span>3.3.2.æ¡ä»¶æ§åˆ¶</span></a></h3><p>ç±»ä¼¼Javaçš„æ¡ä»¶æ§åˆ¶ï¼Œä¾‹å¦‚ifã€elseè¯­æ³•ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(å¸ƒå°”è¡¨è¾¾å¼)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   --[ å¸ƒå°”è¡¨è¾¾å¼ä¸º true æ—¶æ‰§è¡Œè¯¥è¯­å¥å— --]</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   --[ å¸ƒå°”è¡¨è¾¾å¼ä¸º false æ—¶æ‰§è¡Œè¯¥è¯­å¥å— --]</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸javaä¸åŒï¼Œå¸ƒå°”è¡¨è¾¾å¼ä¸­çš„é€»è¾‘è¿ç®—æ˜¯åŸºäºè‹±æ–‡å•è¯ï¼š</p><figure><img src="/blog/assets/img/image-20210821092657918.e06b5c93.png" alt="image-20210821092657918" tabindex="0" loading="lazy"><figcaption>image-20210821092657918</figcaption></figure><h3 id="_3-3-3-æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#_3-3-3-æ¡ˆä¾‹"><span>3.3.3.æ¡ˆä¾‹</span></a></h3><p>éœ€æ±‚ï¼šè‡ªå®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥æ‰“å°tableï¼Œå½“å‚æ•°ä¸ºnilæ—¶ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> printArr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">arr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> not </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">arr</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;æ•°ç»„ä¸èƒ½ä¸ºç©ºï¼&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    for</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> index</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> in</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ipairs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">arr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">do</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_4-å®ç°å¤šçº§ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_4-å®ç°å¤šçº§ç¼“å­˜"><span>4.å®ç°å¤šçº§ç¼“å­˜</span></a></h1><p>å¤šçº§ç¼“å­˜çš„å®ç°ç¦»ä¸å¼€Nginxç¼–ç¨‹ï¼Œè€ŒNginxç¼–ç¨‹åˆç¦»ä¸å¼€OpenRestyã€‚</p><h2 id="_4-1-å®‰è£…openresty" tabindex="-1"><a class="header-anchor" href="#_4-1-å®‰è£…openresty"><span>4.1.å®‰è£…OpenResty</span></a></h2><p>OpenRestyÂ® æ˜¯ä¸€ä¸ªåŸºäº Nginxçš„é«˜æ€§èƒ½ Web å¹³å°ï¼Œç”¨äºæ–¹ä¾¿åœ°æ­å»ºèƒ½å¤Ÿå¤„ç†è¶…é«˜å¹¶å‘ã€æ‰©å±•æ€§æé«˜çš„åŠ¨æ€ Web åº”ç”¨ã€Web æœåŠ¡å’ŒåŠ¨æ€ç½‘å…³ã€‚å…·å¤‡ä¸‹åˆ—ç‰¹ç‚¹ï¼š</p><ul><li>å…·å¤‡Nginxçš„å®Œæ•´åŠŸèƒ½</li><li>åŸºäºLuaè¯­è¨€è¿›è¡Œæ‰©å±•ï¼Œé›†æˆäº†å¤§é‡ç²¾è‰¯çš„ Lua åº“ã€ç¬¬ä¸‰æ–¹æ¨¡å—</li><li>å…è®¸ä½¿ç”¨Lua<strong>è‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘</strong>ã€<strong>è‡ªå®šä¹‰åº“</strong></li></ul><p>å®˜æ–¹ç½‘ç«™ï¼š https://openresty.org/cn/</p><figure><img src="/blog/assets/img/image-20210821092902946.754b6796.png" alt="image-20210821092902946" tabindex="0" loading="lazy"><figcaption>image-20210821092902946</figcaption></figure><p>å®‰è£…Luaå¯ä»¥å‚è€ƒè¯¾å‰èµ„æ–™æä¾›çš„ã€Šå®‰è£…OpenResty.mdã€‹ï¼š</p><figure><img src="data:image/png;base64,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" alt="image-20210821092941139" tabindex="0" loading="lazy"><figcaption>image-20210821092941139</figcaption></figure><h2 id="_4-2-openrestyå¿«é€Ÿå…¥é—¨" tabindex="-1"><a class="header-anchor" href="#_4-2-openrestyå¿«é€Ÿå…¥é—¨"><span>4.2.OpenRestyå¿«é€Ÿå…¥é—¨</span></a></h2><p>æˆ‘ä»¬å¸Œæœ›è¾¾åˆ°çš„å¤šçº§ç¼“å­˜æ¶æ„å¦‚å›¾ï¼š</p><figure><img src="/blog/assets/img/yeVDlwtfMx.3799f0c9.png" alt="yeVDlwtfMx" tabindex="0" loading="lazy"><figcaption>yeVDlwtfMx</figcaption></figure><p>å…¶ä¸­ï¼š</p><ul><li><p>windowsä¸Šçš„nginxç”¨æ¥åšåå‘ä»£ç†æœåŠ¡ï¼Œå°†å‰ç«¯çš„æŸ¥è¯¢å•†å“çš„ajaxè¯·æ±‚ä»£ç†åˆ°OpenRestyé›†ç¾¤</p></li><li><p>OpenRestyé›†ç¾¤ç”¨æ¥ç¼–å†™å¤šçº§ç¼“å­˜ä¸šåŠ¡</p></li></ul><h3 id="_4-2-1-åå‘ä»£ç†æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_4-2-1-åå‘ä»£ç†æµç¨‹"><span>4.2.1.åå‘ä»£ç†æµç¨‹</span></a></h3><p>ç°åœ¨ï¼Œå•†å“è¯¦æƒ…é¡µä½¿ç”¨çš„æ˜¯å‡çš„å•†å“æ•°æ®ã€‚ä¸è¿‡åœ¨æµè§ˆå™¨ä¸­ï¼Œå¯ä»¥çœ‹åˆ°é¡µé¢æœ‰å‘èµ·ajaxè¯·æ±‚æŸ¥è¯¢çœŸå®å•†å“æ•°æ®ã€‚</p><p>è¿™ä¸ªè¯·æ±‚å¦‚ä¸‹ï¼š</p><figure><img src="/blog/assets/img/image-20210821093144700.4e75d2e8.png" alt="image-20210821093144700" tabindex="0" loading="lazy"><figcaption>image-20210821093144700</figcaption></figure><p>è¯·æ±‚åœ°å€æ˜¯localhostï¼Œç«¯å£æ˜¯80ï¼Œå°±è¢«windowsä¸Šå®‰è£…çš„NginxæœåŠ¡ç»™æ¥æ”¶åˆ°äº†ã€‚ç„¶åä»£ç†ç»™äº†OpenRestyé›†ç¾¤ï¼š</p><figure><img src="/blog/assets/img/image-20210821094447709.70a12787.png" alt="image-20210821094447709" tabindex="0" loading="lazy"><figcaption>image-20210821094447709</figcaption></figure><p>æˆ‘ä»¬éœ€è¦åœ¨OpenRestyä¸­ç¼–å†™ä¸šåŠ¡ï¼ŒæŸ¥è¯¢å•†å“æ•°æ®å¹¶è¿”å›åˆ°æµè§ˆå™¨ã€‚</p><p>ä½†æ˜¯è¿™æ¬¡ï¼Œæˆ‘ä»¬å…ˆåœ¨OpenRestyæ¥æ”¶è¯·æ±‚ï¼Œè¿”å›å‡çš„å•†å“æ•°æ®ã€‚</p><h3 id="_4-2-2-openrestyç›‘å¬è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#_4-2-2-openrestyç›‘å¬è¯·æ±‚"><span>4.2.2.OpenRestyç›‘å¬è¯·æ±‚</span></a></h3><p>OpenRestyçš„å¾ˆå¤šåŠŸèƒ½éƒ½ä¾èµ–äºå…¶ç›®å½•ä¸‹çš„Luaåº“ï¼Œéœ€è¦åœ¨nginx.confä¸­æŒ‡å®šä¾èµ–åº“çš„ç›®å½•ï¼Œå¹¶å¯¼å…¥ä¾èµ–ï¼š</p><p>1ï¼‰æ·»åŠ å¯¹OpenRestyçš„Luaæ¨¡å—çš„åŠ è½½</p><p>ä¿®æ”¹<code>/usr/local/openresty/nginx/conf/nginx.conf</code>æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­çš„httpä¸‹é¢ï¼Œæ·»åŠ ä¸‹é¢ä»£ç ï¼š</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#lua æ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">lua_package_path</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/usr/local/openresty/lualib/?.lua;;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#cæ¨¡å—     </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">lua_package_cpath</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/usr/local/openresty/lualib/?.so;;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰ç›‘å¬/api/itemè·¯å¾„</p><p>ä¿®æ”¹<code>/usr/local/openresty/nginx/conf/nginx.conf</code>æ–‡ä»¶ï¼Œåœ¨nginx.confçš„serverä¸‹é¢ï¼Œæ·»åŠ å¯¹/api/itemè¿™ä¸ªè·¯å¾„çš„ç›‘å¬ï¼š</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  /api/item {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # é»˜è®¤çš„å“åº”ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    default_type </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">application/json;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # å“åº”ç»“æœç”±lua/item.luaæ–‡ä»¶æ¥å†³å®š</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    content_by_lua_file</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> lua/item.lua;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªç›‘å¬ï¼Œå°±ç±»ä¼¼äºSpringMVCä¸­çš„<code>@GetMapping(&quot;/api/item&quot;)</code>åšè·¯å¾„æ˜ å°„ã€‚</p><p>è€Œ<code>content_by_lua_file lua/item.lua</code>åˆ™ç›¸å½“äºè°ƒç”¨item.luaè¿™ä¸ªæ–‡ä»¶ï¼Œæ‰§è¡Œå…¶ä¸­çš„ä¸šåŠ¡ï¼ŒæŠŠç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚ç›¸å½“äºjavaä¸­è°ƒç”¨serviceã€‚</p><h3 id="_4-2-3-ç¼–å†™item-lua" tabindex="-1"><a class="header-anchor" href="#_4-2-3-ç¼–å†™item-lua"><span>4.2.3.ç¼–å†™item.lua</span></a></h3><p>1ï¼‰åœ¨<code>/usr/loca/openresty/nginx</code>ç›®å½•åˆ›å»ºæ–‡ä»¶å¤¹ï¼šlua</p><figure><img src="/blog/assets/img/image-20210821100755080.365d2a05.png" alt="image-20210821100755080" tabindex="0" loading="lazy"><figcaption>image-20210821100755080</figcaption></figure><p>2ï¼‰åœ¨<code>/usr/loca/openresty/nginx/lua</code>æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å»ºæ–‡ä»¶ï¼šitem.lua</p><figure><img src="/blog/assets/img/image-20210821100801756.4b876f8d.png" alt="image-20210821100801756" tabindex="0" loading="lazy"><figcaption>image-20210821100801756</figcaption></figure><p>3ï¼‰ç¼–å†™item.luaï¼Œè¿”å›å‡æ•°æ®</p><p>item.luaä¸­ï¼Œåˆ©ç”¨ngx.say()å‡½æ•°è¿”å›æ•°æ®åˆ°Responseä¸­</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">say</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;{&quot;id&quot;:10001,&quot;name&quot;:&quot;SALSA AIR&quot;,&quot;title&quot;:&quot;RIMOWA 21å¯¸æ‰˜è¿ç®±æ‹‰æ†ç®± SALSA AIRç³»åˆ—æœç»¿è‰² 820.70.36.4&quot;,&quot;price&quot;:17900,&quot;image&quot;:&quot;https://m.360buyimg.com/mobilecms/s720x720_jfs/t6934/364/1195375010/84676/e9f2c55f/597ece38N0ddcbc77.jpg!q70.jpg.webp&quot;,&quot;category&quot;:&quot;æ‹‰æ†ç®±&quot;,&quot;brand&quot;:&quot;RIMOWA&quot;,&quot;spec&quot;:&quot;&quot;,&quot;status&quot;:1,&quot;createTime&quot;:&quot;2019-04-30T16:00:00.000+00:00&quot;,&quot;updateTime&quot;:&quot;2019-04-30T16:00:00.000+00:00&quot;,&quot;stock&quot;:2999,&quot;sold&quot;:31290}&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>4ï¼‰é‡æ–°åŠ è½½é…ç½®</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åˆ·æ–°å•†å“é¡µé¢ï¼šhttp://localhost/item.html?id=1001ï¼Œå³å¯çœ‹åˆ°æ•ˆæœï¼š</p><figure><img src="/blog/assets/img/image-20210821101217089.8ff761ab.png" alt="image-20210821101217089" tabindex="0" loading="lazy"><figcaption>image-20210821101217089</figcaption></figure><h2 id="_4-3-è¯·æ±‚å‚æ•°å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_4-3-è¯·æ±‚å‚æ•°å¤„ç†"><span>4.3.è¯·æ±‚å‚æ•°å¤„ç†</span></a></h2><p>ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬åœ¨OpenRestyæ¥æ”¶å‰ç«¯è¯·æ±‚ï¼Œä½†æ˜¯è¿”å›çš„æ˜¯å‡æ•°æ®ã€‚</p><p>è¦è¿”å›çœŸå®æ•°æ®ï¼Œå¿…é¡»æ ¹æ®å‰ç«¯ä¼ é€’æ¥çš„å•†å“idï¼ŒæŸ¥è¯¢å•†å“ä¿¡æ¯æ‰å¯ä»¥ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•è·å–å‰ç«¯ä¼ é€’çš„å•†å“å‚æ•°å‘¢ï¼Ÿ</p><h3 id="_4-3-1-è·å–å‚æ•°çš„api" tabindex="-1"><a class="header-anchor" href="#_4-3-1-è·å–å‚æ•°çš„api"><span>4.3.1.è·å–å‚æ•°çš„API</span></a></h3><p>OpenRestyä¸­æä¾›äº†ä¸€äº›APIç”¨æ¥è·å–ä¸åŒç±»å‹çš„å‰ç«¯è¯·æ±‚å‚æ•°ï¼š</p><figure><img src="/blog/assets/img/image-20210821101433528.08eee74c.png" alt="image-20210821101433528" tabindex="0" loading="lazy"><figcaption>image-20210821101433528</figcaption></figure><h3 id="_4-3-2-è·å–å‚æ•°å¹¶è¿”å›" tabindex="-1"><a class="header-anchor" href="#_4-3-2-è·å–å‚æ•°å¹¶è¿”å›"><span>4.3.2.è·å–å‚æ•°å¹¶è¿”å›</span></a></h3><p>åœ¨å‰ç«¯å‘èµ·çš„ajaxè¯·æ±‚å¦‚å›¾ï¼š</p><figure><img src="/blog/assets/img/image-20210821101721649.a27d0bf0.png" alt="image-20210821101721649" tabindex="0" loading="lazy"><figcaption>image-20210821101721649</figcaption></figure><p>å¯ä»¥çœ‹åˆ°å•†å“idæ˜¯ä»¥è·¯å¾„å ä½ç¬¦æ–¹å¼ä¼ é€’çš„ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ–¹å¼æ¥è·å–ID</p><p>1ï¼‰è·å–å•†å“id</p><p>ä¿®æ”¹<code>/usr/loca/openresty/nginx/nginx.conf</code>æ–‡ä»¶ä¸­ç›‘å¬/api/itemçš„ä»£ç ï¼Œåˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼è·å–IDï¼š</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ~ </span><span style="--shiki-light:#0184BC;--shiki-dark:#E06C75;">/api/item/(\d+) </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # é»˜è®¤çš„å“åº”ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    default_type </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">application/json;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # å“åº”ç»“æœç”±lua/item.luaæ–‡ä»¶æ¥å†³å®š</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    content_by_lua_file</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> lua/item.lua;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰æ‹¼æ¥IDå¹¶è¿”å›</p><p>ä¿®æ”¹<code>/usr/loca/openresty/nginx/lua/item.lua</code>æ–‡ä»¶ï¼Œè·å–idå¹¶æ‹¼æ¥åˆ°ç»“æœä¸­è¿”å›ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- è·å–å•†å“id</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.var[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æ‹¼æ¥å¹¶è¿”å›</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">say</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;{&quot;id&quot;:&#39; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.. </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> .. </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;,&quot;name&quot;:&quot;SALSA AIR&quot;,&quot;title&quot;:&quot;RIMOWA 21å¯¸æ‰˜è¿ç®±æ‹‰æ†ç®± SALSA AIRç³»åˆ—æœç»¿è‰² 820.70.36.4&quot;,&quot;price&quot;:17900,&quot;image&quot;:&quot;https://m.360buyimg.com/mobilecms/s720x720_jfs/t6934/364/1195375010/84676/e9f2c55f/597ece38N0ddcbc77.jpg!q70.jpg.webp&quot;,&quot;category&quot;:&quot;æ‹‰æ†ç®±&quot;,&quot;brand&quot;:&quot;RIMOWA&quot;,&quot;spec&quot;:&quot;&quot;,&quot;status&quot;:1,&quot;createTime&quot;:&quot;2019-04-30T16:00:00.000+00:00&quot;,&quot;updateTime&quot;:&quot;2019-04-30T16:00:00.000+00:00&quot;,&quot;stock&quot;:2999,&quot;sold&quot;:31290}&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ï¼‰é‡æ–°åŠ è½½å¹¶æµ‹è¯•</p><p>è¿è¡Œå‘½ä»¤ä»¥é‡æ–°åŠ è½½OpenRestyé…ç½®ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åˆ·æ–°é¡µé¢å¯ä»¥çœ‹åˆ°ç»“æœä¸­å·²ç»å¸¦ä¸Šäº†IDï¼š</p><figure><img src="/blog/assets/img/image-20210821102235467.d8b19640.png" alt="image-20210821102235467" tabindex="0" loading="lazy"><figcaption>image-20210821102235467</figcaption></figure><h2 id="_4-4-æŸ¥è¯¢tomcat" tabindex="-1"><a class="header-anchor" href="#_4-4-æŸ¥è¯¢tomcat"><span>4.4.æŸ¥è¯¢Tomcat</span></a></h2><p>æ‹¿åˆ°å•†å“IDåï¼Œæœ¬åº”å»ç¼“å­˜ä¸­æŸ¥è¯¢å•†å“ä¿¡æ¯ï¼Œä¸è¿‡ç›®å‰æˆ‘ä»¬è¿˜æœªå»ºç«‹nginxã€redisç¼“å­˜ã€‚å› æ­¤ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆæ ¹æ®å•†å“idå»tomcatæŸ¥è¯¢å•†å“ä¿¡æ¯ã€‚æˆ‘ä»¬å®ç°å¦‚å›¾éƒ¨åˆ†ï¼š</p><figure><img src="/blog/assets/img/image-20210821102610167.8f3be4f4.png" alt="image-20210821102610167" tabindex="0" loading="lazy"><figcaption>image-20210821102610167</figcaption></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬çš„OpenRestyæ˜¯åœ¨è™šæ‹Ÿæœºï¼ŒTomcatæ˜¯åœ¨Windowsç”µè„‘ä¸Šã€‚ä¸¤è€…IPä¸€å®šä¸è¦æé”™äº†ã€‚</p><figure><img src="/blog/assets/img/image-20210821102959829.dd35b405.png" alt="image-20210821102959829" tabindex="0" loading="lazy"><figcaption>image-20210821102959829</figcaption></figure><h3 id="_4-4-1-å‘é€httpè¯·æ±‚çš„api" tabindex="-1"><a class="header-anchor" href="#_4-4-1-å‘é€httpè¯·æ±‚çš„api"><span>4.4.1.å‘é€httpè¯·æ±‚çš„API</span></a></h3><p>nginxæä¾›äº†å†…éƒ¨APIç”¨ä»¥å‘é€httpè¯·æ±‚ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> resp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.location.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">capture</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/path&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,{</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    method</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.HTTP_GET,   </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- è¯·æ±‚æ–¹å¼</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = {</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">b</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">},  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- getæ–¹å¼ä¼ å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">})</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿”å›çš„å“åº”å†…å®¹åŒ…æ‹¬ï¼š</p><ul><li>resp.statusï¼šå“åº”çŠ¶æ€ç </li><li>resp.headerï¼šå“åº”å¤´ï¼Œæ˜¯ä¸€ä¸ªtable</li><li>resp.bodyï¼šå“åº”ä½“ï¼Œå°±æ˜¯å“åº”æ•°æ®</li></ul><p>æ³¨æ„ï¼šè¿™é‡Œçš„pathæ˜¯è·¯å¾„ï¼Œå¹¶ä¸åŒ…å«IPå’Œç«¯å£ã€‚è¿™ä¸ªè¯·æ±‚ä¼šè¢«nginxå†…éƒ¨çš„serverç›‘å¬å¹¶å¤„ç†ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬å¸Œæœ›è¿™ä¸ªè¯·æ±‚å‘é€åˆ°TomcatæœåŠ¡å™¨ï¼Œæ‰€ä»¥è¿˜éœ€è¦ç¼–å†™ä¸€ä¸ªserveræ¥å¯¹è¿™ä¸ªè·¯å¾„åšåå‘ä»£ç†ï¼š</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /path {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     # è¿™é‡Œæ˜¯windowsç”µè„‘çš„ipå’ŒJavaæœåŠ¡ç«¯å£ï¼Œéœ€è¦ç¡®ä¿windowsé˜²ç«å¢™å¤„äºå…³é—­çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">     proxy_pass </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">http://192.168.150.1:8081; </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŸç†å¦‚å›¾ï¼š</p><figure><img src="/blog/assets/img/image-20210821104149061.3002d8b9.png" alt="image-20210821104149061" tabindex="0" loading="lazy"><figcaption>image-20210821104149061</figcaption></figure><h3 id="_4-4-2-å°è£…httpå·¥å…·" tabindex="-1"><a class="header-anchor" href="#_4-4-2-å°è£…httpå·¥å…·"><span>4.4.2.å°è£…httpå·¥å…·</span></a></h3><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°è£…ä¸€ä¸ªå‘é€Httpè¯·æ±‚çš„å·¥å…·ï¼ŒåŸºäºngx.location.captureæ¥å®ç°æŸ¥è¯¢tomcatã€‚</p><p>1ï¼‰æ·»åŠ åå‘ä»£ç†ï¼Œåˆ°windowsçš„JavaæœåŠ¡</p><p>å› ä¸ºitem-serviceä¸­çš„æ¥å£éƒ½æ˜¯/itemå¼€å¤´ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›‘å¬/itemè·¯å¾„ï¼Œä»£ç†åˆ°windowsä¸Šçš„tomcatæœåŠ¡ã€‚</p><p>ä¿®æ”¹ <code>/usr/local/openresty/nginx/conf/nginx.conf</code>æ–‡ä»¶ï¼Œæ·»åŠ ä¸€ä¸ªlocationï¼š</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /item {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    proxy_pass </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">http://192.168.150.1:8081;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥åï¼Œåªè¦æˆ‘ä»¬è°ƒç”¨<code>ngx.location.capture(&quot;/item&quot;)</code>ï¼Œå°±ä¸€å®šèƒ½å‘é€è¯·æ±‚åˆ°windowsçš„tomcatæœåŠ¡ã€‚</p><p>2ï¼‰å°è£…å·¥å…·ç±»</p><p>ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼ŒOpenRestyå¯åŠ¨æ—¶ä¼šåŠ è½½ä»¥ä¸‹ä¸¤ä¸ªç›®å½•ä¸­çš„å·¥å…·æ–‡ä»¶ï¼š</p><figure><img src="/blog/assets/img/image-20210821104857413.9ce79b45.png" alt="image-20210821104857413" tabindex="0" loading="lazy"><figcaption>image-20210821104857413</figcaption></figure><p>æ‰€ä»¥ï¼Œè‡ªå®šä¹‰çš„httpå·¥å…·ä¹Ÿéœ€è¦æ”¾åˆ°è¿™ä¸ªç›®å½•ä¸‹ã€‚</p><p>åœ¨<code>/usr/local/openresty/lualib</code>ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªcommon.luaæ–‡ä»¶ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">vi</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/local/openresty/lualib/common.lua</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å†…å®¹å¦‚ä¸‹:</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å°è£…å‡½æ•°ï¼Œå‘é€httpè¯·æ±‚ï¼Œå¹¶è§£æå“åº”</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> read_http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">params</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> resp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.location.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">capture</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,{</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        method</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.HTTP_GET,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">params</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    })</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> not </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">resp</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        -- è®°å½•é”™è¯¯ä¿¡æ¯ï¼Œè¿”å›404</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.ERR, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;httpè¯·æ±‚æŸ¥è¯¢å¤±è´¥, path: &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> , </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;, args: &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">exit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">404</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> resp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.body</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å°†æ–¹æ³•å¯¼å‡º</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> _M</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = {  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    read_http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">read_http</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> _M</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªå·¥å…·å°†read_httpå‡½æ•°å°è£…åˆ°_Mè¿™ä¸ªtableç±»å‹çš„å˜é‡ä¸­ï¼Œå¹¶ä¸”è¿”å›ï¼Œè¿™ç±»ä¼¼äºå¯¼å‡ºã€‚</p><p>ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥åˆ©ç”¨<code>require(&#39;common&#39;)</code>æ¥å¯¼å…¥è¯¥å‡½æ•°åº“ï¼Œè¿™é‡Œçš„commonæ˜¯å‡½æ•°åº“çš„æ–‡ä»¶åã€‚</p><p>3ï¼‰å®ç°å•†å“æŸ¥è¯¢</p><p>æœ€åï¼Œæˆ‘ä»¬ä¿®æ”¹<code>/usr/local/openresty/lua/item.lua</code>æ–‡ä»¶ï¼Œåˆ©ç”¨åˆšåˆšå°è£…çš„å‡½æ•°åº“å®ç°å¯¹tomcatçš„æŸ¥è¯¢ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¼•å…¥è‡ªå®šä¹‰commonå·¥å…·æ¨¡å—ï¼Œè¿”å›å€¼æ˜¯commonä¸­è¿”å›çš„ _M</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> common</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">require</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;common&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ä» commonä¸­è·å–read_httpè¿™ä¸ªå‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> read_http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">common</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.read_http</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- è·å–è·¯å¾„å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.var[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æ ¹æ®idæŸ¥è¯¢å•†å“</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> itemJSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">read_http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/item/&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.. </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æ ¹æ®idæŸ¥è¯¢å•†å“åº“å­˜</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> itemStockJSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">read_http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/item/stock/&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.. </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡ŒæŸ¥è¯¢åˆ°çš„ç»“æœæ˜¯jsonå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”åŒ…å«å•†å“ã€åº“å­˜ä¸¤ä¸ªjsonå­—ç¬¦ä¸²ï¼Œé¡µé¢æœ€ç»ˆéœ€è¦çš„æ˜¯æŠŠä¸¤ä¸ªjsonæ‹¼æ¥ä¸ºä¸€ä¸ªjsonï¼š</p><figure><img src="/blog/assets/img/image-20210821110441222.f1354561.png" alt="image-20210821110441222" tabindex="0" loading="lazy"><figcaption>image-20210821110441222</figcaption></figure><p>è¿™å°±éœ€è¦æˆ‘ä»¬å…ˆæŠŠJSONå˜ä¸ºluaçš„tableï¼Œå®Œæˆæ•°æ®æ•´åˆåï¼Œå†è½¬ä¸ºJSONã€‚</p><h3 id="_4-4-3-cjsonå·¥å…·ç±»" tabindex="-1"><a class="header-anchor" href="#_4-4-3-cjsonå·¥å…·ç±»"><span>4.4.3.CJSONå·¥å…·ç±»</span></a></h3><p>OpenRestyæä¾›äº†ä¸€ä¸ªcjsonçš„æ¨¡å—ç”¨æ¥å¤„ç†JSONçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p><p>å®˜æ–¹åœ°å€ï¼š https://github.com/openresty/lua-cjson/</p><p>1ï¼‰å¼•å…¥cjsonæ¨¡å—ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> cjson</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">require</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;cjson&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>2ï¼‰åºåˆ—åŒ–ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> obj</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;jack&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    age</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">21</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æŠŠ table åºåˆ—åŒ–ä¸º json</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> json</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cjson</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">encode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">obj</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ï¼‰ååºåˆ—åŒ–ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> json</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;{&quot;name&quot;: &quot;jack&quot;, &quot;age&quot;: 21}&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ååºåˆ—åŒ– jsonä¸º table</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> obj</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cjson</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">decode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">json</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">obj</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.name)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-4-å®ç°tomcatæŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#_4-4-4-å®ç°tomcatæŸ¥è¯¢"><span>4.4.4.å®ç°TomcatæŸ¥è¯¢</span></a></h3><p>ä¸‹é¢ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¹‹å‰çš„item.luaä¸­çš„ä¸šåŠ¡ï¼Œæ·»åŠ jsonå¤„ç†åŠŸèƒ½ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯¼å…¥commonå‡½æ•°åº“</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> common</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">require</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;common&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> read_http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">common</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.read_http</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯¼å…¥cjsonåº“</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> cjson</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">require</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;cjson&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- è·å–è·¯å¾„å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.var[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æ ¹æ®idæŸ¥è¯¢å•†å“</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> itemJSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">read_http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/item/&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.. </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æ ¹æ®idæŸ¥è¯¢å•†å“åº“å­˜</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> itemStockJSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">read_http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/item/stock/&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.. </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- JSONè½¬åŒ–ä¸ºluaçš„table</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cjson</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">decode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">itemJSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> stock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cjson</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">decode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">stockJSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ç»„åˆæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.stock = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">stock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.stock</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.sold = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">stock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.sold</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æŠŠitemåºåˆ—åŒ–ä¸ºjson è¿”å›ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">say</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cjson</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">encode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-5-åŸºäºidè´Ÿè½½å‡è¡¡" tabindex="-1"><a class="header-anchor" href="#_4-4-5-åŸºäºidè´Ÿè½½å‡è¡¡"><span>4.4.5.åŸºäºIDè´Ÿè½½å‡è¡¡</span></a></h3><p>åˆšæ‰çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬çš„tomcatæ˜¯å•æœºéƒ¨ç½²ã€‚è€Œå®é™…å¼€å‘ä¸­ï¼Œtomcatä¸€å®šæ˜¯é›†ç¾¤æ¨¡å¼ï¼š</p><figure><img src="/blog/assets/img/image-20210821111023255.a285a54a.png" alt="image-20210821111023255" tabindex="0" loading="lazy"><figcaption>image-20210821111023255</figcaption></figure><p>å› æ­¤ï¼ŒOpenRestyéœ€è¦å¯¹tomcaté›†ç¾¤åšè´Ÿè½½å‡è¡¡ã€‚</p><p>è€Œé»˜è®¤çš„è´Ÿè½½å‡è¡¡è§„åˆ™æ˜¯è½®è¯¢æ¨¡å¼ï¼Œå½“æˆ‘ä»¬æŸ¥è¯¢/item/10001æ—¶ï¼š</p><ul><li>ç¬¬ä¸€æ¬¡ä¼šè®¿é—®8081ç«¯å£çš„tomcatæœåŠ¡ï¼Œåœ¨è¯¥æœåŠ¡å†…éƒ¨å°±å½¢æˆäº†JVMè¿›ç¨‹ç¼“å­˜</li><li>ç¬¬äºŒæ¬¡ä¼šè®¿é—®8082ç«¯å£çš„tomcatæœåŠ¡ï¼Œè¯¥æœåŠ¡å†…éƒ¨æ²¡æœ‰JVMç¼“å­˜ï¼ˆå› ä¸ºJVMç¼“å­˜æ— æ³•å…±äº«ï¼‰ï¼Œä¼šæŸ¥è¯¢æ•°æ®åº“</li><li>...</li></ul><p>ä½ çœ‹ï¼Œå› ä¸ºè½®è¯¢çš„åŸå› ï¼Œç¬¬ä¸€æ¬¡æŸ¥è¯¢8081å½¢æˆçš„JVMç¼“å­˜å¹¶æœªç”Ÿæ•ˆï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡å†æ¬¡è®¿é—®åˆ°8081æ—¶æ‰å¯ä»¥ç”Ÿæ•ˆï¼Œç¼“å­˜å‘½ä¸­ç‡å¤ªä½äº†ã€‚</p><p>æ€ä¹ˆåŠï¼Ÿ</p><p>å¦‚æœèƒ½è®©åŒä¸€ä¸ªå•†å“ï¼Œæ¯æ¬¡æŸ¥è¯¢æ—¶éƒ½è®¿é—®åŒä¸€ä¸ªtomcatæœåŠ¡ï¼Œé‚£ä¹ˆJVMç¼“å­˜å°±ä¸€å®šèƒ½ç”Ÿæ•ˆäº†ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®å•†å“idåšè´Ÿè½½å‡è¡¡ï¼Œè€Œä¸æ˜¯è½®è¯¢ã€‚</p><h4 id="_1-åŸç†" tabindex="-1"><a class="header-anchor" href="#_1-åŸç†"><span>1ï¼‰åŸç†</span></a></h4><p>nginxæä¾›äº†åŸºäºè¯·æ±‚è·¯å¾„åšè´Ÿè½½å‡è¡¡çš„ç®—æ³•ï¼š</p><p>nginxæ ¹æ®è¯·æ±‚è·¯å¾„åšhashè¿ç®—ï¼ŒæŠŠå¾—åˆ°çš„æ•°å€¼å¯¹tomcatæœåŠ¡çš„æ•°é‡å–ä½™ï¼Œä½™æ•°æ˜¯å‡ ï¼Œå°±è®¿é—®ç¬¬å‡ ä¸ªæœåŠ¡ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚</p><p>ä¾‹å¦‚ï¼š</p><ul><li>æˆ‘ä»¬çš„è¯·æ±‚è·¯å¾„æ˜¯ /item/10001</li><li>tomcatæ€»æ•°ä¸º2å°ï¼ˆ8081ã€8082ï¼‰</li><li>å¯¹è¯·æ±‚è·¯å¾„/item/1001åšhashè¿ç®—æ±‚ä½™çš„ç»“æœä¸º1</li><li>åˆ™è®¿é—®ç¬¬ä¸€ä¸ªtomcatæœåŠ¡ï¼Œä¹Ÿå°±æ˜¯8081</li></ul><p>åªè¦idä¸å˜ï¼Œæ¯æ¬¡hashè¿ç®—ç»“æœä¹Ÿä¸ä¼šå˜ï¼Œé‚£å°±å¯ä»¥ä¿è¯åŒä¸€ä¸ªå•†å“ï¼Œä¸€ç›´è®¿é—®åŒä¸€ä¸ªtomcatæœåŠ¡ï¼Œç¡®ä¿JVMç¼“å­˜ç”Ÿæ•ˆã€‚</p><h4 id="_2-å®ç°" tabindex="-1"><a class="header-anchor" href="#_2-å®ç°"><span>2ï¼‰å®ç°</span></a></h4><p>ä¿®æ”¹<code>/usr/local/openresty/nginx/conf/nginx.conf</code>æ–‡ä»¶ï¼Œå®ç°åŸºäºIDåšè´Ÿè½½å‡è¡¡ã€‚</p><p>é¦–å…ˆï¼Œå®šä¹‰tomcaté›†ç¾¤ï¼Œå¹¶è®¾ç½®åŸºäºè·¯å¾„åšè´Ÿè½½å‡è¡¡ï¼š</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">upstream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> tomcat-cluster {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    hash </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">request_uri</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 192.168.150.1:8081;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 192.168.150.1:8082;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œä¿®æ”¹å¯¹tomcatæœåŠ¡çš„åå‘ä»£ç†ï¼Œç›®æ ‡æŒ‡å‘tomcaté›†ç¾¤ï¼š</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /item {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    proxy_pass </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">http://tomcat-cluster;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡æ–°åŠ è½½OpenResty</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_3-æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3-æµ‹è¯•"><span>3ï¼‰æµ‹è¯•</span></a></h4><p>å¯åŠ¨ä¸¤å°tomcatæœåŠ¡ï¼š</p><figure><img src="/blog/assets/img/image-20210821112420464.f5f97438.png" alt="image-20210821112420464" tabindex="0" loading="lazy"><figcaption>image-20210821112420464</figcaption></figure><p>åŒæ—¶å¯åŠ¨ï¼š</p><figure><img src="/blog/assets/img/image-20210821112444482.48ccb1d5.png" alt="image-20210821112444482" tabindex="0" loading="lazy"><figcaption>image-20210821112444482</figcaption></figure><p>æ¸…ç©ºæ—¥å¿—åï¼Œå†æ¬¡è®¿é—®é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°ä¸åŒidçš„å•†å“ï¼Œè®¿é—®åˆ°äº†ä¸åŒçš„tomcatæœåŠ¡ï¼š</p><figure><img src="/blog/assets/img/image-20210821112559965.5408c13f.png" alt="image-20210821112559965" tabindex="0" loading="lazy"><figcaption>image-20210821112559965</figcaption></figure><figure><img src="/blog/assets/img/image-20210821112637430.78aa1402.png" alt="image-20210821112637430" tabindex="0" loading="lazy"><figcaption>image-20210821112637430</figcaption></figure><h2 id="_4-5-redisç¼“å­˜é¢„çƒ­" tabindex="-1"><a class="header-anchor" href="#_4-5-redisç¼“å­˜é¢„çƒ­"><span>4.5.Redisç¼“å­˜é¢„çƒ­</span></a></h2><p>Redisç¼“å­˜ä¼šé¢ä¸´å†·å¯åŠ¨é—®é¢˜ï¼š</p><p><strong>å†·å¯åŠ¨</strong>ï¼šæœåŠ¡åˆšåˆšå¯åŠ¨æ—¶ï¼ŒRedisä¸­å¹¶æ²¡æœ‰ç¼“å­˜ï¼Œå¦‚æœæ‰€æœ‰å•†å“æ•°æ®éƒ½åœ¨ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ—¶æ·»åŠ ç¼“å­˜ï¼Œå¯èƒ½ä¼šç»™æ•°æ®åº“å¸¦æ¥è¾ƒå¤§å‹åŠ›ã€‚</p><p><strong>ç¼“å­˜é¢„çƒ­</strong>ï¼šåœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¤§æ•°æ®ç»Ÿè®¡ç”¨æˆ·è®¿é—®çš„çƒ­ç‚¹æ•°æ®ï¼Œåœ¨é¡¹ç›®å¯åŠ¨æ—¶å°†è¿™äº›çƒ­ç‚¹æ•°æ®æå‰æŸ¥è¯¢å¹¶ä¿å­˜åˆ°Redisä¸­ã€‚</p><p>æˆ‘ä»¬æ•°æ®é‡è¾ƒå°‘ï¼Œå¹¶ä¸”æ²¡æœ‰æ•°æ®ç»Ÿè®¡ç›¸å…³åŠŸèƒ½ï¼Œç›®å‰å¯ä»¥åœ¨å¯åŠ¨æ—¶å°†æ‰€æœ‰æ•°æ®éƒ½æ”¾å…¥ç¼“å­˜ä¸­ã€‚</p><p>1ï¼‰åˆ©ç”¨Dockerå®‰è£…Redis</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 6379:6379</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis-server</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --appendonly</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>2ï¼‰åœ¨item-serviceæœåŠ¡ä¸­å¼•å…¥Redisä¾èµ–</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;org.springframework.boot&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;spring-boot-starter-data-redis&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ï¼‰é…ç½®Redisåœ°å€</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    host</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">192.168.150.101</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4ï¼‰ç¼–å†™åˆå§‹åŒ–ç±»</p><p>ç¼“å­˜é¢„çƒ­éœ€è¦åœ¨é¡¹ç›®å¯åŠ¨æ—¶å®Œæˆï¼Œå¹¶ä¸”å¿…é¡»æ˜¯æ‹¿åˆ°RedisTemplateä¹‹åã€‚</p><p>è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨InitializingBeanæ¥å£æ¥å®ç°ï¼Œå› ä¸ºInitializingBeanå¯ä»¥åœ¨å¯¹è±¡è¢«Springåˆ›å»ºå¹¶ä¸”æˆå‘˜å˜é‡å…¨éƒ¨æ³¨å…¥åæ‰§è¡Œã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> com.heima.item.config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.fasterxml.jackson.core.JsonProcessingException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.fasterxml.jackson.databind.ObjectMapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.heima.item.pojo.Item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.heima.item.pojo.ItemStock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.heima.item.service.IItemService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.heima.item.service.IItemStockService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.springframework.beans.factory.InitializingBean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.springframework.beans.factory.annotation.Autowired</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.springframework.data.redis.core.StringRedisTemplate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.springframework.stereotype.Component</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> java.util.List</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Component</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> RedisHandler</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> InitializingBean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> StringRedisTemplate</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> redisTemplate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> IItemService</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> itemService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> IItemStockService</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> stockService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ObjectMapper</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> MAPPER </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ObjectMapper</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> afterPropertiesSet</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // åˆå§‹åŒ–ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 1.æŸ¥è¯¢å•†å“ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Item</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">itemList</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> itemService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">list</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 2.æ”¾å…¥ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Item</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> item</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> itemList) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            // 2.1.itemåºåˆ—åŒ–ä¸ºJSON</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">            String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> json</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> MAPPER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">writeValueAsString</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(item);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            // 2.2.å­˜å…¥redis</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            redisTemplate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">opsForValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;item:id:&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), json);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 3.æŸ¥è¯¢å•†å“åº“å­˜ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ItemStock</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">stockList</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> stockService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">list</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 4.æ”¾å…¥ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ItemStock</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> stock</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> stockList) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            // 2.1.itemåºåˆ—åŒ–ä¸ºJSON</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">            String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> json</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> MAPPER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">writeValueAsString</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(stock);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            // 2.2.å­˜å…¥redis</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            redisTemplate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">opsForValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;item:stock:id:&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> stock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), json);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-6-æŸ¥è¯¢redisç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_4-6-æŸ¥è¯¢redisç¼“å­˜"><span>4.6.æŸ¥è¯¢Redisç¼“å­˜</span></a></h2><p>ç°åœ¨ï¼ŒRedisç¼“å­˜å·²ç»å‡†å¤‡å°±ç»ªï¼Œæˆ‘ä»¬å¯ä»¥å†OpenRestyä¸­å®ç°æŸ¥è¯¢Redisçš„é€»è¾‘äº†ã€‚å¦‚ä¸‹å›¾çº¢æ¡†æ‰€ç¤ºï¼š</p><figure><img src="/blog/assets/img/image-20210821113340111.bd0dcc70.png" alt="image-20210821113340111" tabindex="0" loading="lazy"><figcaption>image-20210821113340111</figcaption></figure><p>å½“è¯·æ±‚è¿›å…¥OpenRestyä¹‹åï¼š</p><ul><li>ä¼˜å…ˆæŸ¥è¯¢Redisç¼“å­˜</li><li>å¦‚æœRedisç¼“å­˜æœªå‘½ä¸­ï¼Œå†æŸ¥è¯¢Tomcat</li></ul><h3 id="_4-6-1-å°è£…rediså·¥å…·" tabindex="-1"><a class="header-anchor" href="#_4-6-1-å°è£…rediså·¥å…·"><span>4.6.1.å°è£…Rediså·¥å…·</span></a></h3><p>OpenRestyæä¾›äº†æ“ä½œRedisçš„æ¨¡å—ï¼Œæˆ‘ä»¬åªè¦å¼•å…¥è¯¥æ¨¡å—å°±èƒ½ç›´æ¥ä½¿ç”¨ã€‚ä½†æ˜¯ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å°†Redisæ“ä½œå°è£…åˆ°ä¹‹å‰çš„common.luaå·¥å…·åº“ä¸­ã€‚</p><p>ä¿®æ”¹<code>/usr/local/openresty/lualib/common.lua</code>æ–‡ä»¶ï¼š</p><p>1ï¼‰å¼•å…¥Redisæ¨¡å—ï¼Œå¹¶åˆå§‹åŒ–Rediså¯¹è±¡</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯¼å…¥redis</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">require</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;resty.redis&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- åˆå§‹åŒ–redis</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> red</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">new</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">red</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set_timeouts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰å°è£…å‡½æ•°ï¼Œç”¨æ¥é‡Šæ”¾Redisè¿æ¥ï¼Œå…¶å®æ˜¯æ”¾å…¥è¿æ¥æ± </p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å…³é—­redisè¿æ¥çš„å·¥å…·æ–¹æ³•ï¼Œå…¶å®æ˜¯æ”¾å…¥è¿æ¥æ± </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> close_redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">red</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> pool_max_idle_time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> -- è¿æ¥çš„ç©ºé—²æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> pool_size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> --è¿æ¥æ± å¤§å°</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> ok</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">red</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set_keepalive</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pool_max_idle_time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pool_size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> not </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ok</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.ERR, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;æ”¾å…¥redisè¿æ¥æ± å¤±è´¥: &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ï¼‰å°è£…å‡½æ•°ï¼Œæ ¹æ®keyæŸ¥è¯¢Redisæ•°æ®</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æŸ¥è¯¢redisçš„æ–¹æ³• ipå’Œportæ˜¯redisåœ°å€ï¼Œkeyæ˜¯æŸ¥è¯¢çš„key</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> read_redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">ip</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">port</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- è·å–ä¸€ä¸ªè¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> ok</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">red</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ip</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> not </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ok</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.ERR, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;è¿æ¥rediså¤±è´¥ : &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- æŸ¥è¯¢redis</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> resp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">red</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- æŸ¥è¯¢å¤±è´¥å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> not </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">resp</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.ERR, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;æŸ¥è¯¢Rediså¤±è´¥: &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;, key = &quot; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    --å¾—åˆ°çš„æ•°æ®ä¸ºç©ºå¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> resp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> == </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.null </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        resp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">nil</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.ERR, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;æŸ¥è¯¢Redisæ•°æ®ä¸ºç©º, key = &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    close_redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">red</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> resp</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4ï¼‰å¯¼å‡º</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å°†æ–¹æ³•å¯¼å‡º</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> _M</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = {  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    read_http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">read_http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    read_redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">read_redis</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> _M</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®Œæ•´çš„common.luaï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯¼å…¥redis</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">require</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;resty.redis&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- åˆå§‹åŒ–redis</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> red</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">new</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">red</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set_timeouts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å…³é—­redisè¿æ¥çš„å·¥å…·æ–¹æ³•ï¼Œå…¶å®æ˜¯æ”¾å…¥è¿æ¥æ± </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> close_redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">red</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> pool_max_idle_time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> -- è¿æ¥çš„ç©ºé—²æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> pool_size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> --è¿æ¥æ± å¤§å°</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> ok</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">red</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set_keepalive</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pool_max_idle_time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pool_size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> not </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ok</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.ERR, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;æ”¾å…¥redisè¿æ¥æ± å¤±è´¥: &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æŸ¥è¯¢redisçš„æ–¹æ³• ipå’Œportæ˜¯redisåœ°å€ï¼Œkeyæ˜¯æŸ¥è¯¢çš„key</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> read_redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">ip</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">port</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- è·å–ä¸€ä¸ªè¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> ok</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">red</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ip</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> not </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ok</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.ERR, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;è¿æ¥rediså¤±è´¥ : &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- æŸ¥è¯¢redis</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> resp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">red</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- æŸ¥è¯¢å¤±è´¥å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> not </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">resp</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.ERR, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;æŸ¥è¯¢Rediså¤±è´¥: &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;, key = &quot; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    --å¾—åˆ°çš„æ•°æ®ä¸ºç©ºå¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> resp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> == </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.null </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        resp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">nil</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.ERR, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;æŸ¥è¯¢Redisæ•°æ®ä¸ºç©º, key = &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    close_redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">red</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> resp</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å°è£…å‡½æ•°ï¼Œå‘é€httpè¯·æ±‚ï¼Œå¹¶è§£æå“åº”</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> read_http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">params</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> resp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.location.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">capture</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,{</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        method</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.HTTP_GET,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">params</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    })</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> not </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">resp</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        -- è®°å½•é”™è¯¯ä¿¡æ¯ï¼Œè¿”å›404</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.ERR, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;httpæŸ¥è¯¢å¤±è´¥, path: &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> , </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;, args: &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">exit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">404</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> resp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.body</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å°†æ–¹æ³•å¯¼å‡º</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> _M</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = {  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    read_http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">read_http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    read_redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">read_redis</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> _M</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-6-2-å®ç°redisæŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#_4-6-2-å®ç°redisæŸ¥è¯¢"><span>4.6.2.å®ç°RedisæŸ¥è¯¢</span></a></h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å»ä¿®æ”¹item.luaæ–‡ä»¶ï¼Œå®ç°å¯¹Redisçš„æŸ¥è¯¢äº†ã€‚</p><p>æŸ¥è¯¢é€»è¾‘æ˜¯ï¼š</p><ul><li>æ ¹æ®idæŸ¥è¯¢Redis</li><li>å¦‚æœæŸ¥è¯¢å¤±è´¥åˆ™ç»§ç»­æŸ¥è¯¢Tomcat</li><li>å°†æŸ¥è¯¢ç»“æœè¿”å›</li></ul><p>1ï¼‰ä¿®æ”¹<code>/usr/local/openresty/lua/item.lua</code>æ–‡ä»¶ï¼Œæ·»åŠ ä¸€ä¸ªæŸ¥è¯¢å‡½æ•°ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯¼å…¥commonå‡½æ•°åº“</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> common</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">require</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;common&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> read_http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">common</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.read_http</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> read_redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">common</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.read_redis</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å°è£…æŸ¥è¯¢å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> read_data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">params</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- æŸ¥è¯¢æœ¬åœ°ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> val</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">read_redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;127.0.0.1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">6379</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- åˆ¤æ–­æŸ¥è¯¢ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> not </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">val</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.ERR, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;redisæŸ¥è¯¢å¤±è´¥ï¼Œå°è¯•æŸ¥è¯¢httpï¼Œ key: &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        -- redisæŸ¥è¯¢å¤±è´¥ï¼Œå»æŸ¥è¯¢http</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        val</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">read_http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">params</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- è¿”å›æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> val</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰è€Œåä¿®æ”¹å•†å“æŸ¥è¯¢ã€åº“å­˜æŸ¥è¯¢çš„ä¸šåŠ¡ï¼š</p><figure><img src="/blog/assets/img/image-20210821114528954.1d349634.png" alt="image-20210821114528954" tabindex="0" loading="lazy"><figcaption>image-20210821114528954</figcaption></figure><p>3ï¼‰å®Œæ•´çš„item.luaä»£ç ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯¼å…¥commonå‡½æ•°åº“</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> common</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">require</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;common&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> read_http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">common</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.read_http</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> read_redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">common</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.read_redis</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯¼å…¥cjsonåº“</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> cjson</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">require</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;cjson&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å°è£…æŸ¥è¯¢å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> read_data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">params</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- æŸ¥è¯¢æœ¬åœ°ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> val</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">read_redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;127.0.0.1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">6379</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- åˆ¤æ–­æŸ¥è¯¢ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> not </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">val</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.ERR, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;redisæŸ¥è¯¢å¤±è´¥ï¼Œå°è¯•æŸ¥è¯¢httpï¼Œ key: &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        -- redisæŸ¥è¯¢å¤±è´¥ï¼Œå»æŸ¥è¯¢http</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        val</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">read_http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">params</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- è¿”å›æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> val</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- è·å–è·¯å¾„å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.var[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æŸ¥è¯¢å•†å“ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> itemJSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">read_data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;item:id:&quot; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.. </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,  </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/item/&quot; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.. </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æŸ¥è¯¢åº“å­˜ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> stockJSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">read_data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;item:stock:id:&quot; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.. </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/item/stock/&quot; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.. </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- JSONè½¬åŒ–ä¸ºluaçš„table</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cjson</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">decode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">itemJSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> stock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cjson</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">decode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">stockJSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ç»„åˆæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.stock = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">stock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.stock</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.sold = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">stock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.sold</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æŠŠitemåºåˆ—åŒ–ä¸ºjson è¿”å›ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">say</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cjson</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">encode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-7-nginxæœ¬åœ°ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_4-7-nginxæœ¬åœ°ç¼“å­˜"><span>4.7.Nginxæœ¬åœ°ç¼“å­˜</span></a></h2><p>ç°åœ¨ï¼Œæ•´ä¸ªå¤šçº§ç¼“å­˜ä¸­åªå·®æœ€åä¸€ç¯ï¼Œä¹Ÿå°±æ˜¯nginxçš„æœ¬åœ°ç¼“å­˜äº†ã€‚å¦‚å›¾ï¼š</p><figure><img src="/blog/assets/img/image-20210821114742950.50adabf0.png" alt="image-20210821114742950" tabindex="0" loading="lazy"><figcaption>image-20210821114742950</figcaption></figure><h3 id="_4-7-1-æœ¬åœ°ç¼“å­˜api" tabindex="-1"><a class="header-anchor" href="#_4-7-1-æœ¬åœ°ç¼“å­˜api"><span>4.7.1.æœ¬åœ°ç¼“å­˜API</span></a></h3><p>OpenRestyä¸ºNginxæä¾›äº†<strong>shard dict</strong>çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨nginxçš„å¤šä¸ªworkerä¹‹é—´å…±äº«æ•°æ®ï¼Œå®ç°ç¼“å­˜åŠŸèƒ½ã€‚</p><p>1ï¼‰å¼€å¯å…±äº«å­—å…¸ï¼Œåœ¨nginx.confçš„httpä¸‹æ·»åŠ é…ç½®ï¼š</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # å…±äº«å­—å…¸ï¼Œä¹Ÿå°±æ˜¯æœ¬åœ°ç¼“å­˜ï¼Œåç§°å«åšï¼šitem_cacheï¼Œå¤§å°150m</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> lua_shared_dict</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> item_cache </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">150m</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰æ“ä½œå…±äº«å­—å…¸ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- è·å–æœ¬åœ°ç¼“å­˜å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> item_cache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.shared.item_cache</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å­˜å‚¨, æŒ‡å®škeyã€valueã€è¿‡æœŸæ—¶é—´ï¼Œå•ä½sï¼Œé»˜è®¤ä¸º0ä»£è¡¨æ°¸ä¸è¿‡æœŸ</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">item_cache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;key&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;value&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- è¯»å–</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> val</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">item_cache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;key&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-7-2-å®ç°æœ¬åœ°ç¼“å­˜æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#_4-7-2-å®ç°æœ¬åœ°ç¼“å­˜æŸ¥è¯¢"><span>4.7.2.å®ç°æœ¬åœ°ç¼“å­˜æŸ¥è¯¢</span></a></h3><p>1ï¼‰ä¿®æ”¹<code>/usr/local/openresty/lua/item.lua</code>æ–‡ä»¶ï¼Œä¿®æ”¹read_dataæŸ¥è¯¢å‡½æ•°ï¼Œæ·»åŠ æœ¬åœ°ç¼“å­˜é€»è¾‘ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯¼å…¥å…±äº«è¯å…¸ï¼Œæœ¬åœ°ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> item_cache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.shared.item_cache</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å°è£…æŸ¥è¯¢å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> read_data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">expire</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">params</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- æŸ¥è¯¢æœ¬åœ°ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> val</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">item_cache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> not </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">val</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.ERR, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;æœ¬åœ°ç¼“å­˜æŸ¥è¯¢å¤±è´¥ï¼Œå°è¯•æŸ¥è¯¢Redisï¼Œ key: &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        -- æŸ¥è¯¢redis</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        val</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">read_redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;127.0.0.1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">6379</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        -- åˆ¤æ–­æŸ¥è¯¢ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> not </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">val</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">            ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.ERR, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;redisæŸ¥è¯¢å¤±è´¥ï¼Œå°è¯•æŸ¥è¯¢httpï¼Œ key: &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            -- redisæŸ¥è¯¢å¤±è´¥ï¼Œå»æŸ¥è¯¢http</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">            val</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">read_http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">params</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        end</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- æŸ¥è¯¢æˆåŠŸï¼ŒæŠŠæ•°æ®å†™å…¥æœ¬åœ°ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    item_cache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">val</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">expire</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- è¿”å›æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> val</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰ä¿®æ”¹item.luaä¸­æŸ¥è¯¢å•†å“å’Œåº“å­˜çš„ä¸šåŠ¡ï¼Œå®ç°æœ€æ–°çš„read_dataå‡½æ•°ï¼š</p><figure><img src="/blog/assets/img/image-20210821115108528.ae394c6c.png" alt="image-20210821115108528" tabindex="0" loading="lazy"><figcaption>image-20210821115108528</figcaption></figure><p>å…¶å®å°±æ˜¯å¤šäº†ç¼“å­˜æ—¶é—´å‚æ•°ï¼Œè¿‡æœŸånginxç¼“å­˜ä¼šè‡ªåŠ¨åˆ é™¤ï¼Œä¸‹æ¬¡è®¿é—®å³å¯æ›´æ–°ç¼“å­˜ã€‚</p><p>è¿™é‡Œç»™å•†å“åŸºæœ¬ä¿¡æ¯è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º30åˆ†é’Ÿï¼Œåº“å­˜ä¸º1åˆ†é’Ÿã€‚</p><p>å› ä¸ºåº“å­˜æ›´æ–°é¢‘ç‡è¾ƒé«˜ï¼Œå¦‚æœç¼“å­˜æ—¶é—´è¿‡é•¿ï¼Œå¯èƒ½ä¸æ•°æ®åº“å·®å¼‚è¾ƒå¤§ã€‚</p><p>3ï¼‰å®Œæ•´çš„item.luaæ–‡ä»¶ï¼š</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯¼å…¥commonå‡½æ•°åº“</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> common</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">require</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;common&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> read_http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">common</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.read_http</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> read_redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">common</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.read_redis</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯¼å…¥cjsonåº“</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> cjson</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">require</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;cjson&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å¯¼å…¥å…±äº«è¯å…¸ï¼Œæœ¬åœ°ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> item_cache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.shared.item_cache</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- å°è£…æŸ¥è¯¢å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> read_data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">expire</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">params</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- æŸ¥è¯¢æœ¬åœ°ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> val</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">item_cache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> not </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">val</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.ERR, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;æœ¬åœ°ç¼“å­˜æŸ¥è¯¢å¤±è´¥ï¼Œå°è¯•æŸ¥è¯¢Redisï¼Œ key: &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        -- æŸ¥è¯¢redis</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        val</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">read_redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;127.0.0.1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">6379</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        -- åˆ¤æ–­æŸ¥è¯¢ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> not </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">val</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">            ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.ERR, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;redisæŸ¥è¯¢å¤±è´¥ï¼Œå°è¯•æŸ¥è¯¢httpï¼Œ key: &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            -- redisæŸ¥è¯¢å¤±è´¥ï¼Œå»æŸ¥è¯¢http</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">            val</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">read_http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">params</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        end</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- æŸ¥è¯¢æˆåŠŸï¼ŒæŠŠæ•°æ®å†™å…¥æœ¬åœ°ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    item_cache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">val</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">expire</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    -- è¿”å›æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> val</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- è·å–è·¯å¾„å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.var[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æŸ¥è¯¢å•†å“ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> itemJSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">read_data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;item:id:&quot; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.. </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1800</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,  </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/item/&quot; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.. </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æŸ¥è¯¢åº“å­˜ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> stockJSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">read_data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;item:stock:id:&quot; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.. </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">60</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/item/stock/&quot; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.. </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- JSONè½¬åŒ–ä¸ºluaçš„table</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cjson</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">decode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">itemJSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> stock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cjson</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">decode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">stockJSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- ç»„åˆæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.stock = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">stock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.stock</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.sold = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">stock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.sold</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- æŠŠitemåºåˆ—åŒ–ä¸ºjson è¿”å›ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">say</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cjson</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">encode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_5-ç¼“å­˜åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#_5-ç¼“å­˜åŒæ­¥"><span>5.ç¼“å­˜åŒæ­¥</span></a></h1><p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨æŸ¥è¯¢åˆ°çš„éƒ½æ˜¯ç¼“å­˜æ•°æ®ï¼Œå¦‚æœç¼“å­˜æ•°æ®ä¸æ•°æ®åº“æ•°æ®å­˜åœ¨è¾ƒå¤§å·®å¼‚ï¼Œå¯èƒ½ä¼šäº§ç”Ÿæ¯”è¾ƒä¸¥é‡çš„åæœã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¿…é¡»ä¿è¯æ•°æ®åº“æ•°æ®ã€ç¼“å­˜æ•°æ®çš„ä¸€è‡´æ€§ï¼Œè¿™å°±æ˜¯ç¼“å­˜ä¸æ•°æ®åº“çš„åŒæ­¥ã€‚</p><h2 id="_5-1-æ•°æ®åŒæ­¥ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_5-1-æ•°æ®åŒæ­¥ç­–ç•¥"><span>5.1.æ•°æ®åŒæ­¥ç­–ç•¥</span></a></h2><p>ç¼“å­˜æ•°æ®åŒæ­¥çš„å¸¸è§æ–¹å¼æœ‰ä¸‰ç§ï¼š</p><p><strong>è®¾ç½®æœ‰æ•ˆæœŸ</strong>ï¼šç»™ç¼“å­˜è®¾ç½®æœ‰æ•ˆæœŸï¼Œåˆ°æœŸåè‡ªåŠ¨åˆ é™¤ã€‚å†æ¬¡æŸ¥è¯¢æ—¶æ›´æ–°</p><ul><li>ä¼˜åŠ¿ï¼šç®€å•ã€æ–¹ä¾¿</li><li>ç¼ºç‚¹ï¼šæ—¶æ•ˆæ€§å·®ï¼Œç¼“å­˜è¿‡æœŸä¹‹å‰å¯èƒ½ä¸ä¸€è‡´</li><li>åœºæ™¯ï¼šæ›´æ–°é¢‘ç‡è¾ƒä½ï¼Œæ—¶æ•ˆæ€§è¦æ±‚ä½çš„ä¸šåŠ¡</li></ul><p><strong>åŒæ­¥åŒå†™</strong>ï¼šåœ¨ä¿®æ”¹æ•°æ®åº“çš„åŒæ—¶ï¼Œç›´æ¥ä¿®æ”¹ç¼“å­˜</p><ul><li>ä¼˜åŠ¿ï¼šæ—¶æ•ˆæ€§å¼ºï¼Œç¼“å­˜ä¸æ•°æ®åº“å¼ºä¸€è‡´</li><li>ç¼ºç‚¹ï¼šæœ‰ä»£ç ä¾µå…¥ï¼Œè€¦åˆåº¦é«˜ï¼›</li><li>åœºæ™¯ï¼šå¯¹ä¸€è‡´æ€§ã€æ—¶æ•ˆæ€§è¦æ±‚è¾ƒé«˜çš„ç¼“å­˜æ•°æ®</li></ul><p>**å¼‚æ­¥é€šçŸ¥ï¼š**ä¿®æ”¹æ•°æ®åº“æ—¶å‘é€äº‹ä»¶é€šçŸ¥ï¼Œç›¸å…³æœåŠ¡ç›‘å¬åˆ°é€šçŸ¥åä¿®æ”¹ç¼“å­˜æ•°æ®</p><ul><li>ä¼˜åŠ¿ï¼šä½è€¦åˆï¼Œå¯ä»¥åŒæ—¶é€šçŸ¥å¤šä¸ªç¼“å­˜æœåŠ¡</li><li>ç¼ºç‚¹ï¼šæ—¶æ•ˆæ€§ä¸€èˆ¬ï¼Œå¯èƒ½å­˜åœ¨ä¸­é—´ä¸ä¸€è‡´çŠ¶æ€</li><li>åœºæ™¯ï¼šæ—¶æ•ˆæ€§è¦æ±‚ä¸€èˆ¬ï¼Œæœ‰å¤šä¸ªæœåŠ¡éœ€è¦åŒæ­¥</li></ul><p>è€Œå¼‚æ­¥å®ç°åˆå¯ä»¥åŸºäºMQæˆ–è€…Canalæ¥å®ç°ï¼š</p><p>1ï¼‰åŸºäºMQçš„å¼‚æ­¥é€šçŸ¥ï¼š</p><figure><img src="/blog/assets/img/image-20210821115552327.e38929cc.png" alt="image-20210821115552327" tabindex="0" loading="lazy"><figcaption>image-20210821115552327</figcaption></figure><p>è§£è¯»ï¼š</p><ul><li>å•†å“æœåŠ¡å®Œæˆå¯¹æ•°æ®çš„ä¿®æ”¹åï¼Œåªéœ€è¦å‘é€ä¸€æ¡æ¶ˆæ¯åˆ°MQä¸­ã€‚</li><li>ç¼“å­˜æœåŠ¡ç›‘å¬MQæ¶ˆæ¯ï¼Œç„¶åå®Œæˆå¯¹ç¼“å­˜çš„æ›´æ–°</li></ul><p>ä¾ç„¶æœ‰å°‘é‡çš„ä»£ç ä¾µå…¥ã€‚</p><p>2ï¼‰åŸºäºCanalçš„é€šçŸ¥</p><figure><img src="/blog/assets/img/image-20210821115719363.77324fc7.png" alt="image-20210821115719363" tabindex="0" loading="lazy"><figcaption>image-20210821115719363</figcaption></figure><p>è§£è¯»ï¼š</p><ul><li>å•†å“æœåŠ¡å®Œæˆå•†å“ä¿®æ”¹åï¼Œä¸šåŠ¡ç›´æ¥ç»“æŸï¼Œæ²¡æœ‰ä»»ä½•ä»£ç ä¾µå…¥</li><li>Canalç›‘å¬MySQLå˜åŒ–ï¼Œå½“å‘ç°å˜åŒ–åï¼Œç«‹å³é€šçŸ¥ç¼“å­˜æœåŠ¡</li><li>ç¼“å­˜æœåŠ¡æ¥æ”¶åˆ°canalé€šçŸ¥ï¼Œæ›´æ–°ç¼“å­˜</li></ul><p>ä»£ç é›¶ä¾µå…¥</p><h2 id="_5-2-å®‰è£…canal" tabindex="-1"><a class="header-anchor" href="#_5-2-å®‰è£…canal"><span>5.2.å®‰è£…Canal</span></a></h2><h3 id="_5-2-1-è®¤è¯†canal" tabindex="-1"><a class="header-anchor" href="#_5-2-1-è®¤è¯†canal"><span>5.2.1.è®¤è¯†Canal</span></a></h3><p><strong>Canal [kÉ™&#39;nÃ¦l]</strong>ï¼Œè¯‘æ„ä¸ºæ°´é“/ç®¡é“/æ²Ÿæ¸ ï¼Œcanalæ˜¯é˜¿é‡Œå·´å·´æ——ä¸‹çš„ä¸€æ¬¾å¼€æºé¡¹ç›®ï¼ŒåŸºäºJavaå¼€å‘ã€‚åŸºäºæ•°æ®åº“å¢é‡æ—¥å¿—è§£æï¼Œæä¾›å¢é‡æ•°æ®è®¢é˜…&amp;æ¶ˆè´¹ã€‚GitHubçš„åœ°å€ï¼šhttps://github.com/alibaba/canal</p><p>Canalæ˜¯åŸºäºmysqlçš„ä¸»ä»åŒæ­¥æ¥å®ç°çš„ï¼ŒMySQLä¸»ä»åŒæ­¥çš„åŸç†å¦‚ä¸‹ï¼š</p><figure><img src="/blog/assets/img/image-20210821115914748.d6f8c5ec.png" alt="image-20210821115914748" tabindex="0" loading="lazy"><figcaption>image-20210821115914748</figcaption></figure><ul><li>1ï¼‰MySQL master å°†æ•°æ®å˜æ›´å†™å…¥äºŒè¿›åˆ¶æ—¥å¿—( binary logï¼‰ï¼Œå…¶ä¸­è®°å½•çš„æ•°æ®å«åšbinary log events</li><li>2ï¼‰MySQL slave å°† master çš„ binary log eventsæ‹·è´åˆ°å®ƒçš„ä¸­ç»§æ—¥å¿—(relay log)</li><li>3ï¼‰MySQL slave é‡æ”¾ relay log ä¸­äº‹ä»¶ï¼Œå°†æ•°æ®å˜æ›´åæ˜ å®ƒè‡ªå·±çš„æ•°æ®</li></ul><p>è€ŒCanalå°±æ˜¯æŠŠè‡ªå·±ä¼ªè£…æˆMySQLçš„ä¸€ä¸ªslaveèŠ‚ç‚¹ï¼Œä»è€Œç›‘å¬masterçš„binary logå˜åŒ–ã€‚å†æŠŠå¾—åˆ°çš„å˜åŒ–ä¿¡æ¯é€šçŸ¥ç»™Canalçš„å®¢æˆ·ç«¯ï¼Œè¿›è€Œå®Œæˆå¯¹å…¶å®ƒæ•°æ®åº“çš„åŒæ­¥ã€‚</p><figure><img src="/blog/assets/img/image-20210821115948395.9ea0dfb6.png" alt="image-20210821115948395" tabindex="0" loading="lazy"><figcaption>image-20210821115948395</figcaption></figure><h3 id="_5-2-2-å®‰è£…canal" tabindex="-1"><a class="header-anchor" href="#_5-2-2-å®‰è£…canal"><span>5.2.2.å®‰è£…Canal</span></a></h3><p>å®‰è£…å’Œé…ç½®Canalå‚è€ƒè¯¾å‰èµ„æ–™æ–‡æ¡£ï¼š</p><figure><img src="data:image/png;base64,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" alt="image-20210821120017324" tabindex="0" loading="lazy"><figcaption>image-20210821120017324</figcaption></figure><h2 id="_5-3-ç›‘å¬canal" tabindex="-1"><a class="header-anchor" href="#_5-3-ç›‘å¬canal"><span>5.3.ç›‘å¬Canal</span></a></h2><p>Canalæä¾›äº†å„ç§è¯­è¨€çš„å®¢æˆ·ç«¯ï¼Œå½“Canalç›‘å¬åˆ°binlogå˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥Canalçš„å®¢æˆ·ç«¯ã€‚</p><figure><img src="/blog/assets/img/image-20210821120049024.925282c2.png" alt="image-20210821120049024" tabindex="0" loading="lazy"><figcaption>image-20210821120049024</figcaption></figure><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨Canalæä¾›çš„Javaå®¢æˆ·ç«¯ï¼Œç›‘å¬Canalé€šçŸ¥æ¶ˆæ¯ã€‚å½“æ”¶åˆ°å˜åŒ–çš„æ¶ˆæ¯æ—¶ï¼Œå®Œæˆå¯¹ç¼“å­˜çš„æ›´æ–°ã€‚</p><p>ä¸è¿‡è¿™é‡Œæˆ‘ä»¬ä¼šä½¿ç”¨GitHubä¸Šçš„ç¬¬ä¸‰æ–¹å¼€æºçš„canal-starterå®¢æˆ·ç«¯ã€‚åœ°å€ï¼šhttps://github.com/NormanGyllenhaal/canal-client</p><p>ä¸SpringBootå®Œç¾æ•´åˆï¼Œè‡ªåŠ¨è£…é…ï¼Œæ¯”å®˜æ–¹å®¢æˆ·ç«¯è¦ç®€å•å¥½ç”¨å¾ˆå¤šã€‚</p><h3 id="_5-3-1-å¼•å…¥ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#_5-3-1-å¼•å…¥ä¾èµ–"><span>5.3.1.å¼•å…¥ä¾èµ–ï¼š</span></a></h3><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;top.javatool&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;canal-spring-boot-starter&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;1.2.1-RELEASE&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-2-ç¼–å†™é…ç½®" tabindex="-1"><a class="header-anchor" href="#_5-3-2-ç¼–å†™é…ç½®"><span>5.3.2.ç¼–å†™é…ç½®ï¼š</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">canal</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  destination</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">heima</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # canalçš„é›†ç¾¤åå­—ï¼Œè¦ä¸å®‰è£…canalæ—¶è®¾ç½®çš„åç§°ä¸€è‡´</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">192.168.150.101:11111</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # canalæœåŠ¡åœ°å€</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-3-ä¿®æ”¹itemå®ä½“ç±»" tabindex="-1"><a class="header-anchor" href="#_5-3-3-ä¿®æ”¹itemå®ä½“ç±»"><span>5.3.3.ä¿®æ”¹Itemå®ä½“ç±»</span></a></h3><p>é€šè¿‡@Idã€@Columnã€ç­‰æ³¨è§£å®ŒæˆItemä¸æ•°æ®åº“è¡¨å­—æ®µçš„æ˜ å°„ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> com.heima.item.pojo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.baomidou.mybatisplus.annotation.IdType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.baomidou.mybatisplus.annotation.TableField</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.baomidou.mybatisplus.annotation.TableId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.baomidou.mybatisplus.annotation.TableName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> lombok.Data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.springframework.data.annotation.Id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.springframework.data.annotation.Transient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> javax.persistence.Column</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> java.util.Date</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Data</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">TableName</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;tb_item&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">TableId</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">type</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> IdType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">AUTO</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Id</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Long</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//å•†å“id</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Column</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;name&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//å•†å“åç§°</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> title</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//å•†å“æ ‡é¢˜</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Long</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> price</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//ä»·æ ¼ï¼ˆåˆ†ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> image</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//å•†å“å›¾ç‰‡</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> category</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//åˆ†ç±»åç§°</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> brand</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//å“ç‰Œåç§°</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> spec</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//è§„æ ¼</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Integer</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> status</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//å•†å“çŠ¶æ€ 1-æ­£å¸¸ï¼Œ2-ä¸‹æ¶</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Date</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> createTime</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//åˆ›å»ºæ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Date</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> updateTime</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//æ›´æ–°æ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">TableField</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">exist</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Transient</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Integer</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> stock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">TableField</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">exist</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Transient</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Integer</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> sold</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-4-ç¼–å†™ç›‘å¬å™¨" tabindex="-1"><a class="header-anchor" href="#_5-3-4-ç¼–å†™ç›‘å¬å™¨"><span>5.3.4.ç¼–å†™ç›‘å¬å™¨</span></a></h3><p>é€šè¿‡å®ç°<code>EntryHandler&lt;T&gt;</code>æ¥å£ç¼–å†™ç›‘å¬å™¨ï¼Œç›‘å¬Canalæ¶ˆæ¯ã€‚æ³¨æ„ä¸¤ç‚¹ï¼š</p><ul><li>å®ç°ç±»é€šè¿‡<code>@CanalTable(&quot;tb_item&quot;)</code>æŒ‡å®šç›‘å¬çš„è¡¨ä¿¡æ¯</li><li>EntryHandlerçš„æ³›å‹æ˜¯ä¸è¡¨å¯¹åº”çš„å®ä½“ç±»</li></ul><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> com.heima.item.canal</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.github.benmanes.caffeine.cache.Cache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.heima.item.config.RedisHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.heima.item.pojo.Item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.springframework.beans.factory.annotation.Autowired</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.springframework.stereotype.Component</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> top.javatool.canal.client.annotation.CanalTable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> top.javatool.canal.client.handler.EntryHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">CanalTable</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;tb_item&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Component</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ItemHandler</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> EntryHandler</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Item</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> RedisHandler</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> redisHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Cache</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Long</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Item</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> itemCache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> insert</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Item</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // å†™æ•°æ®åˆ°JVMè¿›ç¨‹ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        itemCache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), item);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // å†™æ•°æ®åˆ°redis</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        redisHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">saveItem</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(item);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> update</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Item</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> before</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Item</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> after</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // å†™æ•°æ®åˆ°JVMè¿›ç¨‹ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        itemCache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">after</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), after);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // å†™æ•°æ®åˆ°redis</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        redisHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">saveItem</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(after);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> delete</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Item</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // åˆ é™¤æ•°æ®åˆ°JVMè¿›ç¨‹ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        itemCache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">invalidate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // åˆ é™¤æ•°æ®åˆ°redis</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        redisHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">deleteItemById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™é‡Œå¯¹Redisçš„æ“ä½œéƒ½å°è£…åˆ°äº†RedisHandlerè¿™ä¸ªå¯¹è±¡ä¸­ï¼Œæ˜¯æˆ‘ä»¬ä¹‹å‰åšç¼“å­˜é¢„çƒ­æ—¶ç¼–å†™çš„ä¸€ä¸ªç±»ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> com.heima.item.config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.fasterxml.jackson.core.JsonProcessingException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.fasterxml.jackson.databind.ObjectMapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.heima.item.pojo.Item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.heima.item.pojo.ItemStock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.heima.item.service.IItemService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.heima.item.service.IItemStockService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.springframework.beans.factory.InitializingBean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.springframework.beans.factory.annotation.Autowired</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.springframework.data.redis.core.StringRedisTemplate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.springframework.stereotype.Component</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> java.util.List</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Component</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> RedisHandler</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> InitializingBean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> StringRedisTemplate</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> redisTemplate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> IItemService</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> itemService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> IItemStockService</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> stockService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ObjectMapper</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> MAPPER </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ObjectMapper</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> afterPropertiesSet</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // åˆå§‹åŒ–ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 1.æŸ¥è¯¢å•†å“ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Item</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">itemList</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> itemService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">list</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 2.æ”¾å…¥ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Item</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> item</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> itemList) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            // 2.1.itemåºåˆ—åŒ–ä¸ºJSON</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">            String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> json</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> MAPPER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">writeValueAsString</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(item);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            // 2.2.å­˜å…¥redis</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            redisTemplate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">opsForValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;item:id:&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), json);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 3.æŸ¥è¯¢å•†å“åº“å­˜ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ItemStock</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">stockList</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> stockService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">list</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 4.æ”¾å…¥ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ItemStock</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> stock</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> stockList) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            // 2.1.itemåºåˆ—åŒ–ä¸ºJSON</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">            String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> json</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> MAPPER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">writeValueAsString</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(stock);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            // 2.2.å­˜å…¥redis</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            redisTemplate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">opsForValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;item:stock:id:&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> stock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), json);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> saveItem</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Item</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        try</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">            String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> json</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> MAPPER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">writeValueAsString</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(item);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            redisTemplate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">opsForValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;item:id:&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), json);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">JsonProcessingException</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(e);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> deleteItemById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Long</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        redisTemplate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">delete</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;item:id:&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> id);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/JL-20191210/blog/edit/main/src/Database/Redis/3.é«˜çº§/Redisé«˜çº§ç¯‡-å¤šçº§ç¼“å­˜/å¤šçº§ç¼“å­˜.md" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<!----></a></div><div class="vp-meta-item git-info"><!----><!----></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">å“Ÿå¼~</div><div class="vp-copyright">Copyright Â© 2025 æ¥æ¯å†°æŸ æª¬ </div></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script src="/blog/assets/js/runtime~app.f86e1f39.js" defer></script><script src="/blog/assets/js/9703.e09ff620.js" defer></script><script src="/blog/assets/js/app.3bf3e4c1.js" defer></script>
  </body>
</html>
