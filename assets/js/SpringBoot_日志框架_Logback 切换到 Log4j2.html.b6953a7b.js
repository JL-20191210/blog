"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[92255],{66262:(s,i)=>{i.A=(s,i)=>{const a=s.__vccOpts||s;for(const[s,l]of i)a[s]=l;return a}},16836:(s,i,a)=>{a.r(i),a.d(i,{comp:()=>t,data:()=>e});var l=a(20641);const n={},t=(0,a(66262).A)(n,[["render",function(s,i){return(0,l.uX)(),(0,l.CE)("div",null,[i[0]||(i[0]=(0,l.Lk)("h1",{id:"🚀-从-logback-切换到-log4j2-spring-boot-高性能日志配置实战",tabindex:"-1"},[(0,l.Lk)("a",{class:"header-anchor",href:"#🚀-从-logback-切换到-log4j2-spring-boot-高性能日志配置实战"},[(0,l.Lk)("span",null,"🚀 从 Logback 切换到 Log4j2：Spring Boot 高性能日志配置实战")])],-1)),i[1]||(i[1]=(0,l.Lk)("blockquote",null,[(0,l.Lk)("p",null,"Spring Boot 默认使用 Logback 作为日志实现，但 Log4j2 拥有更高的性能、更强的灵活性和更丰富的配置能力。本文将带你一步一步完成从 Logback 到 Log4j2 的切换过程，并附带实战示例。")],-1)),i[2]||(i[2]=(0,l.Lk)("hr",null,null,-1)),(0,l.Q3)(" more "),i[3]||(i[3]=(0,l.Fv)('<h2 id="✨-为什么选择-log4j2" tabindex="-1"><a class="header-anchor" href="#✨-为什么选择-log4j2"><span>✨ 为什么选择 Log4j2？</span></a></h2><table><thead><tr><th>特性</th><th>Logback</th><th>Log4j2</th></tr></thead><tbody><tr><td>异步日志性能</td><td>中等</td><td>🚀 极高（基于 LMAX Disruptor）</td></tr><tr><td>彩色控制台日志</td><td>支持但麻烦</td><td>✅ 原生支持（%highlight, %style）</td></tr><tr><td>日志归档策略</td><td>较弱</td><td>✅ 强大（支持时间+大小组合）</td></tr><tr><td>动态日志控制</td><td>一般</td><td>✅ 支持脚本、自动刷新</td></tr><tr><td>配置灵活度</td><td>较高</td><td>✅ 更高，支持 JSON/YAML/XML</td></tr><tr><td>Spring Boot 默认</td><td>✅ 是</td><td>❌ 需手动切换</td></tr></tbody></table><blockquote><p>总之：<strong>Logback 更适合快速上手，Log4j2 更适合中大型项目的灵活管理与高性能需求。</strong></p></blockquote><hr><h2 id="🧱-1-移除-logback-添加-log4j2-依赖" tabindex="-1"><a class="header-anchor" href="#🧱-1-移除-logback-添加-log4j2-依赖"><span>🧱 1. 移除 Logback，添加 Log4j2 依赖</span></a></h2><h3 id="✅-1-1-排除-spring-boot-默认的-logback" tabindex="-1"><a class="header-anchor" href="#✅-1-1-排除-spring-boot-默认的-logback"><span>✅ 1.1 排除 Spring Boot 默认的 Logback</span></a></h3><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;org.springframework.boot&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;spring-boot-starter&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">exclusions</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">exclusion</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;org.springframework.boot&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;spring-boot-starter-logging&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">exclusion</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">exclusions</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="✅-1-2-引入-log4j2-starter" tabindex="-1"><a class="header-anchor" href="#✅-1-2-引入-log4j2-starter"><span>✅ 1.2 引入 Log4j2 Starter</span></a></h3><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;org.springframework.boot&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;spring-boot-starter-log4j2&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="📁-2-添加-log4j2-配置文件" tabindex="-1"><a class="header-anchor" href="#📁-2-添加-log4j2-配置文件"><span>📁 2. 添加 Log4j2 配置文件</span></a></h2><p>在 <code>src/main/resources</code> 目录下，新增文件：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>log4j2-spring.xml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="✅-示例配置-支持彩色控制台-文件日志" tabindex="-1"><a class="header-anchor" href="#✅-示例配置-支持彩色控制台-文件日志"><span>✅ 示例配置（支持彩色控制台 + 文件日志）：</span></a></h3><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;?</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">xml</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;1.0&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> encoding</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;UTF-8&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">?&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Configuration</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> status</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;WARN&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> monitorInterval</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;30&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Appenders</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Console</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Console&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> target</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;SYSTEM_OUT&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">PatternLayout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Pattern</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;%style{%d{HH:mm:ss}}{cyan} %highlight{[%-5level]} %style{%logger{36}}{blue} - %msg%n&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Pattern</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">PatternLayout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Console</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">RollingFile</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;FileAppender&quot;</span></span>\n<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">                 fileName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;logs/app.log&quot;</span></span>\n<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">                 filePattern</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;logs/archive/app-%d{yyyy-MM-dd}-%i.log.gz&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">PatternLayout</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> pattern</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;%d{yyyy-MM-dd HH:mm:ss} [%-5level] %logger{36} - %msg%n&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Policies</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">TimeBasedTriggeringPolicy</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> interval</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;1&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> modulate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;true&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">SizeBasedTriggeringPolicy</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;50MB&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Policies</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">DefaultRolloverStrategy</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> max</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;30&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">RollingFile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Appenders</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Loggers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> level</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;INFO&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">AppenderRef</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Console&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">AppenderRef</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;FileAppender&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Root</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Loggers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Configuration</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="⚙️-3-添加运行参数支持彩色输出" tabindex="-1"><a class="header-anchor" href="#⚙️-3-添加运行参数支持彩色输出"><span>⚙️ 3. 添加运行参数支持彩色输出</span></a></h2><p>在 JVM 启动参数中加入：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>-Dlog4j.skipJansi=false</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="💡-idea-中设置方式" tabindex="-1"><a class="header-anchor" href="#💡-idea-中设置方式"><span>💡 IDEA 中设置方式：</span></a></h3><ul><li><p>打开 <code>Run → Edit Configurations</code></p></li><li><p>在 VM options 中添加：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>-Dlog4j.skipJansi=false</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><hr><h2 id="📦-4-使用方式不变-lombok-示例" tabindex="-1"><a class="header-anchor" href="#📦-4-使用方式不变-lombok-示例"><span>📦 4. 使用方式不变（Lombok 示例）</span></a></h2><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> lombok.extern.log4j.Log4j2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Log4j2</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Service</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> DemoService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> test</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Log4j2 已成功启用！&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;这是错误日志！&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="✅-5-常见问题排查" tabindex="-1"><a class="header-anchor" href="#✅-5-常见问题排查"><span>✅ 5. 常见问题排查</span></a></h2><table><thead><tr><th>问题</th><th>原因</th><th>解决方法</th></tr></thead><tbody><tr><td>日志无法打印</td><td>log4j2 配置文件没生效</td><td>文件必须命名为 <code>log4j2-spring.xml</code>，并放在 <code>resources</code> 下</td></tr><tr><td>控制台没有颜色</td><td>缺少参数或终端不支持</td><td>添加 <code>-Dlog4j.skipJansi=false</code>，使用支持 ANSI 的终端</td></tr><tr><td>日志归档太频繁</td><td>filePattern 时间粒度太细</td><td>使用 <code>%d{yyyy-MM-dd}</code> 而非 <code>%d{HH-mm-ss}</code></td></tr><tr><td>仍打印 Logback 样式</td><td>依赖未排除干净</td><td>确保 <code>spring-boot-starter-logging</code> 被排除</td></tr></tbody></table><hr><h2 id="📌-小结" tabindex="-1"><a class="header-anchor" href="#📌-小结"><span>📌 小结</span></a></h2><table><thead><tr><th>步骤</th><th>内容</th></tr></thead><tbody><tr><td>1️⃣ 排除 Logback 依赖</td><td>使用 exclusions</td></tr><tr><td>2️⃣ 添加 Log4j2 依赖</td><td>引入 <code>spring-boot-starter-log4j2</code></td></tr><tr><td>3️⃣ 创建配置文件</td><td>放在 <code>resources/log4j2-spring.xml</code></td></tr><tr><td>4️⃣ 配置控制台输出</td><td>支持彩色与归档</td></tr><tr><td>5️⃣ 设置 JVM 参数</td><td>启用颜色支持</td></tr><tr><td>6️⃣ 正常使用</td><td>支持 <code>@Log4j2</code> 或 <code>@Slf4j</code></td></tr></tbody></table>',30))])}]]),e=JSON.parse('{"path":"/SpringBoot/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/Logback%20%E5%88%87%E6%8D%A2%E5%88%B0%20Log4j2.html","title":"🚀从 Logback 切换到 Log4j2","lang":"zh-CN","frontmatter":{"title":"🚀从 Logback 切换到 Log4j2","date":"2025-07-05T00:00:00.000Z","author":"JeanHu","icon":"fa-solid fa-file-lines","categories":["Spring Boot","日志系统","项目实战"],"tags":["Log4j2","日志归档","多级日志","彩色控制台","日志分模块","异步日志","Spring Boot 配置"],"gitInclude":[]},"headers":[{"level":2,"title":"✨ 为什么选择 Log4j2？","slug":"✨-为什么选择-log4j2","link":"#✨-为什么选择-log4j2","children":[]},{"level":2,"title":"🧱 1. 移除 Logback，添加 Log4j2 依赖","slug":"🧱-1-移除-logback-添加-log4j2-依赖","link":"#🧱-1-移除-logback-添加-log4j2-依赖","children":[{"level":3,"title":"✅ 1.1 排除 Spring Boot 默认的 Logback","slug":"✅-1-1-排除-spring-boot-默认的-logback","link":"#✅-1-1-排除-spring-boot-默认的-logback","children":[]},{"level":3,"title":"✅ 1.2 引入 Log4j2 Starter","slug":"✅-1-2-引入-log4j2-starter","link":"#✅-1-2-引入-log4j2-starter","children":[]}]},{"level":2,"title":"📁 2. 添加 Log4j2 配置文件","slug":"📁-2-添加-log4j2-配置文件","link":"#📁-2-添加-log4j2-配置文件","children":[{"level":3,"title":"✅ 示例配置（支持彩色控制台 + 文件日志）：","slug":"✅-示例配置-支持彩色控制台-文件日志","link":"#✅-示例配置-支持彩色控制台-文件日志","children":[]}]},{"level":2,"title":"⚙️ 3. 添加运行参数支持彩色输出","slug":"⚙️-3-添加运行参数支持彩色输出","link":"#⚙️-3-添加运行参数支持彩色输出","children":[{"level":3,"title":"💡 IDEA 中设置方式：","slug":"💡-idea-中设置方式","link":"#💡-idea-中设置方式","children":[]}]},{"level":2,"title":"📦 4. 使用方式不变（Lombok 示例）","slug":"📦-4-使用方式不变-lombok-示例","link":"#📦-4-使用方式不变-lombok-示例","children":[]},{"level":2,"title":"✅ 5. 常见问题排查","slug":"✅-5-常见问题排查","link":"#✅-5-常见问题排查","children":[]},{"level":2,"title":"📌 小结","slug":"📌-小结","link":"#📌-小结","children":[]}],"readingTime":{"minutes":2.44,"words":731},"filePathRelative":"SpringBoot/日志框架/Logback 切换到 Log4j2.md","localizedDate":"2025年7月5日","excerpt":"\\n<blockquote>\\n<p>Spring Boot 默认使用 Logback 作为日志实现，但 Log4j2 拥有更高的性能、更强的灵活性和更丰富的配置能力。本文将带你一步一步完成从 Logback 到 Log4j2 的切换过程，并附带实战示例。</p>\\n</blockquote>\\n<hr>\\n"}')}}]);