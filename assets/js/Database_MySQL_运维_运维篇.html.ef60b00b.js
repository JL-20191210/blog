"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[55489],{66262:(i,s)=>{s.A=(i,s)=>{const a=i.__vccOpts||i;for(const[i,n]of s)a[i]=n;return a}},31821:(i,s,a)=>{a.r(s),a.d(s,{comp:()=>yi,data:()=>Ai});var n=a(20641);const e=a.p+"assets/img/58131011726.e0a646e0.png",l=a.p+"assets/img/4454682776.b3695918.png",t=a.p+"assets/img/7410105910882.f64ae350.png",g=a.p+"assets/img/21103533211.4d8a1b9e.png",p=a.p+"assets/img/24794193710.3572a342.png",h=a.p+"assets/img/91294866110.b170a252.png",d=a.p+"assets/img/10617439921.6240a803.png",r=a.p+"assets/img/21053341798.07e6e416.png",c=a.p+"assets/img/6153782135.607e3349.png",k=a.p+"assets/img/4765397657.42b0634f.png",m=a.p+"assets/img/35239910325.9593c1da.png",o=a.p+"assets/img/4616215143.ea08a60e.png",f=a.p+"assets/img/86213810658.771768ee.png",b=a.p+"assets/img/81010325101039.e940caac.png",u=a.p+"assets/img/6382138721.9cb80c6f.png",y=a.p+"assets/img/101795210673.75634b31.png",A=a.p+"assets/img/96457210797.02d4d256.png",v=a.p+"assets/img/1891042610310.cdded0bd.png",B=a.p+"assets/img/qwe1324t14t.f760e9df.png",F=a.p+"assets/img/10197188896.e13f47d5.png",x=a.p+"assets/img/59710648531.556f27b7.png",D=a.p+"assets/img/32368131027.130804ac.png",C=a.p+"assets/img/7484479134.4f073f8f.png",z=a.p+"assets/img/10769359339.66ca07bc.png",_=a.p+"assets/img/91315810623.0f4f6bab.png",q=a.p+"assets/img/951010415971.4f48839e.png",M=a.p+"assets/img/84271093639.b418b5be.png",L=a.p+"assets/img/3853211256.b763159d.png",E=a.p+"assets/img/9325751819.da58999c.png",S=a.p+"assets/img/21931016227.fd4a8945.png",w=a.p+"assets/img/9852726692.738d7ea4.png",Q=a.p+"assets/img/58109378671.5baade11.png",T=a.p+"assets/img/1269361453.c771ca4b.png",O=a.p+"assets/img/9977715254.903d598a.png",N=a.p+"assets/img/131081045236.3d705d10.png",R=a.p+"assets/img/34510781883.276ff218.png",W=a.p+"assets/img/2654319698.f89ebeb9.png",G=a.p+"assets/img/22173110191.6f1a47fa.png",I=a.p+"assets/img/7347361194.455cbda8.png",j=a.p+"assets/img/73610917872.dddbcda1.png",H=a.p+"assets/img/3171425417.bb34a211.png",J=a.p+"assets/img/667103121103.f0f401e7.png",P=a.p+"assets/img/11088699372.f89c1b7c.png",V=a.p+"assets/img/2632725279.8dc16e28.png",X=a.p+"assets/img/1452119317.c796bf33.png",Z=a.p+"assets/img/2375113118.545a570f.png",K=a.p+"assets/img/1368697562.1e4b0e08.png",U=a.p+"assets/img/53710618932.fba3a06e.png",Y=a.p+"assets/img/8619959324.b850f760.png",$=a.p+"assets/img/1010769110977.b5d09a11.png",ii=a.p+"assets/img/109109981999.eacd9486.png",si=a.p+"assets/img/4762746916.99a3c582.png",ai=a.p+"assets/img/22673141012.f53af480.png",ni=a.p+"assets/img/73451065142.e229adab.png",ei=a.p+"assets/img/7348156477.3c3ac2b2.png",li=a.p+"assets/img/52510452433.0dd20baf.png",ti=a.p+"assets/img/10918829811.e87fb9f9.png",gi=a.p+"assets/img/52287271210.9f383b51.png",pi=a.p+"assets/img/4564143383.39a81b39.png",hi=a.p+"assets/img/245101066682.09f5d0e9.png",di=a.p+"assets/img/6338368756.054448ce.png",ri=a.p+"assets/img/2677654314.a2f6a582.png",ci=a.p+"assets/img/105101448841.37cdf030.png",ki=a.p+"assets/img/7237222812.b2f0ce1e.png",mi=a.p+"assets/img/6246592973.ef5a3d46.png",oi=a.p+"assets/img/12919109752.921775af.png",fi=a.p+"assets/img/8536419478.c2a3ddde.png",bi=a.p+"assets/img/15610682864.a7505367.png",ui={},yi=(0,a(66262).A)(ui,[["render",function(i,s){return(0,n.uX)(),(0,n.CE)("div",null,s[0]||(s[0]=[(0,n.Fv)('<h1 id="运维篇" tabindex="-1"><a class="header-anchor" href="#运维篇"><span>运维篇</span></a></h1><h2 id="日志" tabindex="-1"><a class="header-anchor" href="#日志"><span>日志</span></a></h2><h3 id="错误日志" tabindex="-1"><a class="header-anchor" href="#错误日志"><span>错误日志</span></a></h3><p>错误日志是 MySQL 中最重要的日志之一，它记录了当 mysqld 启动和停止时，以及服务器在运行过程中发生任何严重错误时的相关信息当数据库出现任何故障导致无法正常使用时，建议首先查看此日志。</p><p>该日志是默认开启的，默认存放目录 /var/log/，默认的日志文件名为 mysqld.log 。查看日志位置：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>show variables like &#39;%log_error%&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="二进制日志" tabindex="-1"><a class="header-anchor" href="#二进制日志"><span>二进制日志</span></a></h3><h4 id="介绍" tabindex="-1"><a class="header-anchor" href="#介绍"><span>介绍</span></a></h4><p>二进制日志(BINLOG)记录了所有的 DDL(数据定义语言)语句和 DML(数据操纵语言)语句，但不包括数据查询(SELECT、SHOW)语句。</p><p>作用：</p><ol><li>灾难时的数据恢复；</li><li>MySQL的主从复制。</li></ol><p>在MVSOL8版本中，默认二进制日志是开启着的，涉及到的参数如下：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>show variables like &#39;%log_bin%&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="日志格式" tabindex="-1"><a class="header-anchor" href="#日志格式"><span>日志格式</span></a></h4><p>MySQL服务器中提供了多种格式来记录二进制记录，具体格式及特点如下：</p><table><thead><tr><th>日志格式</th><th>含义</th></tr></thead><tbody><tr><td>statement</td><td>基于SQL语句的日志记录，记录的是SQL语句，对数据进行修改的SQL都会记录在日志文件中。</td></tr><tr><td>row</td><td>基于行的日志记录，记录的是每一行的数据变更。<strong>(默认)</strong></td></tr><tr><td>mined</td><td>混合了STATEMENT和ROW两种格式，默认采用STATEMENT，在某些特殊情况下会自动切换为ROW进行记录。</td></tr></tbody></table><p>查看参数方式：<code>show variables like &#39;%binlog_format%&#39;;</code></p><h4 id="日志查看" tabindex="-1"><a class="header-anchor" href="#日志查看"><span>日志查看</span></a></h4><p>由于日志是以二进制方式存储的，不能直接读取，需要通过二进制日志查询工具 mysqlbinlog 来查看，具体语法：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysqlbinlog[参数选项]logfilename</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">参数选项：</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    -d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    指定数据库名称，只列出指定的数据库相关的操作。</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    -o</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    忽略掉日志中的前n行命令。</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    -v</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    将行事件</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">数据变更</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">重构为SOL语句。</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    -w</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    将行事件</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">数据变更</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">重构为SQL语句，并输出注释信息</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="日志删除" tabindex="-1"><a class="header-anchor" href="#日志删除"><span>日志删除</span></a></h4><p>对于比较繁忙的业务系统，每天生成的binlog数据巨大，如果长时间不清除，将会占用大量磁盘空间。可以通过以下几种方式清理日志：</p><table><thead><tr><th>指令</th><th>含义</th></tr></thead><tbody><tr><td>reset master</td><td>删除全部 binlog 日志，删除之后，日志编号，将从 binlog.000001重新开始</td></tr><tr><td>purge master logs to ‘binlog.***’</td><td>删除 *** 编号之前的所有日志</td></tr><tr><td>purge master logs before ‘yyyy-mm-dd hh24:mi:ss’</td><td>删除日志为”yyyy-mm-dd hh24:mi:ss”之前产生的所有日志</td></tr></tbody></table><p>🍨 purge:清除</p><p>也可以在mysql的配置文件中配置二进制日志的过期时间，设置了之后，二进制日志过期会自动删除.</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">show variables </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">like</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;%binlog_expire_logs_seconds%&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>默认30天</p><h3 id="查询日志" tabindex="-1"><a class="header-anchor" href="#查询日志"><span>查询日志</span></a></h3><p>查询日志中记录了客户端的所有操作语句，而二进制日志不包含查询数据的SQL语句。默认情况下，查询日志是未开启的。如果需要开启查询日志，可以设置一下配置：</p><p>修改MySQL的配置文件 /etc/my.cnf 文件，添加如下内容：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>#该选项用来开启查询日志，可选值：0或者1；0代表关闭，1代表开启</span></span>\n<span class="line"><span>general_log=1</span></span>\n<span class="line"><span>#设置日志的文件名 ， 如果没有指定，默认的文件名为 host_name.log</span></span>\n<span class="line"><span>general_log_file=mysql_query.log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="慢查询日志" tabindex="-1"><a class="header-anchor" href="#慢查询日志"><span>慢查询日志</span></a></h3><p>修改MySQL的配置文件 /etc/my.cnf 文件</p><p>慢查询日志记录了所有执行时间超过参数 <code>long_query_time </code>设置值并且扫描记录数不小于 <code>min_examined_row_limit</code>的所有的SQL语句的日志，默认未开启。<code>long_query_time </code>默认为 10 秒，最小为0，精度可以到微秒。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>#慢查询日志</span></span>\n<span class="line"><span>slow_query_log=1</span></span>\n<span class="line"><span>#执行时间参数</span></span>\n<span class="line"><span>long_query_time=2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>默认情况下，不会记录管理语句，也不会记录不使用索引进行查找的查询。可以使用<code>log_slow_admin_statements</code>和更改此行为<code>log_queries_not_using_indexes</code>，如下所述。</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">#记录执行较慢的管理语句</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">log_slow_admin_statements </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">#记录执行较慢的未使用索引的语句</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">log_queries_not_using_indexes </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="主从复制" tabindex="-1"><a class="header-anchor" href="#主从复制"><span>主从复制</span></a></h2><figure><img src="'+e+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+l+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="原理" tabindex="-1"><a class="header-anchor" href="#原理"><span>原理</span></a></h3><figure><img src="'+t+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="搭建实现" tabindex="-1"><a class="header-anchor" href="#搭建实现"><span>搭建实现</span></a></h3><h4 id="主库配置" tabindex="-1"><a class="header-anchor" href="#主库配置"><span>主库配置</span></a></h4><figure><img src="'+g+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+p+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+h+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">create</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &#39;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">itcast</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&#39;@</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> identified </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> mysql_native_password </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">by</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;111111&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">grant</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> replication slave </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> *.* </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;itcast&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">show </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">master</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> status</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="从库配置" tabindex="-1"><a class="header-anchor" href="#从库配置"><span>从库配置</span></a></h4><figure><img src="'+d+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+r+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">change replication source </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">to</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> source_host</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;192.168.68.201&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,source_user</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;itcast&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,source_password</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;111111&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,source_log_file</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;binlog.000003&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,source_log_pos</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">664</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="'+c+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">start</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> replica</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">stop</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> replica</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">show </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">replica</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> status</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">\\G;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="测试" tabindex="-1"><a class="header-anchor" href="#测试"><span>测试</span></a></h4><p>1、在主库上创建数据库、表，并插入数据</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">create</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> database</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> db01</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">use</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> db01;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">create</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> table</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> tb_use</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">\tid </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">11</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">primary key</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> not null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> auto_increment,</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">\tname</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">50</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">not null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">\tsex </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">varchar</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)engine</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">innodb </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">default</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> charset</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">utf8mb4;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">insert into</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> tb_user(id, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, sex) valurs (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Tom&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;1&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Trigger&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;0&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Dawn&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;1&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2、在从库中查询数据，验证主从是否同步。</p><h2 id="分库分表" tabindex="-1"><a class="header-anchor" href="#分库分表"><span>分库分表</span></a></h2><h3 id="介绍-1" tabindex="-1"><a class="header-anchor" href="#介绍-1"><span>介绍</span></a></h3><figure><img src="'+k+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+m+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="https://jimhackking.github.io/运维/MySQL学习笔记/106169108266.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+o+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+f+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="mycat概述" tabindex="-1"><a class="header-anchor" href="#mycat概述"><span>Mycat概述</span></a></h3><figure><img src="'+b+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+u+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+y+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="mycat入门" tabindex="-1"><a class="header-anchor" href="#mycat入门"><span>Mycat入门</span></a></h3><figure><img src="'+A+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+v+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+B+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+F+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+x+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="mycat配置" tabindex="-1"><a class="header-anchor" href="#mycat配置"><span>Mycat配置</span></a></h3><h4 id="schema-xml" tabindex="-1"><a class="header-anchor" href="#schema-xml"><span>schema.xml</span></a></h4><p>schema.xml作为MyCat中最重要的配置文件之一,涵盖了MyCat的逻辑库 、逻辑表 、分片规则、分片节点及数据源的配置.</p><p>主要包含以下三组标签:</p><ul><li>schema标签</li><li>datanode标签</li><li>datahost标签</li></ul><figure><img src="'+D+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+C+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+z+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+_+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h4 id="rule-xml" tabindex="-1"><a class="header-anchor" href="#rule-xml"><span>rule.xml</span></a></h4><figure><img src="'+q+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+M+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+L+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="mycat分片" tabindex="-1"><a class="header-anchor" href="#mycat分片"><span>Mycat分片</span></a></h3><h4 id="垂直分库" tabindex="-1"><a class="header-anchor" href="#垂直分库"><span>垂直分库</span></a></h4><figure><img src="'+E+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+S+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+w+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+Q+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h4 id="水平分表" tabindex="-1"><a class="header-anchor" href="#水平分表"><span>水平分表</span></a></h4><figure><img src="'+T+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+O+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+N+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h4 id="分片规则" tabindex="-1"><a class="header-anchor" href="#分片规则"><span>分片规则</span></a></h4><h5 id="范围分片" tabindex="-1"><a class="header-anchor" href="#范围分片"><span>范围分片</span></a></h5><figure><img src="'+R+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+W+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h5 id="取模分片" tabindex="-1"><a class="header-anchor" href="#取模分片"><span>取模分片</span></a></h5><figure><img src="'+G+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+I+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h5 id="一致性hash算法" tabindex="-1"><a class="header-anchor" href="#一致性hash算法"><span>一致性hash算法</span></a></h5><figure><img src="'+j+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+H+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h5 id="枚举分片" tabindex="-1"><a class="header-anchor" href="#枚举分片"><span>枚举分片</span></a></h5><figure><img src="'+J+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+P+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h5 id="应用指定算法" tabindex="-1"><a class="header-anchor" href="#应用指定算法"><span>应用指定算法</span></a></h5><figure><img src="'+V+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+X+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h5 id="固定hash算法" tabindex="-1"><a class="header-anchor" href="#固定hash算法"><span>固定hash算法</span></a></h5><figure><img src="'+Z+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+K+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h5 id="字符串hash解析" tabindex="-1"><a class="header-anchor" href="#字符串hash解析"><span>字符串hash解析</span></a></h5><figure><img src="'+U+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+Y+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h5 id="按天分片" tabindex="-1"><a class="header-anchor" href="#按天分片"><span>按天分片</span></a></h5><figure><img src="'+$+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+ii+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h5 id="按自然月分片" tabindex="-1"><a class="header-anchor" href="#按自然月分片"><span>按自然月分片</span></a></h5><figure><img src="'+si+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+ai+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="mycat管理及监控" tabindex="-1"><a class="header-anchor" href="#mycat管理及监控"><span>Mycat管理及监控</span></a></h3><figure><img src="'+ni+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+ei+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h2 id="读写分离" tabindex="-1"><a class="header-anchor" href="#读写分离"><span>读写分离</span></a></h2><figure><img src="'+li+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="介绍-2" tabindex="-1"><a class="header-anchor" href="#介绍-2"><span>介绍</span></a></h3><figure><img src="'+ti+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="一主一从读写分离" tabindex="-1"><a class="header-anchor" href="#一主一从读写分离"><span>一主一从读写分离</span></a></h3><figure><img src="'+gi+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+pi+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="双主双从" tabindex="-1"><a class="header-anchor" href="#双主双从"><span>双主双从</span></a></h3><figure><img src="'+hi+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+di+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+ri+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+ci+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+ki+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+mi+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+oi+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>测试：</p><p>分别在两台主库Master1、Master2上执行DDL、DML语句，查看涉及到的数据库服务器的数据同步情况。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>create database db01;</span></span>\n<span class="line"><span>use db01;</span></span>\n<span class="line"><span>create table tb_user(</span></span>\n<span class="line"><span>\tid in(11)not null primary key,</span></span>\n<span class="line"><span>\tname varchar(50) not null,</span></span>\n<span class="line"><span>\tsex varcahr(1)</span></span>\n<span class="line"><span>)engine=innodb default charset=utf8mb4</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>insert into tb user(id,name,sex) values(l,&#39;Tom&#39;,&#39;1&#39;);</span></span>\n<span class="line"><span>insert into tb user(id,name,sex) values(2,&#39;Trigger&#39;,&#39;0&#39;);</span></span>\n<span class="line"><span>insert into tb user(id,name,sex) values(3,&#39;Dawn&#39;,&#39;1&#39;);</span></span>\n<span class="line"><span>insert into tb user(id,name,sex) values(4,&quot;ack Ma&#39;,&#39;1&#39;);</span></span>\n<span class="line"><span>insertinto tb user(id,name,sex) values(5,&#39;Coco&#39;,&#39;0&#39;);</span></span>\n<span class="line"><span>insert into tb user(id,name,sex) values(6,&#39;erry&#39;,&#39;1&#39;);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="双主双从读写分离" tabindex="-1"><a class="header-anchor" href="#双主双从读写分离"><span>双主双从读写分离</span></a></h3><figure><img src="'+fi+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="'+bi+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>测试：</p><p>登录MyCat，测试查询及更新操作，判定是否能够进行读写分离，以及读写分离的策略是否正确。</p><p>当主库挂掉一个之后，是否能够自动切换。</p>',153)]))}]]),Ai=JSON.parse('{"path":"/Database/MySQL/%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E7%AF%87.html","title":"运维篇","lang":"zh-CN","frontmatter":{"icon":"fa-solid fa-database","date":"2025-03-22T00:00:00.000Z","category":["MySQL","数据库"],"tag":["讲义"],"gitInclude":[]},"headers":[{"level":2,"title":"日志","slug":"日志","link":"#日志","children":[{"level":3,"title":"错误日志","slug":"错误日志","link":"#错误日志","children":[]},{"level":3,"title":"二进制日志","slug":"二进制日志","link":"#二进制日志","children":[]},{"level":3,"title":"查询日志","slug":"查询日志","link":"#查询日志","children":[]},{"level":3,"title":"慢查询日志","slug":"慢查询日志","link":"#慢查询日志","children":[]}]},{"level":2,"title":"主从复制","slug":"主从复制","link":"#主从复制","children":[{"level":3,"title":"原理","slug":"原理","link":"#原理","children":[]},{"level":3,"title":"搭建实现","slug":"搭建实现","link":"#搭建实现","children":[]}]},{"level":2,"title":"分库分表","slug":"分库分表","link":"#分库分表","children":[{"level":3,"title":"介绍","slug":"介绍-1","link":"#介绍-1","children":[]},{"level":3,"title":"Mycat概述","slug":"mycat概述","link":"#mycat概述","children":[]},{"level":3,"title":"Mycat入门","slug":"mycat入门","link":"#mycat入门","children":[]},{"level":3,"title":"Mycat配置","slug":"mycat配置","link":"#mycat配置","children":[]},{"level":3,"title":"Mycat分片","slug":"mycat分片","link":"#mycat分片","children":[]},{"level":3,"title":"Mycat管理及监控","slug":"mycat管理及监控","link":"#mycat管理及监控","children":[]}]},{"level":2,"title":"读写分离","slug":"读写分离","link":"#读写分离","children":[{"level":3,"title":"介绍","slug":"介绍-2","link":"#介绍-2","children":[]},{"level":3,"title":"一主一从读写分离","slug":"一主一从读写分离","link":"#一主一从读写分离","children":[]},{"level":3,"title":"双主双从","slug":"双主双从","link":"#双主双从","children":[]},{"level":3,"title":"双主双从读写分离","slug":"双主双从读写分离","link":"#双主双从读写分离","children":[]}]}],"readingTime":{"minutes":5.79,"words":1737},"filePathRelative":"Database/MySQL/运维/运维篇.md","localizedDate":"2025年3月22日","excerpt":"\\n<h2>日志</h2>\\n<h3>错误日志</h3>\\n<p>错误日志是 MySQL 中最重要的日志之一，它记录了当 mysqld 启动和停止时，以及服务器在运行过程中发生任何严重错误时的相关信息当数据库出现任何故障导致无法正常使用时，建议首先查看此日志。</p>\\n<p>该日志是默认开启的，默认存放目录 /var/log/，默认的日志文件名为 mysqld.log 。查看日志位置：</p>\\n<div class=\\"language- line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"\\" data-title=\\"\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span>show variables like \'%log_error%\'</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div></div></div>"}')}}]);