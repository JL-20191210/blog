"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[69732],{66262:(s,i)=>{i.A=(s,i)=>{const a=s.__vccOpts||s;for(const[s,n]of i)a[s]=n;return a}},40710:(s,i,a)=>{a.r(i),a.d(i,{comp:()=>h,data:()=>d});var n=a(20641);const e=a.p+"assets/img/image-20210813153241537.e868d007.png",l=a.p+"assets/img/image-20210813161804292.49889517.png",t={},h=(0,a(66262).A)(t,[["render",function(s,i){return(0,n.uX)(),(0,n.CE)("div",null,i[0]||(i[0]=[(0,n.Fv)('<h1 id="安装和配置canal" tabindex="-1"><a class="header-anchor" href="#安装和配置canal"><span>安装和配置Canal</span></a></h1><p>下面我们就开启mysql的主从同步机制，让Canal来模拟salve</p><h1 id="_1-开启mysql主从" tabindex="-1"><a class="header-anchor" href="#_1-开启mysql主从"><span>1.开启MySQL主从</span></a></h1><p>Canal是基于MySQL的主从同步功能，因此必须先开启MySQL的主从功能才可以。</p><p>这里以之前用Docker运行的mysql为例：</p><h2 id="_1-1-开启binlog" tabindex="-1"><a class="header-anchor" href="#_1-1-开启binlog"><span>1.1.开启binlog</span></a></h2><p>打开mysql容器挂载的日志文件，我的在<code>/tmp/mysql/conf</code>目录:</p><figure><img src="'+e+'" alt="image-20210813153241537" tabindex="0" loading="lazy"><figcaption>image-20210813153241537</figcaption></figure><p>修改文件：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">vi</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /tmp/mysql/conf/my.cnf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>添加内容：</p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" data-title="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">log-bin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">/var/lib/mysql/mysql-bin</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">binlog-do-db</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">heima</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>配置解读：</p><ul><li><code>log-bin=/var/lib/mysql/mysql-bin</code>：设置binary log文件的存放地址和文件名，叫做mysql-bin</li><li><code>binlog-do-db=heima</code>：指定对哪个database记录binary log events，这里记录heima这个库</li></ul><p>最终效果：</p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" data-title="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">[mysqld]</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">skip-name-resolve</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">character_set_server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">utf8</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">datadir</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">/var/lib/mysql</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">server-id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">1000</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">log-bin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">/var/lib/mysql/mysql-bin</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">binlog-do-db</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">heima</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_1-2-设置用户权限" tabindex="-1"><a class="header-anchor" href="#_1-2-设置用户权限"><span>1.2.设置用户权限</span></a></h2><p>接下来添加一个仅用于数据同步的账户，出于安全考虑，这里仅提供对heima这个库的操作权限。</p><div class="language-mysql line-numbers-mode" data-highlighter="shiki" data-ext="mysql" data-title="mysql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>create user canal@&#39;%&#39; IDENTIFIED by &#39;canal&#39;;</span></span>\n<span class="line"><span>GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT,SUPER ON *.* TO &#39;canal&#39;@&#39;%&#39; identified by &#39;canal&#39;;</span></span>\n<span class="line"><span>FLUSH PRIVILEGES;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启mysql容器即可</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>docker restart mysql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>测试设置是否成功：在mysql控制台，或者Navicat中，输入命令：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>show master status;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="data:image/png;base64,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" alt="image-20200327094735948" tabindex="0" loading="lazy"><figcaption>image-20200327094735948</figcaption></figure><h1 id="_2-安装canal" tabindex="-1"><a class="header-anchor" href="#_2-安装canal"><span>2.安装Canal</span></a></h1><h2 id="_2-1-创建网络" tabindex="-1"><a class="header-anchor" href="#_2-1-创建网络"><span>2.1.创建网络</span></a></h2><p>我们需要创建一个网络，将MySQL、Canal、MQ放到同一个Docker网络中：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> network</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> create</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> heima</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>让mysql加入这个网络：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> network</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> connect</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> heima</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mysql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_2-3-安装canal" tabindex="-1"><a class="header-anchor" href="#_2-3-安装canal"><span>2.3.安装Canal</span></a></h2><p>课前资料中提供了canal的镜像压缩包:</p><figure><img src="'+l+'" alt="image-20210813161804292" tabindex="0" loading="lazy"><figcaption>image-20210813161804292</figcaption></figure><p>大家可以上传到虚拟机，然后通过命令导入：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>docker load -i canal.tar</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>然后运行命令创建Canal容器：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 11111:11111</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> canal</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-e </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">canal.destinations=heima</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-e </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">canal.instance.master.address=mysql:3306</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  \\</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-e </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">canal.instance.dbUsername=canal</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  \\</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-e </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">canal.instance.dbPassword=canal</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  \\</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-e </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">canal.instance.connectionCharset=UTF-8</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-e </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">canal.instance.tsdb.enable=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-e </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">canal.instance.gtidon=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  \\</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-e </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">canal.instance.filter.regex=heima</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">..</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">--network </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">heima</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-d </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">canal/canal-server:v1.1.5</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>说明:</p><ul><li><code>-p 11111:11111</code>：这是canal的默认监听端口</li><li><code>-e canal.instance.master.address=mysql:3306</code>：数据库地址和端口，如果不知道mysql容器地址，可以通过<code>docker inspect 容器id</code>来查看</li><li><code>-e canal.instance.dbUsername=canal</code>：数据库用户名</li><li><code>-e canal.instance.dbPassword=canal</code> ：数据库密码</li><li><code>-e canal.instance.filter.regex=</code>：要监听的表名称</li></ul><p>表名称监听支持的语法：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>mysql 数据解析关注的表，Perl正则表达式.</span></span>\n<span class="line"><span>多个正则之间以逗号(,)分隔，转义符需要双斜杠(\\\\) </span></span>\n<span class="line"><span>常见例子：</span></span>\n<span class="line"><span>1.  所有表：.*   or  .*\\\\..*</span></span>\n<span class="line"><span>2.  canal schema下所有表： canal\\\\..*</span></span>\n<span class="line"><span>3.  canal下的以canal打头的表：canal\\\\.canal.*</span></span>\n<span class="line"><span>4.  canal schema下的一张表：canal.test1</span></span>\n<span class="line"><span>5.  多个规则组合使用然后以逗号隔开：canal\\\\..*,mysql.test1,mysql.test2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',41)]))}]]),d=JSON.parse('{"path":"/Database/Redis/%E8%AF%BE%E5%89%8D%E8%B5%84%E6%96%99/%E5%AE%89%E8%A3%85Canal.html","title":"安装和配置Canal","lang":"zh-CN","frontmatter":{"gitInclude":[]},"headers":[{"level":2,"title":"1.1.开启binlog","slug":"_1-1-开启binlog","link":"#_1-1-开启binlog","children":[]},{"level":2,"title":"1.2.设置用户权限","slug":"_1-2-设置用户权限","link":"#_1-2-设置用户权限","children":[]},{"level":2,"title":"2.1.创建网络","slug":"_2-1-创建网络","link":"#_2-1-创建网络","children":[]},{"level":2,"title":"2.3.安装Canal","slug":"_2-3-安装canal","link":"#_2-3-安装canal","children":[]}],"readingTime":{"minutes":2.1,"words":631},"filePathRelative":"Database/Redis/课前资料/安装Canal.md","excerpt":"\\n<p>下面我们就开启mysql的主从同步机制，让Canal来模拟salve</p>\\n<h1>1.开启MySQL主从</h1>\\n<p>Canal是基于MySQL的主从同步功能，因此必须先开启MySQL的主从功能才可以。</p>\\n<p>这里以之前用Docker运行的mysql为例：</p>\\n<h2>1.1.开启binlog</h2>\\n<p>打开mysql容器挂载的日志文件，我的在<code>/tmp/mysql/conf</code>目录:</p>\\n<figure><figcaption>image-20210813153241537</figcaption></figure>\\n<p>修改文件：</p>"}')}}]);