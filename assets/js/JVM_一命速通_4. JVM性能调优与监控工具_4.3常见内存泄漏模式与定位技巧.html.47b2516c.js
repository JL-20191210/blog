"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[53198],{66262:(i,s)=>{s.A=(i,s)=>{const a=i.__vccOpts||i;for(const[i,t]of s)a[i]=t;return a}},13255:(i,s,a)=>{a.r(s),a.d(s,{comp:()=>l,data:()=>h});var t=a(20641);const e={},l=(0,a(66262).A)(e,[["render",function(i,s){const a=(0,t.g2)("RouteLink");return(0,t.uX)(),(0,t.CE)("div",null,[s[2]||(s[2]=(0,t.Lk)("h1",{id:"ğŸ§µ-4-3-å¸¸è§å†…å­˜æ³„æ¼æ¨¡å¼ä¸å®šä½æŠ€å·§",tabindex:"-1"},[(0,t.Lk)("a",{class:"header-anchor",href:"#ğŸ§µ-4-3-å¸¸è§å†…å­˜æ³„æ¼æ¨¡å¼ä¸å®šä½æŠ€å·§"},[(0,t.Lk)("span",null,"ğŸ§µ 4.3 å¸¸è§å†…å­˜æ³„æ¼æ¨¡å¼ä¸å®šä½æŠ€å·§")])],-1)),s[3]||(s[3]=(0,t.Lk)("p",null,[(0,t.eW)("å†…å­˜æ³„æ¼å¹¶éå¯¹è±¡æ— æ³•è¢« GCï¼Œè€Œæ˜¯å¯¹è±¡"),(0,t.Lk)("strong",null,"ä¸å†è¢«ä½¿ç”¨å´ä»è¢«å¼•ç”¨"),(0,t.eW)("ï¼Œæ— æ³•é‡Šæ”¾ã€‚æ­¤ç±»é—®é¢˜ä¸ä¼šç«‹åˆ»å´©æºƒï¼Œå´ä¼šæŒç»­åå™¬å†…å­˜ï¼Œæœ€ç»ˆè§¦å‘ OOMã€‚")],-1)),s[4]||(s[4]=(0,t.Lk)("hr",null,null,-1)),(0,t.Q3)(" more "),s[5]||(s[5]=(0,t.Fv)('<h2 id="ğŸ“Œ-java-ä¸­å¸¸è§å†…å­˜æ³„æ¼åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#ğŸ“Œ-java-ä¸­å¸¸è§å†…å­˜æ³„æ¼åœºæ™¯"><span>ğŸ“Œ Java ä¸­å¸¸è§å†…å­˜æ³„æ¼åœºæ™¯</span></a></h2><table><thead><tr><th>åœºæ™¯</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>é™æ€é›†åˆæŒæœ‰å¼•ç”¨</td><td>å¦‚ <code>static List</code>ã€<code>Map</code> ç¼“å­˜æœªæ¸…ç†</td></tr><tr><td>ThreadLocal æ³„æ¼</td><td><code>ThreadLocal</code> æœªè°ƒç”¨ <code>remove()</code> å¯¼è‡´çº¿ç¨‹å¼ºå¼•ç”¨</td></tr><tr><td>ç›‘å¬å™¨/å›è°ƒæœªæ³¨é”€</td><td>æ³¨å†Œåæœªå–æ¶ˆï¼Œå¯¼è‡´å›è°ƒå¼•ç”¨å¸¸é©»</td></tr><tr><td>å¤§é‡ ClassLoader</td><td>åŠ¨æ€ç±»åŠ è½½å™¨æœªè¢«å¸è½½ï¼Œå¦‚é¢‘ç¹ä½¿ç”¨ SPIã€åå°„ç­‰</td></tr><tr><td>JDBC/IO èµ„æºæœªå…³é—­</td><td>å¯¼è‡´è¿æ¥å¥æŸ„æ³„æ¼ï¼Œé—´æ¥å¼•å‘å †å¤–èµ„æºæ³„æ¼</td></tr></tbody></table><hr><h2 id="ğŸ§ª-ä»£ç ç¤ºä¾‹-é™æ€é›†åˆæ³„æ¼" tabindex="-1"><a class="header-anchor" href="#ğŸ§ª-ä»£ç ç¤ºä¾‹-é™æ€é›†åˆæ³„æ¼"><span>ğŸ§ª ä»£ç ç¤ºä¾‹ï¼šé™æ€é›†åˆæ³„æ¼</span></a></h2><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> LeakyCache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> List</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> cache </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ArrayList</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> add</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> obj</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        cache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(obj); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ— é™åˆ¶å¢é•¿</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è§£å†³ï¼šå®šæœŸæ¸…ç†æˆ–ä½¿ç”¨ <code>WeakReference</code></p><hr><h2 id="ğŸ§ª-ä»£ç ç¤ºä¾‹-threadlocal-æ³„æ¼" tabindex="-1"><a class="header-anchor" href="#ğŸ§ª-ä»£ç ç¤ºä¾‹-threadlocal-æ³„æ¼"><span>ğŸ§ª ä»£ç ç¤ºä¾‹ï¼šThreadLocal æ³„æ¼</span></a></h2><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ThreadLocal</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">byte</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">[]</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> local </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ThreadLocal</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">local</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;"> byte</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>æœªè°ƒç”¨ <code>local.remove()</code>ï¼Œå¯èƒ½å¯¼è‡´è€å¹´ä»£ä¸­ <code>Thread</code> æŒæœ‰æ— æ³•é‡Šæ”¾çš„å¯¹è±¡</p><hr><h2 id="ğŸ§ -å¦‚ä½•å®šä½å†…å­˜æ³„æ¼" tabindex="-1"><a class="header-anchor" href="#ğŸ§ -å¦‚ä½•å®šä½å†…å­˜æ³„æ¼"><span>ğŸ§  å¦‚ä½•å®šä½å†…å­˜æ³„æ¼ï¼Ÿ</span></a></h2><h3 id="âœ…-1-ä½¿ç”¨-mat-åˆ†æ-retained-size" tabindex="-1"><a class="header-anchor" href="#âœ…-1-ä½¿ç”¨-mat-åˆ†æ-retained-size"><span>âœ… 1. ä½¿ç”¨ MAT åˆ†æ Retained Size</span></a></h3><ul><li>Dominator Tree ä¸­ä¿ç•™å¯¹è±¡æœ€å¤šçš„é€šå¸¸ä¸ºæ³„æ¼æ ¹æº</li></ul><h3 id="âœ…-2-leak-suspects-report-æŠ¥å‘Š" tabindex="-1"><a class="header-anchor" href="#âœ…-2-leak-suspects-report-æŠ¥å‘Š"><span>âœ… 2. Leak Suspects Report æŠ¥å‘Š</span></a></h3><ul><li>Eclipse MAT æä¾›è‡ªåŠ¨æ³„æ¼åˆ†æå»ºè®®</li></ul><h3 id="âœ…-3-åˆ†æ-gc-roots-è·¯å¾„" tabindex="-1"><a class="header-anchor" href="#âœ…-3-åˆ†æ-gc-roots-è·¯å¾„"><span>âœ… 3. åˆ†æ GC Roots è·¯å¾„</span></a></h3><ul><li>æŸ¥çœ‹å¯¹è±¡è¢«å“ªä¸ª static å­—æ®µ/çº¿ç¨‹æŒæœ‰</li></ul><h3 id="âœ…-4-heap-histogram-åˆ†å¸ƒ" tabindex="-1"><a class="header-anchor" href="#âœ…-4-heap-histogram-åˆ†å¸ƒ"><span>âœ… 4. Heap Histogram åˆ†å¸ƒ</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">jmap</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -histo:live</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">pi</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">d&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>æ‰¾å‡ºå®ä¾‹æ•°é‡æš´æ¶¨çš„ç±»ï¼Œå¦‚ <code>java.util.HashMap</code></li></ul><hr><h2 id="ğŸ¯-å¦‚ä½•é¢„é˜²å†…å­˜æ³„æ¼" tabindex="-1"><a class="header-anchor" href="#ğŸ¯-å¦‚ä½•é¢„é˜²å†…å­˜æ³„æ¼"><span>ğŸ¯ å¦‚ä½•é¢„é˜²å†…å­˜æ³„æ¼ï¼Ÿ</span></a></h2><table><thead><tr><th>å»ºè®®</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>é¿å…æ»¥ç”¨ static ç¼“å­˜</td><td>è‹¥ä½¿ç”¨å¿…é¡»è®¾ç½®å¤±æ•ˆç­–ç•¥</td></tr><tr><td>ThreadLocal ä½¿ç”¨å remove()</td><td>æ¯æ¬¡ set åè¦ä¸»åŠ¨æ¸…é™¤</td></tr><tr><td>å…³é—­èµ„æº</td><td>å°½æ—©é‡Šæ”¾è¿æ¥ã€æµã€Statement ç­‰èµ„æº</td></tr><tr><td>é™ä½ç±»åŠ è½½å¤æ‚åº¦</td><td>å°½é‡å¤ç”¨ç±»åŠ è½½å™¨ï¼Œé¿å…é¢‘ç¹ç”Ÿæˆ</td></tr><tr><td>å·¥å…·è¾…åŠ©ç›‘æ§</td><td>ä½¿ç”¨ MATã€Arthasã€JProfiler ç­‰ç»“åˆåˆ†æå†…å­˜</td></tr></tbody></table><hr><h2 id="ğŸ“-å°ç»“" tabindex="-1"><a class="header-anchor" href="#ğŸ“-å°ç»“"><span>ğŸ“ å°ç»“</span></a></h2><ul><li>Java çš„å†…å­˜æ³„æ¼æ¥æºå¹¿æ³›ï¼Œæ’æŸ¥æ ¸å¿ƒæ˜¯â€œå¯è¾¾ä½†æ— ç”¨â€å¯¹è±¡</li><li>é‡ç‚¹å…³æ³¨ static/ThreadLocal/ç±»åŠ è½½å™¨å¼•ç”¨é“¾</li><li>æ¨èç”Ÿäº§ç¯å¢ƒé…ç½®å †è½¬å‚¨ï¼Œå¹¶é€šè¿‡å·¥å…·å®šæœŸä½“æ£€</li></ul><hr>',28)),(0,t.Lk)("p",null,[s[1]||(s[1]=(0,t.eW)("ğŸ‘‰ ä¸‹ä¸€ç¯‡æ¨èï¼š")),(0,t.bF)(a,{to:"/JVM/%E4%B8%80%E5%91%BD%E9%80%9F%E9%80%9A/5.%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E4%B8%8E%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7%E6%8E%A8%E8%8D%90/5.1JDK%20%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E5%85%A8%E6%99%AF%E5%9B%BE%E4%B8%8E%E5%85%B8%E5%9E%8B%E7%94%A8%E9%80%94.html"},{default:(0,t.k6)((()=>s[0]||(s[0]=[(0,t.eW)("5.1 JDK å‘½ä»¤è¡Œå·¥å…·å…¨æ™¯å›¾ä¸å…¸å‹ç”¨é€”")]))),_:1})])])}]]),h=JSON.parse('{"path":"/JVM/%E4%B8%80%E5%91%BD%E9%80%9F%E9%80%9A/4.%20JVM%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%B8%8E%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7/4.3%E5%B8%B8%E8%A7%81%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E6%A8%A1%E5%BC%8F%E4%B8%8E%E5%AE%9A%E4%BD%8D%E6%8A%80%E5%B7%A7.html","title":"4.3 å¸¸è§å†…å­˜æ³„æ¼æ¨¡å¼ä¸å®šä½æŠ€å·§","lang":"zh-CN","frontmatter":{"title":"4.3 å¸¸è§å†…å­˜æ³„æ¼æ¨¡å¼ä¸å®šä½æŠ€å·§","icon":"fa-solid fa-microchip","date":"2025-07-10T00:00:00.000Z","author":"JeanHu","category":["JVM","å†…å­˜æ³„æ¼","æ•…éšœæ’æŸ¥"],"tag":["å†…å­˜æ³„æ¼","å®æˆ˜ç»éªŒ","MATåˆ†æ"],"summary":"æœ¬æ–‡æ€»ç»“äº† Java ä¸­å¸¸è§çš„å†…å­˜æ³„æ¼æ¨¡å¼ï¼Œå¹¶ç»“åˆå·¥å…·å’Œä»£ç ç¤ºä¾‹ä»‹ç»å®šä½æŠ€å·§ï¼Œå¸®åŠ©å¼€å‘è€…é«˜æ•ˆåº”å¯¹ç³»ç»Ÿå†…å­˜æŒç»­ä¸Šæ¶¨ã€éšåŒ¿æ€§ OOM ç­‰æ£˜æ‰‹é—®é¢˜ã€‚","gitInclude":[]},"headers":[{"level":2,"title":"ğŸ“Œ Java ä¸­å¸¸è§å†…å­˜æ³„æ¼åœºæ™¯","slug":"ğŸ“Œ-java-ä¸­å¸¸è§å†…å­˜æ³„æ¼åœºæ™¯","link":"#ğŸ“Œ-java-ä¸­å¸¸è§å†…å­˜æ³„æ¼åœºæ™¯","children":[]},{"level":2,"title":"ğŸ§ª ä»£ç ç¤ºä¾‹ï¼šé™æ€é›†åˆæ³„æ¼","slug":"ğŸ§ª-ä»£ç ç¤ºä¾‹-é™æ€é›†åˆæ³„æ¼","link":"#ğŸ§ª-ä»£ç ç¤ºä¾‹-é™æ€é›†åˆæ³„æ¼","children":[]},{"level":2,"title":"ğŸ§ª ä»£ç ç¤ºä¾‹ï¼šThreadLocal æ³„æ¼","slug":"ğŸ§ª-ä»£ç ç¤ºä¾‹-threadlocal-æ³„æ¼","link":"#ğŸ§ª-ä»£ç ç¤ºä¾‹-threadlocal-æ³„æ¼","children":[]},{"level":2,"title":"ğŸ§  å¦‚ä½•å®šä½å†…å­˜æ³„æ¼ï¼Ÿ","slug":"ğŸ§ -å¦‚ä½•å®šä½å†…å­˜æ³„æ¼","link":"#ğŸ§ -å¦‚ä½•å®šä½å†…å­˜æ³„æ¼","children":[{"level":3,"title":"âœ… 1. ä½¿ç”¨ MAT åˆ†æ Retained Size","slug":"âœ…-1-ä½¿ç”¨-mat-åˆ†æ-retained-size","link":"#âœ…-1-ä½¿ç”¨-mat-åˆ†æ-retained-size","children":[]},{"level":3,"title":"âœ… 2. Leak Suspects Report æŠ¥å‘Š","slug":"âœ…-2-leak-suspects-report-æŠ¥å‘Š","link":"#âœ…-2-leak-suspects-report-æŠ¥å‘Š","children":[]},{"level":3,"title":"âœ… 3. åˆ†æ GC Roots è·¯å¾„","slug":"âœ…-3-åˆ†æ-gc-roots-è·¯å¾„","link":"#âœ…-3-åˆ†æ-gc-roots-è·¯å¾„","children":[]},{"level":3,"title":"âœ… 4. Heap Histogram åˆ†å¸ƒ","slug":"âœ…-4-heap-histogram-åˆ†å¸ƒ","link":"#âœ…-4-heap-histogram-åˆ†å¸ƒ","children":[]}]},{"level":2,"title":"ğŸ¯ å¦‚ä½•é¢„é˜²å†…å­˜æ³„æ¼ï¼Ÿ","slug":"ğŸ¯-å¦‚ä½•é¢„é˜²å†…å­˜æ³„æ¼","link":"#ğŸ¯-å¦‚ä½•é¢„é˜²å†…å­˜æ³„æ¼","children":[]},{"level":2,"title":"ğŸ“ å°ç»“","slug":"ğŸ“-å°ç»“","link":"#ğŸ“-å°ç»“","children":[]}],"readingTime":{"minutes":2.24,"words":673},"filePathRelative":"JVM/ä¸€å‘½é€Ÿé€š/4. JVMæ€§èƒ½è°ƒä¼˜ä¸ç›‘æ§å·¥å…·/4.3å¸¸è§å†…å­˜æ³„æ¼æ¨¡å¼ä¸å®šä½æŠ€å·§.md","localizedDate":"2025å¹´7æœˆ10æ—¥","excerpt":"\\n<p>å†…å­˜æ³„æ¼å¹¶éå¯¹è±¡æ— æ³•è¢« GCï¼Œè€Œæ˜¯å¯¹è±¡<strong>ä¸å†è¢«ä½¿ç”¨å´ä»è¢«å¼•ç”¨</strong>ï¼Œæ— æ³•é‡Šæ”¾ã€‚æ­¤ç±»é—®é¢˜ä¸ä¼šç«‹åˆ»å´©æºƒï¼Œå´ä¼šæŒç»­åå™¬å†…å­˜ï¼Œæœ€ç»ˆè§¦å‘ OOMã€‚</p>\\n<hr>\\n"}')}}]);