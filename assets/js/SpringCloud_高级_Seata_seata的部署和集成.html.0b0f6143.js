"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[5394],{66262:(s,i)=>{i.A=(s,i)=>{const a=s.__vccOpts||s;for(const[s,n]of i)a[s]=n;return a}},35954:(s,i,a)=>{a.r(i),a.d(i,{comp:()=>c,data:()=>g});var n=a(20641);const l=a.p+"assets/img/image-20210622202357640.2a4e87a1.png",e=a.p+"assets/img/image-20210622202515014.0ec88452.png",t=a.p+"assets/img/image-20210622202622874.2bd9f8ee.png",p=a.p+"assets/img/image-20210622203609227.c133e317.png",h=a.p+"assets/img/image-20210622204145159.99b93456.png",k=a.p+"assets/img/image-20210622205901450.83922568.png",r=a.p+"assets/img/image-20210624151221747.7f73b263.png",A=a.p+"assets/img/image-20210624151507072.42132e38.png",d={},c=(0,a(66262).A)(d,[["render",function(s,i){return(0,n.uX)(),(0,n.CE)("div",null,[i[0]||(i[0]=(0,n.Fv)('<h1 id="seata的部署和集成" tabindex="-1"><a class="header-anchor" href="#seata的部署和集成"><span>seata的部署和集成</span></a></h1><h1 id="一、部署seata的tc-server" tabindex="-1"><a class="header-anchor" href="#一、部署seata的tc-server"><span>一、部署Seata的tc-server</span></a></h1><h2 id="_1-下载" tabindex="-1"><a class="header-anchor" href="#_1-下载"><span>1.下载</span></a></h2><p>首先我们要下载seata-server包，<a href="http://seata.io/zh-cn/blog/download.html" target="_blank" rel="noopener noreferrer">下载地址</a></p><p>当然，课前资料也准备好了：</p><figure><img src="'+l+'" alt="image-20210622202357640" tabindex="0" loading="lazy"><figcaption>image-20210622202357640</figcaption></figure>',6)),(0,n.Q3)(" more "),i[1]||(i[1]=(0,n.Fv)('<h2 id="_2-解压" tabindex="-1"><a class="header-anchor" href="#_2-解压"><span>2.解压</span></a></h2><p>在非中文目录解压缩这个zip包，其目录结构如下：</p><figure><img src="'+e+'" alt="image-20210622202515014" tabindex="0" loading="lazy"><figcaption>image-20210622202515014</figcaption></figure><h2 id="_3-修改配置" tabindex="-1"><a class="header-anchor" href="#_3-修改配置"><span>3.修改配置</span></a></h2><p>修改conf目录下的registry.conf文件：</p><figure><img src="'+t+'" alt="image-20210622202622874" tabindex="0" loading="lazy"><figcaption>image-20210622202622874</figcaption></figure><p>内容如下：</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">registry {</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # tc服务的注册中心类，这里选择nacos，也可以是eureka、zookeeper等</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">  type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;nacos&quot;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  nacos {</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # seata tc 服务注册到 nacos的服务名称，可以自定义</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    application</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;seata-tc-server&quot;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    serverAddr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;127.0.0.1:8848&quot;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    group</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;DEFAULT_GROUP&quot;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    namespace</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&quot;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    cluster</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;SH&quot;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    username</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;nacos&quot;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    password</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;nacos&quot;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  }</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">config {</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 读取tc服务端的配置文件的方式，这里是从nacos配置中心读取，这样如果tc是集群，可以共享配置</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">  type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;nacos&quot;</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 配置nacos地址等信息</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  nacos {</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    serverAddr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;127.0.0.1:8848&quot;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    namespace</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&quot;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    group</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;SEATA_GROUP&quot;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    username</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;nacos&quot;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    password</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;nacos&quot;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    dataId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;seataServer.properties&quot;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  }</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-在nacos添加配置" tabindex="-1"><a class="header-anchor" href="#_4-在nacos添加配置"><span>4.在nacos添加配置</span></a></h2><p>特别注意，为了让tc服务的集群可以共享配置，我们选择了nacos作为统一配置中心。因此服务端配置文件seataServer.properties文件需要在nacos中配好。</p><p>格式如下：</p><figure><img src="'+p+'" alt="image-20210622203609227" tabindex="0" loading="lazy"><figcaption>image-20210622203609227</figcaption></figure><p>配置内容如下：</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 数据存储方式，db代表数据库</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">store.mode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">db</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">store.db.datasource</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">druid</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">store.db.dbType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">mysql</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">store.db.driverClassName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">com.mysql.jdbc.Driver</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">store.db.url</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">jdbc:mysql://127.0.0.1:3306/seata?</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">useUnicode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">true&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">rewriteBatchedStatements</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">true</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">store.db.user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">root</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">store.db.password</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">123</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">store.db.minConn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">5</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">store.db.maxConn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">30</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">store.db.globalTable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">global_table</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">store.db.branchTable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">branch_table</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">store.db.queryLimit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">100</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">store.db.lockTable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">lock_table</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">store.db.maxWait</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">5000</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 事务、日志等配置</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">server.recovery.committingRetryPeriod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">1000</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">server.recovery.asynCommittingRetryPeriod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">1000</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">server.recovery.rollbackingRetryPeriod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">1000</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">server.recovery.timeoutRetryPeriod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">1000</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">server.maxCommitRetryTimeout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">-1</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">server.maxRollbackRetryTimeout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">-1</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">server.rollbackRetryTimeoutUnlockEnable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">false</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">server.undo.logSaveDays</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">7</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">server.undo.logDeletePeriod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">86400000</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 客户端与服务端传输方式</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">transport.serialization</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">seata</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">transport.compressor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">none</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 关闭metrics功能，提高性能</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">metrics.enabled</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">false</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">metrics.registryType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">compact</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">metrics.exporterList</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">prometheus</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">metrics.exporterPrometheusPort</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">9898</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><mark>其中的数据库地址、用户名、密码都需要修改成你自己的数据库信息。</mark></p><h2 id="_5-创建数据库表" tabindex="-1"><a class="header-anchor" href="#_5-创建数据库表"><span>5.创建数据库表</span></a></h2><p>特别注意：tc服务在管理分布式事务时，需要记录事务相关数据到数据库中，你需要提前创建好这些表。</p><p>新建一个名为seata的数据库，运行课前资料提供的sql文件：</p><figure><img src="'+h+'" alt="image-20210622204145159" tabindex="0" loading="lazy"><figcaption>image-20210622204145159</figcaption></figure><p>这些表主要记录全局事务、分支事务、全局锁信息：</p><div class="language-mysql line-numbers-mode" data-highlighter="shiki" data-ext="mysql" data-title="mysql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span></span></span>\n<span class="line"><span>SET NAMES utf8mb4;</span></span>\n<span class="line"><span>SET FOREIGN_KEY_CHECKS = 0;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- ----------------------------</span></span>\n<span class="line"><span>-- 分支事务表</span></span>\n<span class="line"><span>-- ----------------------------</span></span>\n<span class="line"><span>DROP TABLE IF EXISTS `branch_table`;</span></span>\n<span class="line"><span>CREATE TABLE `branch_table`  (</span></span>\n<span class="line"><span>  `branch_id` bigint(20) NOT NULL,</span></span>\n<span class="line"><span>  `xid` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,</span></span>\n<span class="line"><span>  `transaction_id` bigint(20) NULL DEFAULT NULL,</span></span>\n<span class="line"><span>  `resource_group_id` varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span></span>\n<span class="line"><span>  `resource_id` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span></span>\n<span class="line"><span>  `branch_type` varchar(8) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span></span>\n<span class="line"><span>  `status` tinyint(4) NULL DEFAULT NULL,</span></span>\n<span class="line"><span>  `client_id` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span></span>\n<span class="line"><span>  `application_data` varchar(2000) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span></span>\n<span class="line"><span>  `gmt_create` datetime(6) NULL DEFAULT NULL,</span></span>\n<span class="line"><span>  `gmt_modified` datetime(6) NULL DEFAULT NULL,</span></span>\n<span class="line"><span>  PRIMARY KEY (`branch_id`) USING BTREE,</span></span>\n<span class="line"><span>  INDEX `idx_xid`(`xid`) USING BTREE</span></span>\n<span class="line"><span>) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Compact;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- ----------------------------</span></span>\n<span class="line"><span>-- 全局事务表</span></span>\n<span class="line"><span>-- ----------------------------</span></span>\n<span class="line"><span>DROP TABLE IF EXISTS `global_table`;</span></span>\n<span class="line"><span>CREATE TABLE `global_table`  (</span></span>\n<span class="line"><span>  `xid` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,</span></span>\n<span class="line"><span>  `transaction_id` bigint(20) NULL DEFAULT NULL,</span></span>\n<span class="line"><span>  `status` tinyint(4) NOT NULL,</span></span>\n<span class="line"><span>  `application_id` varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span></span>\n<span class="line"><span>  `transaction_service_group` varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span></span>\n<span class="line"><span>  `transaction_name` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span></span>\n<span class="line"><span>  `timeout` int(11) NULL DEFAULT NULL,</span></span>\n<span class="line"><span>  `begin_time` bigint(20) NULL DEFAULT NULL,</span></span>\n<span class="line"><span>  `application_data` varchar(2000) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span></span>\n<span class="line"><span>  `gmt_create` datetime NULL DEFAULT NULL,</span></span>\n<span class="line"><span>  `gmt_modified` datetime NULL DEFAULT NULL,</span></span>\n<span class="line"><span>  PRIMARY KEY (`xid`) USING BTREE,</span></span>\n<span class="line"><span>  INDEX `idx_gmt_modified_status`(`gmt_modified`, `status`) USING BTREE,</span></span>\n<span class="line"><span>  INDEX `idx_transaction_id`(`transaction_id`) USING BTREE</span></span>\n<span class="line"><span>) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Compact;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>SET FOREIGN_KEY_CHECKS = 1;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-启动tc服务" tabindex="-1"><a class="header-anchor" href="#_6-启动tc服务"><span>6.启动TC服务</span></a></h2><p>进入bin目录，运行其中的seata-server.bat即可：</p><figure><img src="data:image/png;base64,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" alt="image-20210622205427318" tabindex="0" loading="lazy"><figcaption>image-20210622205427318</figcaption></figure><p>启动成功后，seata-server应该已经注册到nacos注册中心了。</p><p>打开浏览器，访问nacos地址：http://localhost:8848，然后进入服务列表页面，可以看到seata-tc-server的信息：</p><figure><img src="'+k+'" alt="image-20210622205901450" tabindex="0" loading="lazy"><figcaption>image-20210622205901450</figcaption></figure><h1 id="二、微服务集成seata" tabindex="-1"><a class="header-anchor" href="#二、微服务集成seata"><span>二、微服务集成seata</span></a></h1><h2 id="_1-引入依赖" tabindex="-1"><a class="header-anchor" href="#_1-引入依赖"><span>1.引入依赖</span></a></h2><p>首先，我们需要在微服务中引入seata依赖：</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;com.alibaba.cloud&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;spring-cloud-starter-alibaba-seata&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">exclusions</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        &lt;!--版本较低，1.3.0，因此排除--&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">exclusion</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;seata-spring-boot-starter&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;io.seata&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">exclusion</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">exclusions</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">&lt;!--seata starter 采用1.4.2版本--&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;io.seata&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;seata-spring-boot-starter&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;${seata.version}&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-修改配置文件" tabindex="-1"><a class="header-anchor" href="#_2-修改配置文件"><span>2.修改配置文件</span></a></h2><p>需要修改application.yml文件，添加一些配置：</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">seata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  registry</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># TC服务注册中心的配置，微服务根据这些信息去注册中心获取tc服务地址</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 参考tc服务自己的registry.conf中的配置</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">nacos</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    nacos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># tc</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      server-addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">127.0.0.1:8848</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      namespace</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&quot;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      group</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">DEFAULT_GROUP</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      application</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">seata-tc-server</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # tc服务在nacos中的服务名称</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      cluster</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">SH</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  tx-service-group</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">seata-demo</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # 事务组，根据这个获取tc服务的cluster名称</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    vgroup-mapping</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 事务组与TC服务cluster的映射关系</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      seata-demo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">SH</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="三、tc服务的高可用和异地容灾" tabindex="-1"><a class="header-anchor" href="#三、tc服务的高可用和异地容灾"><span>三、TC服务的高可用和异地容灾</span></a></h1><h2 id="_1-模拟异地容灾的tc集群" tabindex="-1"><a class="header-anchor" href="#_1-模拟异地容灾的tc集群"><span>1.模拟异地容灾的TC集群</span></a></h2><p>计划启动两台seata的tc服务节点：</p><table><thead><tr><th>节点名称</th><th>ip地址</th><th>端口号</th><th>集群名称</th></tr></thead><tbody><tr><td>seata</td><td>127.0.0.1</td><td>8091</td><td>SH</td></tr><tr><td>seata2</td><td>127.0.0.1</td><td>8092</td><td>HZ</td></tr></tbody></table><p>之前我们已经启动了一台seata服务，端口是8091，集群名为SH。</p><p>现在，将seata目录复制一份，起名为seata2</p><p>修改seata2/conf/registry.conf内容如下：</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">registry</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # tc服务的注册中心类，这里选择nacos，也可以是eureka、zookeeper等</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;nacos&quot;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  nacos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # seata tc 服务注册到 nacos的服务名称，可以自定义</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    application</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;seata-tc-server&quot;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    serverAddr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;127.0.0.1:8848&quot;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    group</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;DEFAULT_GROUP&quot;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    namespace</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&quot;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    cluster</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;HZ&quot;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    username</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;nacos&quot;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    password</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;nacos&quot;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 读取tc服务端的配置文件的方式，这里是从nacos配置中心读取，这样如果tc是集群，可以共享配置</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;nacos&quot;</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 配置nacos地址等信息</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  nacos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    serverAddr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;127.0.0.1:8848&quot;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    namespace</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&quot;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    group</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;SEATA_GROUP&quot;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    username</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;nacos&quot;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    password</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;nacos&quot;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    dataId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;seataServer.properties&quot;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>进入seata2/bin目录，然后运行命令：</p><div class="language-powershell line-numbers-mode" data-highlighter="shiki" data-ext="powershell" data-title="powershell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">seata-server.bat</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">p </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8092</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>打开nacos控制台，查看服务列表：</p><figure><img src="data:image/png;base64,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" alt="image-20210624151150840" tabindex="0" loading="lazy"><figcaption>image-20210624151150840</figcaption></figure><p>点进详情查看：</p><figure><img src="'+r+'" alt="image-20210624151221747" tabindex="0" loading="lazy"><figcaption>image-20210624151221747</figcaption></figure><h2 id="_2-将事务组映射配置到nacos" tabindex="-1"><a class="header-anchor" href="#_2-将事务组映射配置到nacos"><span>2.将事务组映射配置到nacos</span></a></h2><p>接下来，我们需要将tx-service-group与cluster的映射关系都配置到nacos配置中心。</p><p>新建一个配置：</p><figure><img src="'+A+'" alt="image-20210624151507072" tabindex="0" loading="lazy"><figcaption>image-20210624151507072</figcaption></figure><p>配置的内容如下：</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 事务组映射关系</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">service.vgroupMapping.seata-demo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">SH</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">service.enableDegrade</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">false</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">service.disableGlobalTransaction</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">false</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 与TC服务的通信配置</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">transport.type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">TCP</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">transport.server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">NIO</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">transport.heartbeat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">true</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">transport.enableClientBatchSendRequest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">false</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">transport.threadFactory.bossThreadPrefix</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">NettyBoss</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">transport.threadFactory.workerThreadPrefix</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">NettyServerNIOWorker</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">transport.threadFactory.serverExecutorThreadPrefix</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">NettyServerBizHandler</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">transport.threadFactory.shareBossWorker</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">false</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">transport.threadFactory.clientSelectorThreadPrefix</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">NettyClientSelector</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">transport.threadFactory.clientSelectorThreadSize</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">1</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">transport.threadFactory.clientWorkerThreadPrefix</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">NettyClientWorkerThread</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">transport.threadFactory.bossThreadSize</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">1</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">transport.threadFactory.workerThreadSize</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">default</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">transport.shutdown.wait</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">3</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># RM配置</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.rm.asyncCommitBufferLimit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">10000</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.rm.lock.retryInterval</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">10</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.rm.lock.retryTimes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">30</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.rm.lock.retryPolicyBranchRollbackOnConflict</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">true</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.rm.reportRetryCount</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">5</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.rm.tableMetaCheckEnable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">false</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.rm.tableMetaCheckerInterval</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">60000</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.rm.sqlParserType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">druid</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.rm.reportSuccessEnable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">false</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.rm.sagaBranchRegisterEnable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">false</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># TM配置</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.tm.commitRetryCount</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">5</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.tm.rollbackRetryCount</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">5</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.tm.defaultGlobalTransactionTimeout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">60000</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.tm.degradeCheck</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">false</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.tm.degradeCheckAllowTimes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">10</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.tm.degradeCheckPeriod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">2000</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># undo日志配置</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.undo.dataValidation</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">true</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.undo.logSerialization</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">jackson</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.undo.onlyCareUpdateColumns</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">true</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.undo.logTable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">undo_log</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.undo.compress.enable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">true</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.undo.compress.type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">zip</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.undo.compress.threshold</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">64k</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">client.log.exceptionRate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">100</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-微服务读取nacos配置" tabindex="-1"><a class="header-anchor" href="#_3-微服务读取nacos配置"><span>3.微服务读取nacos配置</span></a></h2><p>接下来，需要修改每一个微服务的application.yml文件，让微服务读取nacos中的client.properties文件：</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">seata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">nacos</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    nacos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      server-addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">127.0.0.1:8848</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      username</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">nacos</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      password</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">nacos</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      group</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">SEATA_GROUP</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      data-id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">client.properties</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启微服务，现在微服务到底是连接tc的SH集群，还是tc的HZ集群，都统一由nacos的client.properties来决定了。</p>',58))])}]]),g=JSON.parse('{"path":"/SpringCloud/%E9%AB%98%E7%BA%A7/Seata/seata%E7%9A%84%E9%83%A8%E7%BD%B2%E5%92%8C%E9%9B%86%E6%88%90.html","title":"seata的部署和集成","lang":"zh-CN","frontmatter":{"icon":"fa-solid fa-web-awesome","date":"2025-02-25T00:00:00.000Z","category":["SpringCloud高级篇"],"tag":["阅读完毕","资料","Seata","工具"],"gitInclude":[]},"headers":[{"level":2,"title":"1.下载","slug":"_1-下载","link":"#_1-下载","children":[]},{"level":2,"title":"2.解压","slug":"_2-解压","link":"#_2-解压","children":[]},{"level":2,"title":"3.修改配置","slug":"_3-修改配置","link":"#_3-修改配置","children":[]},{"level":2,"title":"4.在nacos添加配置","slug":"_4-在nacos添加配置","link":"#_4-在nacos添加配置","children":[]},{"level":2,"title":"5.创建数据库表","slug":"_5-创建数据库表","link":"#_5-创建数据库表","children":[]},{"level":2,"title":"6.启动TC服务","slug":"_6-启动tc服务","link":"#_6-启动tc服务","children":[]},{"level":2,"title":"1.引入依赖","slug":"_1-引入依赖","link":"#_1-引入依赖","children":[]},{"level":2,"title":"2.修改配置文件","slug":"_2-修改配置文件","link":"#_2-修改配置文件","children":[]},{"level":2,"title":"1.模拟异地容灾的TC集群","slug":"_1-模拟异地容灾的tc集群","link":"#_1-模拟异地容灾的tc集群","children":[]},{"level":2,"title":"2.将事务组映射配置到nacos","slug":"_2-将事务组映射配置到nacos","link":"#_2-将事务组映射配置到nacos","children":[]},{"level":2,"title":"3.微服务读取nacos配置","slug":"_3-微服务读取nacos配置","link":"#_3-微服务读取nacos配置","children":[]}],"readingTime":{"minutes":5.47,"words":1640},"filePathRelative":"SpringCloud/高级/Seata/seata的部署和集成.md","localizedDate":"2025年2月25日","excerpt":"\\n<h1>一、部署Seata的tc-server</h1>\\n<h2>1.下载</h2>\\n<p>首先我们要下载seata-server包，<a href=\\"http://seata.io/zh-cn/blog/download.html\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">下载地址</a></p>\\n<p>当然，课前资料也准备好了：</p>\\n<figure><figcaption>image-20210622202357640</figcaption></figure>\\n"}')}}]);