# 📝 面试问答套装（数据库/分布式/性能方向）

------

## 一、项目数据量与表设计

**1. 每天产生多少数据，总量大概多少？**

- 日增 3~5 万条业务数据
- 核心表总量 200~300 万行，辅助表累计千万级
- 口语总结：

> 我们系统每天产生约 3~5 万条数据，核心表总量两三百万，日志和历史表累计千万级，整体数据量较大。

**2. 核心业务表有哪些？数据量？**

- 核心表：`demand`、`demand_process`、`status_sync`、`message_log`、`report_history`
- 数据量从 100 万到 2,000 万不等
- 口语总结：

> 核心业务表包括需求主表、处理表、状态同步表、MQ日志表和报表归档表，总量超过 3,000 万条。

**3. 数据库是单实例还是多实例？读写分离有吗？**

- PostgreSQL 主从架构，主库写、从库读
- 口语总结：

> 数据库采用主从架构，写入主库，查询走从库，保证性能与高可用。

**4. 表是单表还是分表/分区？分区策略？**

- 核心小表单表，大表按时间分区（按月/季度）
- 日志表按月分区，历史归档
- 口语总结：

> 高频大表按时间分区，日志表每月一张，历史数据归档，提升查询性能。

**5. 为什么没做水平分库？未来扩展如何？**

- 现有数据量和分区+读写分离+缓存足够
- 后期可引入 Sharding 或 Citus
- 口语总结：

> 目前分区+读写分离+缓存满足性能，未来可水平分库。

------

## 二、分布式事务与数据一致性

**1. 多库之间的数据一致性如何保证？**

- 核心链路用 Seata AT + `@GlobalTransactional` → 强一致性
- 非核心链路本地事务 + 消息表 + 定时任务 → 最终一致性
- 缓存用延迟双删 + 异步 MQ 刷新
- 口语总结：

> 核心用 Seata 强一致性，非核心用可靠消息最终一致性，缓存通过延迟双删保持一致。

**2. MQ 消息出错或重复消费怎么处理？**

- 消息表 + 定时任务重试
- 消费端幂等处理
- 口语总结：

> MQ 消息失败通过重试补偿，消费端幂等保证不会重复处理。

**3. 为什么选择 Seata？优缺点？**

- 优点：简单集成，自动管理分布式事务，回滚统一
- 缺点：依赖 Seata Server，网络延迟可能影响性能
- 口语总结：

> Seata 集成方便，适合业务链路，但网络延迟需考虑性能。

------

## 三、系统 QPS 与性能

**1. 系统平均和峰值 QPS？**

- 平均：≈100 QPS
- 峰值：≈1,000–1,200 QPS
- 口语总结：

> 平均约 100 QPS，峰值演练时可达 1,000 多。

**2. 写入和查询比例？**

- 写：约 20%（平均 20 QPS，峰值 300 QPS）
- 读：约 80%（平均 80 QPS，峰值 900 QPS）
- 口语总结：

> 写入较少，读请求占比大，查询和报表压力最大。

**3. QPS 峰值如何应对？**

- Redis 缓存削峰 60–75%
- PostgreSQL 读写分离
- 分区表 + 历史归档
- 异步 MQ + 导出限流分页
- 口语总结：

> 高峰通过缓存、读写分离、分区和异步处理保证系统稳定。

------

## 四、数据库与 SQL 优化

**1. 做了哪些索引优化？**

- 联合索引：`status` + `region_id` + `update_time`
- 高频查询字段单独索引
- 口语总结：

> 为状态和区域等高频字段建联合索引，提升查询性能。

**2. 查询性能瓶颈如何解决？**

- 优化 SQL（UNION 合并实拍+历史表）
- 减少跨表 JOIN 和跨系统调用
- Redis 缓存热点数据
- 口语总结：

> 优化 SQL 和缓存，实现秒级响应。

**3. 报表导出如何优化？**

- EasyExcel 流式分页写入
- 索引优化 + 历史数据归档
- 口语总结：

> 流式分页+索引优化，使报表生成从分钟级优化到秒级。

------

## 五、分布式架构与微服务

**1. 项目如何拆分微服务？**

- 需求管理、需求处理、状态同步、报表导出
- 每个服务多实例容器化部署，Nacos 服务发现
- 口语总结：

> 微服务拆分明确，多副本部署 + Nacos 自动负载均衡。

**2. RabbitMQ 作用？**

- 异步消息传递，跨节点同步，削峰容错
- 口语总结：

> MQ 异步处理保证节点间数据一致，提升系统可用性。

**3. 容器化（Docker）优势？**

- 快速上线、环境隔离、高可用
- 口语总结：

> Docker 保证快速部署和环境一致性，支持弹性扩容。

------

💡 **使用方法**

- 按模块练习回答，每块用一句口语总结
- 面试官可追问细节，你只需展开关键点
- 熟练后可一口气讲完数据库/性能/事务相关问题