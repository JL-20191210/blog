# â˜• Javaé¢è¯•ç­”é¢˜å¡ï¼šä¸ºä»€ä¹ˆArrayListä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ

##  âœ… 1. ç»“è®ºå…ˆè¡Œ

> ArrayList **ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„**ï¼Œå› ä¸ºå®ƒçš„**å¢åˆ æŸ¥æ”¹æ“ä½œæ²¡æœ‰ä»»ä½•åŒæ­¥æ§åˆ¶**ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹å…±äº«çš„ ArrayList å®ä¾‹ï¼Œå¯èƒ½å¯¼è‡´ï¼š
- æ•°æ®ä¸¢å¤±
- è¶Šç•Œå¼‚å¸¸
- å¹¶å‘ä¿®æ”¹å¼‚å¸¸ï¼ˆConcurrentModificationExceptionï¼‰
- å…ƒç´ è¦†ç›–æˆ–è„è¯»

## **âœ… 2. å“ªäº›æ–¹æ³•ä¸å®‰å…¨ï¼Ÿä¸¾ä¾‹è¯´æ˜**

æ¥çœ‹ ArrayList å¸¸ç”¨æ–¹æ³•çš„æºç ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š

### **ğŸ”¸ add(E e)**

```
public boolean add(E e) {
    ensureCapacityInternal(size + 1);
    elementData[size++] = e;
    return true;
}
```

- **æœªåŠ é”**
- size++ æ˜¯éåŸå­æ“ä½œ
- å¤šçº¿ç¨‹åŒæ—¶ add()ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±æˆ–æ•°ç»„è¶Šç•Œ

### **ğŸ”¸ get(int index)**

```
public E get(int index) {
    return elementData[index]; // ä¹ŸæœªåŠ é”
}
```

- å¦‚æœæ­¤æ—¶å…¶ä»–çº¿ç¨‹åœ¨åˆ é™¤æˆ–æ‰©å®¹ï¼Œå¯èƒ½è¯»åˆ°é”™è¯¯å€¼æˆ–æŠ›å‡º IndexOutOfBoundsException

### **ğŸ”¸ remove(int index)**

```
public E remove(int index) {
    E oldValue = elementData[index];
    int numMoved = size - index - 1;
    System.arraycopy(elementData, index + 1, elementData, index, numMoved);
    elementData[--size] = null;
    return oldValue;
}
```

- æœªåŠ é”ï¼Œä¸”ç‰µæ¶‰åˆ°æ•°ç»„ç§»åŠ¨å’Œ size--
- å¤šçº¿ç¨‹æ“ä½œæ—¶ï¼Œå¯èƒ½å¯¼è‡´ï¼š
  - å…ƒç´ ä¸¢å¤±
  - ä½ç½®é”™ä¹±
  - è„æ•°æ®è®¿é—®

## **âœ… 3. å¤šçº¿ç¨‹ä¸‹çš„å®é™…ä¾‹å­ï¼ˆæ•°æ®ä¸¢å¤±ï¼‰**

```
List<Integer> list = new ArrayList<>();

Runnable task = () -> {
    for (int i = 0; i < 1000; i++) {
        list.add(i);
    }
};

Thread t1 = new Thread(task);
Thread t2 = new Thread(task);

t1.start();
t2.start();
t1.join();
t2.join();

System.out.println("å®é™…å¤§å°ï¼š" + list.size()); // å°äº 2000ï¼Œè¯´æ˜ä¸¢æ•°æ®äº†ï¼
```

## **âœ… 4. ä¸ºä½•ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„æ ¸å¿ƒåŸå› ï¼Ÿ**

| **åŸå› **                  | **æè¿°**                                          |
| ------------------------- | ------------------------------------------------- |
| æ²¡æœ‰åŠ é”æœºåˆ¶              | æ‰€æœ‰æ–¹æ³•ä¸­æ²¡æœ‰ synchronizedã€ReentrantLock ç­‰æ§åˆ¶ |
| size++ éåŸå­             | å¹¶å‘ä¸‹ä¼šè¦†ç›–å†™å…¥æˆ–è·³è¿‡æ›´æ–°                        |
| å†…éƒ¨æ•°ç»„ elementData æš´éœ² | æ— ä¿æŠ¤æœºåˆ¶ï¼Œå¯¼è‡´å¹¶å‘è¯»å†™å†²çª                      |
| ç¼ºä¹å¹¶å‘è¯»å†™éš”ç¦»          | æ²¡æœ‰ä½¿ç”¨ volatileã€ä¸å¯å˜ç»“æ„æˆ–å¤åˆ¶æœºåˆ¶           |

## **âœ… 5. å¦‚ä½•è®©å®ƒçº¿ç¨‹å®‰å…¨ï¼Ÿ**

### **âœ… æ–¹å¼ä¸€ï¼šä½¿ç”¨åŒ…è£…å™¨**

```
List<String> safeList = Collections.synchronizedList(new ArrayList<>());
```

- å†…éƒ¨æ–¹æ³•åŠ äº† synchronized
- è¿­ä»£æ—¶ä»éœ€æ‰‹åŠ¨åŠ é”ï¼ˆå¦åˆ™ä»å¯èƒ½æŠ›å¼‚å¸¸ï¼‰ï¼š

```
synchronized (safeList) {
    for (String s : safeList) {
        // å®‰å…¨è¿­ä»£
    }
}
```

### **âœ… æ–¹å¼äºŒï¼šä½¿ç”¨å¹¶å‘é›†åˆ**

```
List<String> list = new CopyOnWriteArrayList<>();
```

- è¯»å†™éš”ç¦»ï¼Œè¯»æ— é”ï¼Œå†™å¤åˆ¶ï¼Œé€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯

## **âœ… 6. é¢è¯•ç­”é¢˜æ¨¡æ¿ï¼ˆå»ºè®®èƒŒè¯µï¼‰**

> [!important]
>
> ArrayList ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºå®ƒæ²¡æœ‰ä»»ä½•åŒæ­¥æœºåˆ¶ã€‚åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹åŒæ—¶è¿›è¡Œ add()ã€remove() æˆ– get() æ“ä½œï¼Œä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€æ•°ç»„è¶Šç•Œã€å¹¶å‘ä¿®æ”¹å¼‚å¸¸ç­‰é—®é¢˜ã€‚ä¸»è¦åŸå› æ˜¯å†…éƒ¨æ“ä½œå¦‚ size++ å’Œæ•°ç»„ç§»åŠ¨æ˜¯éåŸå­çš„ã€‚è§£å†³æ–¹æ¡ˆåŒ…æ‹¬ä½¿ç”¨ Collections.synchronizedList() åŒ…è£…ï¼Œæˆ–ä½¿ç”¨ CopyOnWriteArrayList ç­‰å¹¶å‘é›†åˆç±»ã€‚

