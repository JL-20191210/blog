# ☕ Java 面试答题卡：字符串拼接与性能优化

------

## 🧠 知识点简介

Java 提供了三种常用的字符串操作方式：

- **String**：不可变对象，拼接会生成新对象。
- **StringBuffer**：可变对象，**线程安全**，方法加了 `synchronized`。
- **StringBuilder**：可变对象，**线程不安全**，但性能更高。

------

## 🔑 重点区别

| 特性         | String           | StringBuffer     | StringBuilder  |
| ------------ | ---------------- | ---------------- | -------------- |
| 可变性       | ❌ 不可变         | ✅ 可变           | ✅ 可变         |
| 线程安全     | ✅ 安全（不可变） | ✅ 安全（同步锁） | ❌ 不安全       |
| 性能         | 最低             | 中等             | 最高           |
| 典型使用场景 | 少量固定字符串   | 多线程拼接字符串 | 单线程大量拼接 |

------

## 🚀 “+” 拼接 vs `append()` 性能分析

### 1️⃣ 编译期常量折叠

```java
String s = "Hello" + "World";
// 编译后 => "HelloWorld"
```

👉 编译期优化，性能最好，不涉及运行时操作。

------

### 2️⃣ 少量拼接（方法体内）

```java
String a = "Hello";
String b = "World";
String c = a + b;
// 编译后等价于：
String c = new StringBuilder().append(a).append(b).toString();
```

👉 编译器会自动转换成 `StringBuilder.append()`，性能差不多。

------

### 3️⃣ 循环中的拼接

```java
// ❌ 性能差：每次都创建新 StringBuilder
String s = "";
for (int i = 0; i < 1000; i++) {
    s += i;
}

// ✅ 性能优：一个 StringBuilder 循环使用
StringBuilder sb = new StringBuilder();
for (int i = 0; i < 1000; i++) {
    sb.append(i);
}
String s = sb.toString();
```

👉 循环中必须用 `StringBuilder.append()`，否则性能非常差。

------

## 🎯 面试高频回答（60 秒版）

> Java 字符串拼接的性能取决于场景。
>
> - 如果是编译期常量，比如 `"a" + "b"`，编译器会直接优化成 `"ab"`，性能最好。
> - 如果是方法体内少量拼接，`+` 会被编译器优化成 `StringBuilder.append()`，性能和手写差不多。
> - 但如果在循环里频繁拼接，`+` 会反复创建新的 `StringBuilder`，效率很低，必须用 `StringBuilder.append()`。
>    此外，如果是多线程环境，建议用 `StringBuffer` 来保证线程安全。