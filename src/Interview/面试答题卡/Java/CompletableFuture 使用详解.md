# ğŸ“ Java é¢è¯•ç­”é¢˜å¡ï¼šCompletableFutureä½¿ç”¨è¯¦è§£

### **âœ… 1. ç®€ä»‹**

- CompletableFuture æ˜¯ Java 8 å¼•å…¥çš„å¼‚æ­¥ç¼–ç¨‹ APIï¼Œå±äº java.util.concurrent åŒ…ã€‚
- æ”¯æŒéé˜»å¡ã€é“¾å¼ç¼–ç¨‹é£æ ¼ã€‚
- æ˜¯ Future çš„å¢å¼ºç‰ˆï¼Œæ”¯æŒå›è°ƒã€ç»„åˆå¤šä¸ªä»»åŠ¡ç»“æœã€å¼‚å¸¸å¤„ç†ç­‰ã€‚

### **âœ… 2. å¸¸ç”¨æ–¹æ³•åˆ†ç±»æ€»ç»“**

| **ç±»å‹**     | **æ–¹æ³•**                          | **æè¿°**                        |
| ------------ | --------------------------------- | ------------------------------- |
| åˆ›å»ºå¼‚æ­¥ä»»åŠ¡ | supplyAsync() / runAsync()        | å¼‚æ­¥è·å–å€¼ / å¼‚æ­¥æ‰§è¡Œæ— è¿”å›ä»»åŠ¡ |
| ä»»åŠ¡ä¸²è”     | thenApply() / thenAccept()        | æ¥æ”¶ä¸Šä¸€æ­¥ç»“æœå¹¶ç»§ç»­å¤„ç†        |
| ç»„åˆä»»åŠ¡     | thenCombine() / allOf() / anyOf() | å¤šä¸ªä»»åŠ¡å¹¶å‘æ‰§è¡Œä¸ç»„åˆ          |
| å¼‚å¸¸å¤„ç†     | exceptionally() / handle()        | æ•è·å¹¶å¤„ç†å¼‚å¸¸                  |
| é˜»å¡è·å–ç»“æœ | get() / join()                    | è·å–æœ€ç»ˆç»“æœï¼ˆåŒæ­¥ï¼‰            |

### **âœ… 3. å¿«é€Ÿç¤ºä¾‹**

#### **ğŸ”¹ 3.1 åˆ›å»ºå¼‚æ­¥ä»»åŠ¡**

```
CompletableFuture<String> future = CompletableFuture.supplyAsync(() -> {
    // æ¨¡æ‹Ÿè€—æ—¶ä»»åŠ¡
    sleep(1000);
    return "Hello";
});
```

#### **ğŸ”¹ 3.2 thenApplyï¼šä¸²è¡Œè½¬æ¢**

```
future.thenApply(result -> result + " World")
      .thenAccept(System.out::println);
```

#### **ğŸ”¹ 3.3 thenCombineï¼šåˆå¹¶ä¸¤ä¸ªä»»åŠ¡ç»“æœ**

```
CompletableFuture<String> f1 = CompletableFuture.supplyAsync(() -> "A");
CompletableFuture<String> f2 = CompletableFuture.supplyAsync(() -> "B");

f1.thenCombine(f2, (a, b) -> a + b)
  .thenAccept(System.out::println); // è¾“å‡º AB
```

#### **ğŸ”¹ 3.4 allOfï¼šç­‰å¾…å¤šä¸ªä»»åŠ¡å…¨éƒ¨å®Œæˆ**

```
CompletableFuture<Void> all = CompletableFuture.allOf(f1, f2);
all.join(); // é˜»å¡ç›´åˆ°æ‰€æœ‰ä»»åŠ¡å®Œæˆ
```

#### **ğŸ”¹ 3.5 exceptionallyï¼šå¤„ç†å¼‚å¸¸**

```
CompletableFuture<String> failFuture = CompletableFuture.supplyAsync(() -> {
    if (true) throw new RuntimeException("å‡ºé”™äº†");
    return "OK";
});

failFuture
    .exceptionally(e -> "é»˜è®¤å€¼")
    .thenAccept(System.out::println); // è¾“å‡ºï¼šé»˜è®¤å€¼
```

### **âœ… 4. ä½¿ç”¨åœºæ™¯æ€»ç»“**

| **åœºæ™¯**                        | **è§£å†³æ–¹æ¡ˆ**               |
| ------------------------------- | -------------------------- |
| å¼‚æ­¥æ‰§è¡Œåå°ä»»åŠ¡                | supplyAsync()              |
| å¤šä¸ªä»»åŠ¡å¹¶å‘æ‰§è¡Œ + ç­‰å¾…å…¨éƒ¨å®Œæˆ | allOf()                    |
| å¤šä¸ªä»»åŠ¡å–ä¸€ä¸ªæœ€å¿«è¿”å›ç»“æœ      | anyOf()                    |
| å¼‚æ­¥å›è°ƒå¤„ç† / ä¸²è”ç»“æœ         | thenApply() / thenAccept() |
| å¼‚å¸¸æ¢å¤æœºåˆ¶                    | exceptionally() / handle() |

### **âœ… 5. é˜»å¡ vs éé˜»å¡æ–¹æ³•åŒºåˆ«**

| **æ–¹æ³•** | **ç±»å‹** | **è¯´æ˜**             |
| -------- | -------- | -------------------- |
| get()    | é˜»å¡     | ä¼šæŠ›å¼‚å¸¸             |
| join()   | é˜»å¡     | ä¸æŠ›æ£€æŸ¥å¼‚å¸¸ï¼ˆæ¨èï¼‰ |


### **âœ… 6. æ¨èå†™æ³•ï¼ˆé“¾å¼ã€éé˜»å¡ï¼‰**

```
CompletableFuture.supplyAsync(() -> "Step 1")
    .thenApply(s -> s + " + Step 2")
    .thenAccept(System.out::println);
```

### **âœ… 7. å’Œ Future çš„åŒºåˆ«ï¼ˆé‡ç‚¹ï¼‰**

| **ç‰¹æ€§**   | Future             | CompletableFuture            |
| ---------- | ------------------ | ---------------------------- |
| å¼‚æ­¥       | æœ‰é™æ”¯æŒ           | å®Œå…¨æ”¯æŒ                     |
| é˜»å¡       | åªèƒ½ get()         | å¯éé˜»å¡ã€å›è°ƒ               |
| ä¸²è”ä»»åŠ¡   | âŒ ä¸æ”¯æŒ           | âœ… thenApply() ç­‰æ”¯æŒé“¾å¼è°ƒç”¨ |
| å¼‚å¸¸å¤„ç†   | âŒ ä¸æ–¹ä¾¿           | âœ… æ”¯æŒ exceptionally()       |
| å¤šä»»åŠ¡ç»„åˆ | âŒ æ— æ³•å¤„ç†å¤šä¸ªä»»åŠ¡ | âœ… allOf()ã€anyOf() ç­‰        |


### **ğŸ¯ æ€»ç»“ä¸€æ®µè¯ç­”æ³•ï¼ˆé¢è¯•å›ç­”æ¨¡æ¿ï¼‰**
> Java ä¸­çš„ CompletableFuture æ˜¯å¯¹ Future çš„å¢å¼ºï¼Œæ”¯æŒå¼‚æ­¥æ‰§è¡Œã€ä»»åŠ¡é“¾å¼ç»„åˆã€å›è°ƒå¤„ç†ä¸å¼‚å¸¸æ•è·ç­‰åŠŸèƒ½ï¼Œé€‚åˆåœ¨å¤šçº¿ç¨‹å¹¶å‘ä»»åŠ¡å¤„ç†ã€å¾®æœåŠ¡è°ƒç”¨èšåˆç­‰åœºæ™¯ä¸­ä½¿ç”¨ã€‚å®ƒæ˜¯ Java 8 å‡½æ•°å¼ç¼–ç¨‹ + å¼‚æ­¥æ¨¡å‹ç»“åˆçš„é‡è¦å·¥å…·ï¼Œå°¤å…¶é€‚åˆæ›¿ä»£ä¼ ç»Ÿçš„ Future.get() çš„é˜»å¡è°ƒç”¨ã€‚
