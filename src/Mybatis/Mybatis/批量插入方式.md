# MyBatis 批量插入数据的三种实现方式

在日常开发中，批量插入数据是一个常见的场景。如果处理不当，可能会导致性能低下甚至数据库压力过大。MyBatis 提供了多种方式来实现批量插入，下面我们总结三种常见方式，并对比它们的优缺点及适用场景。

------

## 1. Foreach 拼接多值 INSERT

最常见的方式是利用 MyBatis 的动态 SQL，将多条数据拼接成一条 `INSERT` 语句：

```xml
<insert id="insertBatch" parameterType="list">
  INSERT INTO user (id, name, age)
  VALUES
  <foreach collection="list" item="item" separator=",">
    (#{item.id}, #{item.name}, #{item.age})
  </foreach>
</insert>
```

调用时传入 `List<User>`，MyBatis 会拼接成：

```sql
INSERT INTO user (id, name, age)
VALUES (1, 'Tom', 20), (2, 'Jerry', 22), (3, 'Jack', 25);
```

**优点**：

- 一次 SQL 插入多条数据，性能比单条循环插入高。
- 简单易用，代码可读性好。

**缺点**：

- 当批量数据过大时，SQL 语句过长，可能超出数据库包大小限制。
- 不适合百万级大数据批量插入。

**适用场景**：

- 中小规模批量插入（几百到几千条）。

------

## 2. ExecutorType.BATCH（JDBC 批处理模式）

MyBatis 提供 `ExecutorType.BATCH`，它基于 JDBC 批处理，将多条 `INSERT` 语句缓存后一次性发送给数据库：

```java
try (SqlSession sqlSession = sqlSessionFactory.openSession(ExecutorType.BATCH)) {
    UserMapper mapper = sqlSession.getMapper(UserMapper.class);
    for (User user : userList) {
        mapper.insert(user);  // 普通的 insert 方法
    }
    sqlSession.commit();
}
```

**优点**：

- 避免 SQL 拼接过长的问题。
- 大幅减少网络交互次数，性能更优。
- 更适合海量数据写入。

**缺点**：

- 事务需要手动管理。
- 代码实现比 Foreach 略复杂。

**适用场景**：

- 大规模批量插入（几万、几十万条）。

------

## 3. MyBatis-Plus 的 saveBatch

如果使用 **MyBatis-Plus**，它已经封装了批量插入方法：

```java
userService.saveBatch(userList, 1000); // 每 1000 条提交一次事务
```

**优点**：

- 框架封装，开发效率高。
- 内部支持分批提交，避免 OOM 或 SQL 过长。
- 简单易用，代码量少。

**缺点**：

- 依赖于 MyBatis-Plus，不是 MyBatis 原生特性。

**适用场景**：

- 常规业务开发，批量插入数据量适中。

------

## 总结

- **少量数据（几百到几千条）** → `foreach` 拼接多值 `INSERT`
- **大量数据（几万到几十万条）** → `ExecutorType.BATCH`（JDBC 批处理）
- **使用 MyBatis-Plus** → 直接调用 `saveBatch`，简单高效

在实际项目中，我们可以根据业务数据量、数据库特性以及团队技术栈，灵活选择不同的批量插入方式，以达到最佳的性能与可维护性。