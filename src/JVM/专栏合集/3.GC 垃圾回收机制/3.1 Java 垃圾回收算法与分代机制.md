---
title: 3.1 Java 垃圾回收算法与分代机制（图解）
date: 2025-07-09
category:
- JVM
- GC
- 性能优化
- 博客专栏
---

# ♻️ Java 垃圾回收算法与分代机制（图解）

JVM 的垃圾回收机制是自动内存管理的核心，它通过回收不再被使用的对象，释放内存空间，防止内存泄漏。Java 中使用了多种垃圾回收算法，并在堆内存中采用“分代”设计提高性能。

---

## 📦 垃圾收集目标：回收不可达对象

JVM 使用“可达性分析算法”判定对象是否存活。即：从一组称为 **GC Roots** 的根对象出发，能否通过引用链触达到目标对象。

如果对象不可达，就被视为“垃圾”，可被回收。

### 🌱 常见 GC Roots 示例：

* 虚拟机栈中的引用（栈帧中的局部变量）
* 方法区中的静态变量
* 方法区中的常量引用
* JNI 中的引用

---

## 🧠 Java 堆内存的分代结构

Java 堆被划分为两个主要部分：

```
Java Heap
├── Young Generation（新生代）
│   ├── Eden（伊甸园）
│   └── Survivor (S0/S1)
└── Old Generation（老年代）
```

* **新生代**：对象刚创建时分配在此区，生命周期短
* **老年代**：经历多次 GC 后仍存活的对象被晋升到此区

---

## 🔁 常见垃圾回收算法

| 算法名称                     | 描述                                                 |
| ---------------------------- | ---------------------------------------------------- |
| **标记-清除** (Mark-Sweep)   | 标记存活对象，清除未被标记的对象，可能产生碎片       |
| **标记-整理** (Mark-Compact) | 标记后将存活对象移动到一端，避免碎片，但耗时较长     |
| **复制算法** (Copying)       | 将对象复制到另一块空闲区域，适合新生代，效率高       |
| **分代收集** (Generational)  | 根据对象年龄分代处理，新生代用复制，老年代用标记整理 |

---

## 🔂 新生代垃圾回收（Minor GC）

* 使用复制算法（Eden → Survivor）
* 对象第一次创建在 Eden
* GC 时将活跃对象复制到 S0/S1
* 多次 GC 后仍存活的对象晋升到老年代

📌 快速、频繁，占用少量堆

---

## 🧹 老年代垃圾回收（Major/Full GC）

* 使用标记-清除或标记-整理算法
* 回收所有区域（包括新生代 + 老年代）
* 代价较高，暂停时间长

📌 应尽量减少 Full GC 的触发频率

---

## ⚙️ 对象晋升（Tenuring）

* 每个对象在 Survivor 区域存活的时间被称为“年龄”
* 到达一定年龄阈值（默认 15），会晋升到老年代
* 大对象可能直接分配到老年代（避免复制）

参数配置：

```bash
-XX:MaxTenuringThreshold=15
```

---

## 📈 示例图解

```
Eden (新对象) --GC--> Survivor --多次GC--> OldGen
```

```
+-------------------+   Minor GC    +-------------------+
|       Eden        |   ========>   |     Survivor S0    |
+-------------------+               +-------------------+
                                    ↓  若多次存活
                             +--------------------+
                             |    Old Generation   |
                             +--------------------+
```

---

## 📝 小结

* 垃圾回收核心机制是“可达性分析”
* 新生代采用复制算法，老年代采用标记整理
* 分代收集模型大幅提升 GC 性能
* Minor GC 轻量频繁，Major GC 成本高

---

👉 下一篇推荐：[3.2 CMS、G1、ZGC、Shenandoah 对比详解](#)