---
title: 3.2 CMS、G1、ZGC、Shenandoah 对比详解
icon: fa-solid fa-broom-ball
date: 2025-07-10
author: JeanHu
category:
  - JVM
tag:
  - JVM
  - GC
  - CMS
  - G1
  - ZGC
  - Shenandoah
summary: 本文全面对比了 Java 中几种主流垃圾回收器（CMS、G1、ZGC、Shenandoah）的原理、特点、适用场景与性能差异，帮助读者在实际项目中合理选型。
---

# 🔍 3.2 CMS、G1、ZGC、Shenandoah 对比详解

本篇将深入比较四大现代垃圾回收器：**CMS、G1、ZGC、Shenandoah**，它们是 Java 在不同版本中主推的低延迟或并发收集器，适用于不同规模与场景的后端系统。

------

## 🚀 概览对比表

| 特性           | CMS                 | G1               | ZGC              | Shenandoah       |
| -------------- | ------------------- | ---------------- | ---------------- | ---------------- |
| 引入版本       | JDK 5               | JDK 7u4          | JDK 11（生产）   | JDK 12（实验）   |
| 收集目标       | 低停顿              | 停顿+吞吐均衡    | 极低停顿         | 极低停顿         |
| 并发标记       | ✅                   | ✅                | ✅                | ✅                |
| 并发整理       | ❌（Stop-the-world） | ✅                | ✅                | ✅                |
| 区域模型       | 分代                | Region           | Region（无分代） | Region（无分代） |
| 最大堆支持     | TB 级               | TB 级            | 最大 16TB        | 最大 16TB        |
| 延迟控制能力   | 一般                | 中等             | 精细             | 精细             |
| 增量式并发回收 | ❌                   | ✅                | ✅                | ✅                |
| 适合场景       | 老系统、过渡阶段    | 大多数中大型系统 | 极致延迟敏感系统 | 大型数据密集系统 |

------

## 🧠 CMS（Concurrent Mark Sweep）

- **特点**：采用标记-清除算法，目标是降低老年代 GC 停顿
- **分代类型**：是（新生代使用复制，老年代使用标记清除）
- **缺点**：
  - 会产生空间碎片
  - CMS Initial Mark 和 Remark 阶段仍需停顿
  - 已被 G1 在 JDK 9 后标记为 deprecated

📌 启用参数：

```bash
-XX:+UseConcMarkSweepGC
```

------

## 🌳 G1（Garbage First）

- **特点**：将堆划分为多个 Region，优先回收垃圾最多的 Region
- **回收策略**：并发标记 + 并发整理，平衡吞吐与延迟
- **优势**：
  - 没有明显的“新生代/老年代”边界
  - 可通过参数设置最大停顿时间
  - 更适用于大堆内存

📌 启用参数：

```bash
-XX:+UseG1GC
-XX:MaxGCPauseMillis=200
```

------

## ⚡ ZGC（Z Garbage Collector）

- **特点**：低于 10ms 的停顿，支持超大内存（最高 16TB）
- **核心机制**：染色指针 + 并发阶段 + 内存重映射
- **优势**：
  - 停顿极短，与堆大小几乎无关
  - 并发标记、并发移动对象，适合大型服务与游戏后端

📌 启用参数（JDK 17+）：

```bash
-XX:+UseZGC
```

------

## 🌊 Shenandoah

- **特点**：红帽贡献，强调低延迟，与 ZGC 类似但设计不同
- **实现机制**：并发标记 + 并发压缩（移动对象）
- **亮点**：
  - 几乎所有阶段都可并发执行
  - 不依赖染色指针，兼容性更好

📌 启用参数（JDK 17+）：

```bash
-XX:+UseShenandoahGC
```

------

## 🔍 回收过程阶段对比

| 阶段          | CMS  | G1   | ZGC  | Shenandoah |
| ------------- | ---- | ---- | ---- | ---------- |
| 初始标记      | 停顿 | 停顿 | 停顿 | 停顿       |
| 并发标记      | ✅    | ✅    | ✅    | ✅          |
| 最终标记      | 停顿 | 停顿 | 停顿 | 停顿       |
| 并发清理/整理 | ❌    | ✅    | ✅    | ✅          |

------

## 📝 小结

- CMS 已逐步退出主流，推荐使用 G1、ZGC、Shenandoah 替代
- G1 是当前通用默认收集器，适用于大部分应用
- ZGC 和 Shenandoah 更适合延迟敏感或内存超大场景
- 选择收集器需根据业务对响应时间、吞吐量的要求权衡

------

👉 下一篇推荐：[3.3 GC 日志参数详解与案例分析](3.3%20GC%20日志参数详解与案例分析.md)